<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skapa din plan — Studievägsguiden</title>
<meta name="description" content="Besvara 26 frågor och få din personliga studievägsplan med ekonomisk kalkyl, behörighetskontroll och tidslinje.">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@700;800;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#FAFAF7;--card:#FFF;--tx:#1A1A18;--mu:#6B6B63;--li:#9C9C91;--ac:#7AC29A;--al:#D9F0E3;--ah:#5AA87A;--wa:#6BA3D0;--wl:#D4E8F5;--re:#E07A7A;--rl:#F8E8E8;--bl:#6BA3D0;--bll:#D4E8F5;--pu:#9B87C2;--pl:#EDE7F5;--bo:#E8E8E2;--sh:0 2px 20px rgba(0,0,0,.06);--shl:0 8px 40px rgba(0,0,0,.1);--r:12px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--tx);line-height:1.6;-webkit-font-smoothing:antialiased}
nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(250,250,247,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--bo);padding:0 24px;height:60px;display:flex;align-items:center;justify-content:space-between}
.logo{font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:700;letter-spacing:0.01em}
.logo .i-dot{position:relative;display:inline-block}
.logo .i-dot::after{content:'';position:absolute;top:0.25em;left:50%;transform:translateX(-50%);width:0.2em;height:0.2em;background:#6BA3D0;border-radius:50%}
.hero{min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:100px 24px 60px;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;top:-30%;left:-20%;width:60%;height:60%;background:radial-gradient(ellipse,rgba(122,194,154,.06) 0%,transparent 70%)}
.badge{display:inline-flex;align-items:center;gap:6px;background:var(--al);color:var(--ac);padding:8px 16px;border-radius:20px;font-size:.82rem;font-weight:600;margin-bottom:32px;opacity:0;animation:fu .8s ease forwards .2s}
.hero h1{font-family:'DM Serif Display',serif;font-size:clamp(2.2rem,5vw,3.8rem);line-height:1.12;max-width:680px;margin-bottom:18px;letter-spacing:-1px;opacity:0;animation:fu .8s ease forwards .4s}
.hero>p{font-size:1.12rem;color:var(--mu);max-width:480px;margin-bottom:44px;opacity:0;animation:fu .8s ease forwards .6s}
.cbox{background:var(--card);border:2px solid var(--bo);border-radius:16px;padding:28px;width:100%;max-width:500px;box-shadow:var(--shl);position:relative;z-index:1;opacity:0;animation:fu .8s ease forwards .8s}
.fld{margin-bottom:18px}
.fld label{display:block;font-size:.78rem;font-weight:600;color:var(--mu);text-transform:uppercase;letter-spacing:.5px;margin-bottom:7px}
.fld input,.fld select{width:100%;padding:13px 15px;border:2px solid var(--bo);border-radius:10px;font-family:inherit;font-size:1rem;color:var(--tx);background:var(--bg);transition:border-color .2s;appearance:none;-webkit-appearance:none}
.fld input:focus,.fld select:focus{outline:none;border-color:var(--ac)}
.fld select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236B6B63' stroke-width='2' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px}
.btn{width:100%;padding:15px;background:var(--ac);color:#fff;border:none;border-radius:10px;font-family:inherit;font-size:1.02rem;font-weight:700;cursor:pointer;transition:all .2s}
.btn:hover{background:var(--ah);transform:translateY(-1px);box-shadow:0 4px 16px rgba(122,194,154,.3)}
.sec{max-width:1100px;margin:0 auto;padding:0 32px 80px;display:none}.sec.v{display:block}
.sh{text-align:center;padding:56px 0 36px}.sh h2{font-family:'DM Serif Display',serif;font-size:1.9rem;margin-bottom:6px}.sh p{color:var(--mu)}
.gcards{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:44px;max-width:720px;margin-left:auto;margin-right:auto}
.gc{background:var(--card);border:2px solid var(--bo);border-radius:var(--r);padding:18px 14px;text-align:center;opacity:0;transform:translateY(20px);position:relative}.gc.sh2{animation:fu .5s ease forwards}
.gcx{cursor:pointer;transition:border-color .2s}.gcx:hover{border-color:var(--ac)}.gcx.open{border-color:var(--ac)}
.gcarr{position:absolute;top:8px;right:8px;color:var(--li);transition:transform .2s;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%}
.gcx.open .gcarr{transform:rotate(180deg)}
.gcexp{max-height:0;overflow:hidden;transition:max-height .3s ease}
.gcx.open .gcexp{max-height:200px}
.gcexp-inner{padding-top:12px;margin-top:10px;border-top:1px solid var(--bo);text-align:left;font-size:.82rem;color:var(--mu);line-height:1.55}
.gcexp-inner .gcbar{height:5px;border-radius:3px;background:var(--bo);margin:8px 0 3px;overflow:hidden}
.gcexp-inner .gcfill{height:100%;border-radius:3px;transition:width .6s ease}
.gcexp-inner .gcmeta{display:flex;justify-content:space-between;font-size:.68rem;color:var(--li)}
.gc .gl{font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px}
.gc .gv{font-family:'DM Serif Display',serif;font-size:1.4rem;line-height:1.2}
.gc .gs{font-size:.75rem;color:var(--li);margin-top:3px}
.verd{background:var(--card);border:2px solid var(--bo);border-radius:var(--r);padding:28px 24px;text-align:center;margin-bottom:48px;opacity:0;transform:translateY(20px)}.verd.sh2{animation:fu .5s ease forwards}
.ve{font-size:2rem;margin-bottom:8px}.vt{font-size:1.02rem;line-height:1.6}.vt strong{color:var(--ac)}
/* Teaser */
.tdiv{text-align:center;margin-bottom:28px;position:relative}.tdiv::before{content:'';position:absolute;left:0;right:0;top:50%;height:1px;background:var(--bo)}.tdiv span{background:var(--bg);padding:0 16px;position:relative;font-size:.82rem;font-weight:600;color:var(--li);text-transform:uppercase;letter-spacing:1px}
.twrap{position:relative;border-radius:16px;border:2px solid var(--bo);overflow:hidden}
.tblur{filter:blur(6px);opacity:.5;pointer-events:none;user-select:none;padding:28px 24px}
.tover{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(180deg,rgba(250,250,247,0) 0%,rgba(250,250,247,.92) 30%,rgba(250,250,247,1) 60%);display:flex;flex-direction:column;align-items:center;padding:80px 24px 36px}
.tover h3{font-family:'DM Serif Display',serif;font-size:1.35rem;margin-bottom:8px;text-align:center;line-height:1.3}
.tover>p{color:var(--mu);text-align:center;max-width:380px;margin-bottom:20px;font-size:.9rem;line-height:1.5}
.ubtn{background:var(--ac);color:#fff;border:none;padding:15px 36px;border-radius:10px;font-family:inherit;font-size:1.02rem;font-weight:700;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:10px}
.ubtn:hover{background:var(--ah);transform:translateY(-2px);box-shadow:0 6px 24px rgba(122,194,154,.3)}
.ubtn .pr{font-size:.85rem;opacity:.8;font-weight:500}
.tsec-head{font-family:'DM Serif Display',serif;font-size:1.05rem;display:flex;align-items:center;gap:8px;margin-bottom:10px}
.tsec-head .tn{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.72rem;font-weight:700;color:#fff;flex-shrink:0}
/* Wizard */
.wov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);z-index:200;justify-content:center;align-items:center;padding:20px}.wov.a{display:flex}
.wiz{background:var(--card);border-radius:20px;max-width:520px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:var(--shl)}
.wizh{padding:24px 28px 0;display:flex;justify-content:space-between;align-items:center}.wizh h3{font-family:'DM Serif Display',serif;font-size:1.25rem}
.wizx{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--li);width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:50%}.wizx:hover{background:var(--bg);color:var(--tx)}
.wprog{margin:16px 28px 0;height:4px;background:var(--bo);border-radius:2px;overflow:hidden}.wbar{height:100%;background:var(--ac);transition:width .3s;border-radius:2px}
.wsl{padding:8px 28px 0;font-size:.78rem;color:var(--li)}
.wbody{padding:20px 28px 28px}
.wq h4{font-size:1.05rem;font-weight:600;margin-bottom:6px}.wq .why{font-size:.82rem;color:var(--li);margin-bottom:16px;font-style:italic}
.wopts{display:grid;gap:8px}
.wo{padding:14px 16px;border:2px solid var(--bo);border-radius:10px;cursor:pointer;transition:all .15s;font-size:.92rem;display:flex;align-items:center;gap:10px}
.wo:hover{border-color:var(--ac);background:var(--al)}.wo.sel{border-color:var(--ac);background:var(--al);font-weight:600}
.wdot{width:20px;height:20px;border-radius:50%;border:2px solid var(--bo);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}
.wo.sel .wdot{border-color:var(--ac);background:var(--ac)}.wo.sel .wdot::after{content:'';width:8px;height:8px;border-radius:50%;background:#fff}
.winp{display:flex;gap:10px;align-items:center}.winp input{flex:1;padding:13px 15px;border:2px solid var(--bo);border-radius:10px;font-family:inherit;font-size:1rem;color:var(--tx);background:var(--bg)}.winp input:focus{outline:none;border-color:var(--ac)}.winp span{font-size:.88rem;color:var(--mu);white-space:nowrap}
.wnav{display:flex;gap:10px;margin-top:24px}
.wbk{flex:1;padding:13px;background:var(--bg);border:2px solid var(--bo);border-radius:10px;font-family:inherit;font-weight:600;font-size:.92rem;cursor:pointer;color:var(--mu)}
.wnx{flex:2;padding:13px;background:var(--ac);color:#fff;border:none;border-radius:10px;font-family:inherit;font-weight:700;font-size:.92rem;cursor:pointer;transition:all .2s}.wnx:hover{background:var(--ah)}
.psum{background:var(--al);padding:16px;border-radius:10px;margin-bottom:20px}.psr{display:flex;justify-content:space-between;font-size:.88rem;padding:4px 0}.psr.tot{font-weight:700;font-size:1rem;border-top:1px solid rgba(122,194,154,.2);padding-top:10px;margin-top:8px}
/* Full plan */
.fp{display:none;max-width:720px;margin:0 auto;padding:0 24px}.fp.v{display:block}
.ptbar{position:sticky;top:60px;z-index:90;background:rgba(250,250,247,.98);backdrop-filter:blur(12px);border-bottom:2px solid #e0e0d8;margin:0 -24px 32px;padding:10px 16px;display:flex;gap:6px;box-shadow:0 2px 8px rgba(0,0,0,.04);overflow-x:auto;scrollbar-width:none}
.ptbar::-webkit-scrollbar{display:none}
.ptbar button{flex:1;padding:10px 6px;border-radius:10px;border:2px solid transparent;background:#fff;font-family:inherit;font-size:.75rem;font-weight:600;color:#6B6B63;cursor:pointer;transition:all .2s;position:relative}
.ptbar button:hover{border-color:var(--ac);color:var(--ac);transform:translateY(-1px)}
.ptbar button.act{background:linear-gradient(135deg,var(--ac),var(--ah));color:#fff;border-color:transparent;box-shadow:0 4px 12px rgba(122,194,154,.3);transform:translateY(-2px)}
.pwel{background:linear-gradient(135deg,var(--ac),var(--ah));border-radius:16px;padding:32px 24px;color:#fff;margin-bottom:28px}.pwel h3{font-family:'DM Serif Display',serif;font-size:1.5rem;margin-bottom:10px;color:#fff;line-height:1.3}.pwel .pintro{opacity:.9;font-size:.9rem;line-height:1.65}
.pwel .pfacts{display:flex;flex-wrap:wrap;gap:6px;margin-top:16px}.pwel .pfacts span{background:rgba(255,255,255,.15);padding:5px 12px;border-radius:20px;font-size:.74rem;font-weight:600}
/* Section dividers */
.psec{margin-bottom:36px}.psec-h{display:flex;align-items:center;gap:10px;margin-bottom:6px}.psec-n{width:28px;height:28px;border-radius:50%;background:var(--ac);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.78rem;flex-shrink:0}
.psec-t{font-family:'DM Serif Display',serif;font-size:1.2rem}
.psec-sub{font-size:.86rem;color:var(--mu);line-height:1.6;margin-bottom:16px;margin-left:38px}
/* Match cards */
.mcard{border:2px solid var(--bo);border-radius:var(--r);padding:18px;margin-bottom:10px;transition:all .2s;position:relative}.mcard.msel{border-color:var(--ac);background:var(--al)}
.mcard .mtop{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px}
.mcard .mname{font-weight:700;font-size:1rem}.mcard .mbadge{padding:3px 10px;border-radius:12px;font-size:.7rem;font-weight:700;flex-shrink:0;white-space:nowrap}
.mcard .mwhy{font-size:.84rem;color:var(--mu);line-height:1.5;margin-bottom:10px}
.mcard .mstats{display:flex;gap:8px;flex-wrap:wrap}.mcard .mstat{font-size:.74rem;padding:3px 8px;border-radius:5px;background:#f5f5f0}
/* Action steps */
.astep{display:flex;gap:16px;padding:18px 0;border-bottom:1px solid var(--bo)}.astep:last-child{border-bottom:none}
.anum{width:32px;height:32px;border-radius:50%;background:var(--ac);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.82rem;flex-shrink:0}
.abody{flex:1}.abody .atit{font-weight:700;font-size:.92rem;margin-bottom:2px}.abody .awhen{font-size:.76rem;color:var(--ac);font-weight:600;margin-bottom:5px}.abody .adesc{font-size:.84rem;color:var(--mu);line-height:1.55}
/* Checklist */
.chk{display:flex;align-items:center;gap:10px;padding:12px 14px;border-radius:8px;border:1.5px solid var(--bo);margin-bottom:6px;cursor:pointer;transition:all .15s;font-size:.88rem;user-select:none}.chk:hover{border-color:var(--ac)}.chk.done{background:var(--al);border-color:var(--ac);color:var(--li)}
.chk.done span{text-decoration:line-through}
.chk .chkbox{width:20px;height:20px;border-radius:5px;border:2px solid var(--bo);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}
.chk.done .chkbox{background:var(--ac);border-color:var(--ac)}
/* Proof tags */
.ptag{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:6px;font-size:.72rem;font-weight:600;background:var(--al);color:var(--ac);margin:2px}
/* Housing buttons */
.houbtn{flex:1;padding:6px 4px;border:1.5px solid var(--bo);border-radius:6px;background:var(--bg);font-family:inherit;font-size:.72rem;font-weight:600;color:var(--mu);cursor:pointer;transition:all .15s}
.houbtn:hover{border-color:var(--re);color:var(--re)}
.houbtn.hact{border-color:var(--re);background:var(--rl);color:var(--re)}
/* Existing card styles */
.pcard{background:var(--card);border:2px solid var(--bo);border-radius:var(--r);overflow:hidden;margin-bottom:20px}
.pcardh{padding:16px 20px}.pcardh h4{font-size:1rem;font-weight:600;margin-bottom:2px}.pcardh p{font-size:.82rem;opacity:.8}
.pcardb{padding:20px}
.brow{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-radius:8px;margin-bottom:6px}.brow label{font-size:.88rem}.brow .bv{font-weight:700;font-size:.92rem}
.bsrow{padding:12px;border-radius:8px;margin-bottom:6px}
.bslider{width:100%;height:6px;cursor:pointer;border-radius:3px;margin-top:6px}
.bsmeta{display:flex;justify-content:space-between;font-size:.68rem;color:var(--li);margin-top:4px}
.btot{display:flex;justify-content:space-between;padding:12px;border-radius:8px;color:#fff;font-weight:700}
.bres{padding:20px;border-radius:10px;text-align:center;margin-top:16px;border:2px solid}
.brl{font-size:.88rem;margin-bottom:4px}.brv{font-size:1.7rem;font-weight:700}.bra{font-size:.82rem;margin-top:8px}
.behal{padding:18px;border-radius:var(--r);margin-bottom:16px;border:2px solid}.behal h4{font-size:.95rem;margin-bottom:6px;display:flex;align-items:center;gap:8px}.behal p{font-size:.86rem;line-height:1.6}
.behc{margin-top:10px;display:flex;flex-wrap:wrap;gap:6px}.behc span{padding:4px 12px;border-radius:6px;font-size:.8rem;font-weight:600}
.amgrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}.amitem{padding:14px;border-radius:10px}.amitem .aml{font-size:.72rem;font-weight:700;text-transform:uppercase;margin-bottom:4px}.amitem .amv{font-family:'DM Serif Display',serif;font-size:1.2rem}.amitem .ams{font-size:.78rem;margin-top:4px}
.ambw{margin-top:12px}.ambl{display:flex;justify-content:space-between;font-size:.82rem;margin-bottom:4px}.amb{height:8px;border-radius:4px;background:var(--bo);overflow:hidden}.ambf{height:100%;border-radius:4px;transition:width .8s ease}
.cgrid{display:grid;gap:10px}.crow{display:grid;grid-template-columns:auto 1fr auto;gap:14px;align-items:center;padding:14px 16px;border-radius:10px;border:2px solid var(--bo)}.crow:hover{border-color:var(--ac)}
.cico{display:flex;align-items:center}.cinf .cit{font-weight:600;font-size:.92rem}.cinf .cid{font-size:.78rem;color:var(--mu)}
.csal{font-family:'DM Serif Display',serif;font-size:1.1rem;text-align:right}.csal .csub{font-size:.7rem;color:var(--li);font-family:'DM Sans'}
.schi{display:flex;gap:14px;align-items:center;padding:14px 16px;border-radius:10px;border:2px solid var(--bo);margin-bottom:8px}
.schico{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.schinf{flex:1}.schinf .schn{font-weight:600;font-size:.92rem}.schinf .schm{font-size:.78rem;color:var(--mu)}
.scht{display:flex;gap:5px;flex-wrap:wrap;margin-top:4px}.scht span{padding:2px 8px;border-radius:4px;font-size:.7rem;font-weight:600;background:var(--al);color:var(--ac)}
.upsell{background:linear-gradient(135deg,var(--wl),#FFF8EE);border:2px solid var(--wa);border-radius:var(--r);padding:28px;text-align:center;margin-top:32px}
.upsell h4{font-family:'DM Serif Display',serif;font-size:1.15rem;margin-bottom:8px}.upsell>p{color:var(--mu);font-size:.9rem;margin-bottom:18px;max-width:400px;margin-left:auto;margin-right:auto}
.ubtn2{background:var(--wa);color:#fff;border:none;padding:13px 28px;border-radius:10px;font-family:inherit;font-size:.95rem;font-weight:700;cursor:pointer}.ubtn2:hover{background:#C09540}
.sgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
.scard{padding:12px 8px;border-radius:var(--r);text-align:center}.scard .sl{font-size:.64rem;font-weight:700;text-transform:uppercase;letter-spacing:.3px;margin-bottom:3px}.scard .sv{font-family:'DM Serif Display',serif;font-size:1rem}
.pncont{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:28px;max-width:720px;margin-left:auto;margin-right:auto}
.pnbox{background:var(--card);border:2px solid var(--bo);border-radius:var(--r);overflow:hidden;opacity:0;transform:translateY(20px)}.pnbox.sh2{animation:fu .5s ease forwards}
.pnhead{padding:14px 16px;display:flex;align-items:center;gap:8px;font-weight:700;font-size:.88rem}
.pnhead svg{flex-shrink:0}
.pnlist{padding:0 16px 16px;display:grid;gap:8px}
.pnitem{display:flex;gap:10px;align-items:flex-start;font-size:.84rem;line-height:1.5;color:var(--mu)}
.pnitem svg{flex-shrink:0;margin-top:3px}
.pnpro .pnhead{color:var(--ac);background:var(--al);border-bottom:1px solid rgba(122,194,154,.12)}
.pncon .pnhead{color:var(--re);background:var(--rl);border-bottom:1px solid rgba(194,75,59,.12)}
.pnpro .pnitem svg{color:var(--ac)}.pncon .pnitem svg{color:var(--re)}
@keyframes fu{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* ═══════════════════════════════════════════
   MOBILE STYLES — max-width: 640px
═══════════════════════════════════════════ */
@media(max-width:640px){
  /* General */
  .sec{padding:0 16px 60px}
  .fp{padding:0 14px}

  /* Hero */
  .hero{padding:80px 20px 48px}
  .hero h1{font-size:1.9rem;letter-spacing:-.5px}
  .hero>p{font-size:.95rem}
  .cbox{padding:18px 16px}

  /* Nav */
  nav{padding:0 16px}

  /* Snabbkalkyl cards */
  .gcards{grid-template-columns:1fr 1fr!important}
  .sgrid{grid-template-columns:1fr 1fr!important}
  .pncont{grid-template-columns:1fr!important}
  .amgrid{grid-template-columns:1fr!important}

  /* Tab bar */
  .ptbar{padding:8px 12px;gap:4px;top:58px}
  .ptbar button{font-size:.68rem;padding:8px 3px;border-radius:8px;flex-shrink:0;min-width:0}

  /* Plan section spacing */
  .psec{margin-bottom:24px}
  .pwel{padding:22px 18px}
  .pwel h3{font-size:1.2rem}

  /* Wizard */
  .wov{padding:0;align-items:flex-end}
  .wiz{border-radius:20px 20px 0 0;max-height:92vh;max-width:100%;width:100%}
  .wizh{padding:18px 18px 0}
  .wprog,.wsl{margin-left:18px;margin-right:18px}
  .wbody{padding:16px 18px 24px}
  .wq h4{font-size:1rem}
  .wo{padding:12px 14px;font-size:.88rem}
  .wnx,.wbk{padding:12px}
  .wnav{margin-top:16px}

  /* Action steps */
  .astep{gap:12px;padding:14px 0}
  .anum{width:28px;height:28px;font-size:.78rem;flex-shrink:0}

  /* Plan overview cards */
  .mcard .mtop{flex-direction:column;gap:6px}
  .mcard .mbadge{align-self:flex-start}

  /* Paywall overlay — force single column grids */
  #planLoader [style*="grid-template-columns:repeat(3"]{grid-template-columns:repeat(2,1fr)!important}
  #planEkon [style*="grid-template-columns:repeat(3"]{grid-template-columns:1fr 1fr!important}
  #planEkon [style*="grid-template-columns:repeat(6"]{grid-template-columns:repeat(3,1fr)!important}
  #planSkol [style*="grid-template-columns:repeat(2"]{grid-template-columns:1fr 1fr!important}
  #planTid [style*="grid-template-columns:repeat(3"]{grid-template-columns:1fr 1fr!important}
  #planOverview [style*="grid-template-columns:repeat(3"]{grid-template-columns:1fr 1fr!important}
  #planOverview [style*="grid-template-columns:repeat(4"]{grid-template-columns:1fr 1fr!important}
  #planBeh [style*="grid-template-columns:repeat(2"]{grid-template-columns:1fr!important}

  /* Budget sliders */
  .bsrow{padding:10px}
  .bslider{height:8px} /* bigger tap target */
  .houbtn{padding:8px 4px;font-size:.7rem}

  /* School cards */
  .schi{flex-wrap:wrap;gap:10px}
  .scht{margin-top:6px}

  /* Upsell */
  .upsell{padding:20px 16px}

  /* Section headers in plan */
  .sh{padding:36px 0 24px}
  .sh h2{font-size:1.5rem}

  /* Verdict card */
  .verd{padding:20px 16px}
  .ve{font-size:1.5rem}
  .vt{font-size:.92rem}

  /* CTA area */
  #ctaPlan{padding:22px 18px}
  #ctaPlan h3{font-size:1.25rem}

  /* Tidslinje date cards — always 3 col but smaller text */
  #planTid .date-row [style*="font-size:1.4rem"]{font-size:1.1rem!important}
}

/* Smaller phones */
@media(max-width:380px){
  .ptbar button{font-size:.62rem;padding:7px 2px}
  .gcards{grid-template-columns:1fr!important}
  .hero h1{font-size:1.65rem}
  #planEkon [style*="grid-template-columns:repeat(3"]{grid-template-columns:1fr!important}
  #planTid [style*="grid-template-columns:repeat(3"]{grid-template-columns:1fr!important}
  .mob-grid-2,.mob-grid-3{grid-template-columns:1fr 1fr!important}
}

/* Mobile grid helpers */
@media(max-width:640px){
  .mob-grid-2{grid-template-columns:1fr 1fr!important}
  .mob-grid-3{grid-template-columns:1fr 1fr!important}
}

/* Tab label switching */
.ts{display:none}.tf{display:inline}
@media(max-width:480px){.ts{display:inline}.tf{display:none}}

/* Bigger tap targets on mobile */
@media(max-width:640px){
  .wo{min-height:48px}
  .wnx,.wbk{min-height:48px}
  .btn{min-height:52px}
  .ubtn{min-height:52px}
  input[type=range]{height:28px;cursor:pointer}
}

.budget-sticky {
    position:sticky;
    top:110px;
    z-index:10;
    background:var(--bg);
    padding:12px 0 10px;
    margin-bottom:20px;
}
.budget-sticky::before {
    content:'';
    position:absolute;
    top:-12px;left:-24px;right:-24px;
    height:12px;
    background:var(--bg);
}
@media(max-width:640px){.budget-sticky{top:106px}}
@media print {
    nav,.hero,.sec#secR,.ptbar,footer,.wov,#planLoader,button:not(.no-print){display:none!important}
    .pnl{display:block!important;page-break-inside:avoid}
    body{background:#fff!important}
    @page{margin:1.5cm;size:A4}
}
</style>
<style>
/* ── Standalone wizard page ── */
body{background:var(--bg);min-height:100vh}

.wiz-page{
    min-height:calc(100vh - 60px);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    padding:80px 20px 60px;
    max-width:580px;
    margin:0 auto;
}

.wiz-header{
    width:100%;
    margin-bottom:24px;
    text-align:center;
}

.wiz-brand{
    font-size:.78rem;
    font-weight:600;
    color:var(--li);
    text-transform:uppercase;
    letter-spacing:.5px;
    margin-bottom:6px;
}

#wTi{
    font-family:'DM Serif Display',serif;
    font-size:1.15rem;
    color:var(--tx);
    margin-bottom:0;
}

.wiz-progress{
    width:100%;
    margin:16px 0 6px;
    height:4px;
    background:var(--bo);
    border-radius:2px;
    overflow:hidden;
}

.wiz-progress .wbar{
    height:100%;
    background:var(--ac);
    transition:width .3s;
    border-radius:2px;
}

#wSL{
    font-size:.76rem;
    color:var(--li);
    margin-bottom:20px;
    text-align:right;
}

#wB{
    width:100%;
    background:var(--card);
    border:2px solid var(--bo);
    border-radius:16px;
    padding:28px;
    box-shadow:var(--sh);
}

/* Override wizard modal styles for inline rendering */
.wbody{padding:0 !important}

@media(max-width:640px){
    .wiz-page{padding:72px 16px 48px}
    #wB{padding:20px 16px;border-radius:12px}
}

@keyframes fu{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
.wiz-page{animation:fu .5s ease forwards}
</style>
</head>
<body>

<nav>
  <div class="logo">
    <span style="color:#6BA3D0">Studievägs</span><span style="color:#7AC29A">gu<span class="i-dot">ı</span>den</span>
  </div>
  <div style="font-size:.8rem;color:var(--mu)">Skapa din personliga plan</div>
</nav>

<div class="wiz-page">
  <div class="wiz-header">
    <div class="wiz-brand">Steg för steg</div>
    <div id="wTi">Din bakgrund</div>
  </div>
  <div class="wiz-progress"><div class="wbar" id="wBar" style="width:4%"></div></div>
  <div id="wSL" style="font-size:.76rem;color:var(--li);margin-bottom:20px;text-align:right">Fråga 1 av 26</div>
  <div id="wB"></div>
</div>

<script>
const SUPABASE_URL = 'https://qofvdpvxrvvjalgdiflg.supabase.co';
const SUPABASE_KEY = 'sb_publishable_Vfm1BArZN_RAWrwTOzVGXA_WWvIk77V';
</script>

<script>
const E=[
{id:1,t:'Sjuksköterska',y:3,s0:34000,s1:43900,dem:5,ai:8,stress:4,future:5,tc:11000,req:['Naturkunskap 2','Matte 2a/b','Samhällskunskap 1b'],rp:['Naturvetenskap','Teknik'],pp:['Samhäll','Ekonomi'],
 sch:[
   {n:'Sjuksköterskeprogrammet',school:'Karolinska Institutet',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026'],length:'3 år (180 hp)',csn:true,fee:0,lang:'swedish',cutoff:18.5,vfu:'46 veckor VFU',url:'https://ki.se/utbildning/sjukskoterska',p:1.45,t:['Hög ranking','Forskning','Top 3 Sverige']},
   {n:'Sjuksköterskeprogrammet',school:'Göteborgs Universitet',c:'goteborg',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'3 år (180 hp)',csn:true,fee:0,lang:'swedish',cutoff:17.2,vfu:'46 veckor VFU',url:'https://www.gu.se/studera/sjukskoterska',p:1.25,t:['Stort universitetssjukhus','Bred VFU']},
   {n:'Sjuksköterskeprogrammet',school:'Uppsala Universitet',c:'uppsala',f:'campus',pace:'fulltime',starts:['HT2026'],length:'3 år (180 hp)',csn:true,fee:0,lang:'swedish',cutoff:16.8,vfu:'46 veckor VFU',url:'https://www.uu.se/utbildning/sjukskoterska',p:1.15,t:['Tradition','Akademiska sjukhuset']},
   {n:'Sjuksköterskeprogrammet',school:'Linnéuniversitetet',c:'other',f:'both',pace:'fulltime',starts:['HT2026','VT2027'],length:'3 år (180 hp)',csn:true,fee:0,lang:'swedish',cutoff:14.5,vfu:'46 veckor VFU',url:'https://lnu.se/sjukskoterska',p:.85,t:['Distansalternativ','Flexibelt','Lägre krav']},
   {n:'Sjuksköterskeprogrammet',school:'Malmö Universitet',c:'malmo',f:'campus',pace:'fulltime',starts:['HT2026'],length:'3 år (180 hp)',csn:true,fee:0,lang:'swedish',cutoff:15.8,vfu:'46 veckor VFU',url:'https://mau.se/sjukskoterska',p:1.05,t:['Modernt','Praktikfokus']},
   {n:'Sjuksköterskeprogrammet (distans)',school:'Mittuniversitetet',c:'other',f:'distance',pace:'fulltime',starts:['HT2026','VT2027'],length:'3 år (180 hp)',csn:true,fee:0,lang:'swedish',cutoff:13.2,vfu:'46 veckor VFU',url:'https://www.miun.se/sjukskoterska-distans',p:.7,t:['Distans','Flexibelt','Egen takt']}
 ],
 sc:{st:'Vårdcentral / avdelning',ho:'Byter specialitet / region',sp:'IVA / anestesi / barnmorska',le:'Vårdenhetschef'}},
{id:2,t:'Systemutvecklare',y:3,s0:35000,s1:54900,dem:4,ai:15,stress:2,future:4,tc:8000,req:['Matte 3c/4','Fysik 1a/2'],rp:['Naturvetenskap','Teknik'],pp:['Samhäll','Ekonomi'],
 sch:[
   {n:'Civilingenjör Datateknik',school:'KTH',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026'],length:'5 år (300 hp)',csn:true,fee:0,lang:'swedish',cutoff:22.5,vfu:'',url:'https://www.kth.se/datateknik',p:1.65,t:['Top 3 Sverige','Forskningsnära','Högst ranking']},
   {n:'Systemvetenskapligt program',school:'Stockholms Universitet',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'3 år (180 hp)',csn:true,fee:0,lang:'swedish',cutoff:16.5,vfu:'',url:'https://www.su.se/systemvetenskap',p:1.35,t:['Bred IT-grund','Lägre inträdeskrav']},
   {n:'Mjukvaruutveckling och mobila plattformar',school:'Linnéuniversitetet',c:'other',f:'both',pace:'fulltime',starts:['HT2026'],length:'3 år (180 hp)',csn:true,fee:0,lang:'swedish',cutoff:14.2,vfu:'',url:'https://lnu.se/mjukvaruutveckling',p:1.15,t:['Modern stack','Distansmöjlighet']},
   {n:'.NET-utvecklare',school:'Nackademin (YH)',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'12 veckor LIA',url:'https://nackademin.se/net-utvecklare',p:0,t:['YH','Praktikfokus','Snabb väg in']},
   {n:'Frontendutvecklare',school:'Medieinstitutet (YH)',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'16 veckor LIA',url:'https://medieinstitutet.se/frontend',p:0,t:['YH','Modern webbutveckling','Hög anställningsgrad']},
   {n:'Webbutvecklare (distans)',school:'Jensen Yrkeshögskola',c:'other',f:'distance',pace:'fulltime',starts:['HT2026'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'12 veckor LIA',url:'https://jensen.se/webbutvecklare-distans',p:0,t:['YH','Distans','Flexibelt']}
 ],
 sc:{st:'Utvecklare på företag',ho:'Konsult / byter bolag',sp:'Arkitekt / specialist',le:'Tech lead / CTO'}},
{id:3,t:'Grundlärare',y:3.5,s0:34000,s1:40200,dem:5,ai:5,stress:4,future:4,tc:10000,req:['Matte 2a/b','Engelska 6','Svenska 3'],rp:['Samhäll','Naturvetenskap','Ekonomi','Teknik'],pp:['Estet','Vård'],
 sch:[
   {n:'Grundlärarprogrammet F-3',school:'Stockholms Universitet',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026'],length:'4 år (240 hp)',csn:true,fee:0,lang:'swedish',cutoff:15.2,vfu:'30 veckor VFU',url:'https://www.su.se/grundlarare',p:1.1,t:['Stor lärosäte','Bred metodikgrund']},
   {n:'Grundlärarprogrammet 4-6',school:'Göteborgs Universitet',c:'goteborg',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'4 år (240 hp)',csn:true,fee:0,lang:'swedish',cutoff:14.8,vfu:'30 veckor VFU',url:'https://www.gu.se/grundlarare',p:1.0,t:['Pedagogisk profil','Flexibla starter']},
   {n:'Grundlärarprogrammet',school:'Linköpings Universitet',c:'linkoping',f:'both',pace:'fulltime',starts:['HT2026'],length:'4 år (240 hp)',csn:true,fee:0,lang:'swedish',cutoff:13.5,vfu:'30 veckor VFU',url:'https://liu.se/grundlarare',p:.9,t:['Campus + Distans','Lägre krav']},
   {n:'Grundlärarprogrammet (distans)',school:'Högskolan Dalarna',c:'other',f:'distance',pace:'fulltime',starts:['HT2026','VT2027'],length:'4 år (240 hp)',csn:true,fee:0,lang:'swedish',cutoff:12.0,vfu:'30 veckor VFU',url:'https://du.se/grundlarare-distans',p:.6,t:['Distans','Nätbaserat','Flexibelt']},
   {n:'Grundlärarprogrammet',school:'Malmö Universitet',c:'malmo',f:'campus',pace:'fulltime',starts:['HT2026'],length:'4 år (240 hp)',csn:true,fee:0,lang:'swedish',cutoff:14.2,vfu:'30 veckor VFU',url:'https://mau.se/grundlarare',p:.95,t:['Mångfald','Praktik']}
 ],
 sc:{st:'Klassrumslärare',ho:'Byter skola / kommun',sp:'Förstelärare',le:'Rektor / skolledare'}},
{id:4,t:'Civilekonom',y:4,s0:34000,s1:52000,dem:3,ai:25,stress:3,future:3,tc:9000,req:['Matte 3c/4','Engelska 6'],rp:['Naturvetenskap','Teknik','Ekonomi'],pp:['Samhäll'],
 sch:[
   {n:'Civilekonomprogrammet',school:'Handelshögskolan Stockholm',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026'],length:'4 år (240 hp)',csn:true,fee:0,lang:'swedish',cutoff:22.5,vfu:'',url:'https://www.hhs.se/civilekonom',p:1.9,t:['#1 Sverige','Nätverk','Prestige']},
   {n:'Civilekonomprogrammet',school:'Handelshögskolan Göteborg',c:'goteborg',f:'campus',pace:'fulltime',starts:['HT2026'],length:'4 år (240 hp)',csn:true,fee:0,lang:'swedish',cutoff:21.0,vfu:'',url:'https://www.handels.gu.se/civilekonom',p:1.5,t:['Top 3','Internationellt']},
   {n:'Civilekonomprogrammet',school:'Uppsala Universitet',c:'uppsala',f:'campus',pace:'fulltime',starts:['HT2026'],length:'4 år (240 hp)',csn:true,fee:0,lang:'swedish',cutoff:19.8,vfu:'',url:'https://www.uu.se/civilekonom',p:1.3,t:['Tradition','Bred ekonomiutbildning']},
   {n:'Civilekonomprogrammet',school:'Örebro Universitet',c:'orebro',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'4 år (240 hp)',csn:true,fee:0,lang:'swedish',cutoff:17.5,vfu:'',url:'https://oru.se/civilekonom',p:.9,t:['Mindre klasser','Lägre krav']},
   {n:'Ekonomprogrammet',school:'Linnéuniversitetet',c:'other',f:'both',pace:'fulltime',starts:['HT2026','VT2027'],length:'3 år (180 hp)',csn:true,fee:0,lang:'swedish',cutoff:15.2,vfu:'',url:'https://lnu.se/ekonom',p:.75,t:['Distansmöjlighet','3-årigt alternativ']}
 ],
 sc:{st:'Controller / ekonom',ho:'Konsult / byter bransch',sp:'Finansanalytiker',le:'CFO / VD'}},
{id:5,t:'Civilingenjör Teknik',y:5,s0:38000,s1:58000,dem:4,ai:18,stress:2,future:5,tc:8000,req:['Matte 4','Fysik 2'],rp:['Naturvetenskap','Teknik'],pp:[],
 sch:[
   {n:'Civilingenjör Maskinteknik',school:'KTH',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026'],length:'5 år (300 hp)',csn:true,fee:0,lang:'swedish',cutoff:22.0,vfu:'',url:'https://www.kth.se/civ-maskin',p:1.7,t:['Top 3 Sverige','Forskning','Bred profil']},
   {n:'Civilingenjör Teknisk Fysik',school:'Chalmers',c:'goteborg',f:'campus',pace:'fulltime',starts:['HT2026'],length:'5 år (300 hp)',csn:true,fee:0,lang:'swedish',cutoff:21.5,vfu:'',url:'https://www.chalmers.se/teknisk-fysik',p:1.6,t:['Industrikontakter','Internationellt']},
   {n:'Civilingenjör Datateknik',school:'Lunds Tekniska Högskola',c:'lund',f:'campus',pace:'fulltime',starts:['HT2026'],length:'5 år (300 hp)',csn:true,fee:0,lang:'swedish',cutoff:21.0,vfu:'',url:'https://www.lth.se/datateknik',p:1.45,t:['LTH','IT-fokus']},
   {n:'Civilingenjör Elektroteknik',school:'Linköpings Universitet',c:'linkoping',f:'campus',pace:'fulltime',starts:['HT2026'],length:'5 år (300 hp)',csn:true,fee:0,lang:'swedish',cutoff:19.5,vfu:'',url:'https://liu.se/elektroteknik',p:1.35,t:['Innovation','Startup-kultur']}
 ],
 sc:{st:'Ingenjör på företag',ho:'Konsult / byter bransch',sp:'Teknisk specialist',le:'Engineering manager'}},
{id:51,t:'Civilingenjör Industriell ekonomi',y:5,s0:38000,s1:60000,dem:4,ai:12,stress:2,future:5,tc:8000,req:['Matte 4'],rp:['Naturvetenskap','Teknik','Ekonomi'],pp:['Samhäll','Ekonomi'],
 sch:[
   {n:'Civilingenjör Industriell ekonomi',school:'Linköpings Universitet',c:'linkoping',f:'campus',pace:'fulltime',starts:['HT2026'],length:'5 år (300 hp)',csn:true,fee:0,lang:'swedish',cutoff:20.5,vfu:'',url:'https://liu.se/industriell-ekonomi',p:1.5,t:['Ledning & teknik','Bred profil','Ej Fysik 2']},
   {n:'Civilingenjör Industriell ekonomi',school:'Chalmers',c:'goteborg',f:'campus',pace:'fulltime',starts:['HT2026'],length:'5 år (300 hp)',csn:true,fee:0,lang:'swedish',cutoff:20.0,vfu:'',url:'https://www.chalmers.se/industriell-ekonomi',p:1.45,t:['Industrikontakter','Göteborgsregionen']},
   {n:'Civilingenjör Samhällsbyggnad',school:'Luleå Tekniska Universitet',c:'other',f:'campus',pace:'fulltime',starts:['HT2026'],length:'5 år (300 hp)',csn:true,fee:0,lang:'swedish',cutoff:17.0,vfu:'',url:'https://ltu.se/samhallsbyggnad',p:.85,t:['Gruvindustri','Norra Sverige','Lägre krav']}
 ],
 sc:{st:'Teknisk chef / konsult',ho:'Affärsutvecklare',sp:'Projektledare',le:'VP / VD'}},
{id:6,t:'Socionom',y:3.5,s0:35000,s1:40300,dem:4,ai:10,stress:5,future:4,tc:10000,req:['Samhällskunskap 1b','Matte 1b/c'],rp:['Samhäll','Naturvetenskap','Ekonomi','Teknik','Vård'],pp:['Estet'],
 sch:[
   {n:'Socionomprogrammet',school:'Stockholms Universitet',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026'],length:'3,5 år (210 hp)',csn:true,fee:0,lang:'swedish',cutoff:16.5,vfu:'26 veckor VFU',url:'https://www.su.se/socionom',p:1.3,t:['Stor utbildning','Mångfald']},
   {n:'Socionomprogrammet',school:'Göteborgs Universitet',c:'goteborg',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'3,5 år (210 hp)',csn:true,fee:0,lang:'swedish',cutoff:15.8,vfu:'26 veckor VFU',url:'https://www.gu.se/socionom',p:1.2,t:['Socialt arbete','Bred praktik']},
   {n:'Socionomprogrammet',school:'Lunds Universitet',c:'lund',f:'campus',pace:'fulltime',starts:['HT2026'],length:'3,5 år (210 hp)',csn:true,fee:0,lang:'swedish',cutoff:15.5,vfu:'26 veckor VFU',url:'https://www.lunduniversity.lu.se/socionom',p:1.15,t:['Tradition','Forskning']},
   {n:'Socionomprogrammet (distans)',school:'Mittuniversitetet',c:'other',f:'distance',pace:'fulltime',starts:['HT2026','VT2027'],length:'3,5 år (210 hp)',csn:true,fee:0,lang:'swedish',cutoff:13.0,vfu:'26 veckor VFU',url:'https://www.miun.se/socionom-distans',p:.65,t:['Distans','Flexibelt','Lägre krav']},
   {n:'Socionomprogrammet',school:'Ersta Sköndal Bräcke högskola',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026'],length:'3,5 år (210 hp)',csn:true,fee:0,lang:'swedish',cutoff:14.2,vfu:'26 veckor VFU',url:'https://esh.se/socionom',p:.9,t:['Mindre skola','Personlig']}
 ],
 sc:{st:'Socialsekreterare',ho:'Byter kommun / verksamhet',sp:'Familjerätt / missbruk',le:'Enhetschef'}},
{id:7,t:'Elektriker (YH)',y:2,s0:30000,s1:37700,dem:5,ai:6,stress:3,future:5,tc:10000,req:['Matte 1a/b','Fysik 1a'],rp:['El och energi','Teknik','Naturvetenskap'],pp:['Bygg','Industri','Samhäll'],
 sch:[
   {n:'Elinstallation',school:'Yrgo',c:'goteborg',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'26 veckor LIA',url:'https://www.yrgo.se/elinstallation',p:0,t:['YH','50% praktik','Hög anställning']},
   {n:'Elektriker',school:'TUC Yrkeshögskola',c:'other',f:'campus',pace:'fulltime',starts:['HT2026'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'26 veckor LIA',url:'https://www.tucsweden.se/elektriker',p:0,t:['YH','Rikstäckande','Bred bas']},
   {n:'Elinstallatör',school:'Hermods',c:'other',f:'both',pace:'fulltime',starts:['HT2026','VT2027'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'26 veckor LIA',url:'https://www.hermods.se/elinstallator',p:0,t:['YH','Campus + Distans','Flexibelt']},
   {n:'Elektriker med inriktning automation',school:'Nackademin',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'20 veckor LIA',url:'https://nackademin.se/elektriker-automation',p:0,t:['YH','Automationsfokus','Stockholm']},
   {n:'Elektriker serviceteknik',school:'Jensen Yrkeshögskola',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'26 veckor LIA',url:'https://jensen.se/elektriker',p:0,t:['YH','Serviceinriktad','Praktik']}
 ],
 sc:{st:'Installationselektriker',ho:'Byter arbetsgivare / ort',sp:'Automationstekniker',le:'Arbetsledare / eget företag'}},
{id:8,t:'UX-designer (YH)',y:2,s0:32000,s1:48000,dem:3,ai:22,stress:2,future:3,tc:8000,req:['Grundläggande behörighet'],rp:['Samhäll','Naturvetenskap','Ekonomi','Teknik','Estet'],pp:[],
 sch:[
   {n:'UX-designer',school:'Nackademin',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'16 veckor LIA',url:'https://nackademin.se/ux-designer',p:0,t:['YH','Hög kvalitet','Industrikontakter']},
   {n:'UX/UI-designer',school:'Yrgo',c:'goteborg',f:'campus',pace:'fulltime',starts:['HT2026'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'16 veckor LIA',url:'https://www.yrgo.se/ux-ui',p:0,t:['YH','Design-fokus','Portfolio']},
   {n:'UX/UI-designer',school:'Changemaker Educations',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'16 veckor LIA',url:'https://www.changemaker.se/ux-ui',p:0,t:['YH','Startup-känsla','Modern']},
   {n:'Frontendutvecklare med UX',school:'Medieinstitutet',c:'stockholm',f:'campus',pace:'fulltime',starts:['HT2026','VT2027'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'16 veckor LIA',url:'https://medieinstitutet.se/ux-frontend',p:0,t:['YH','Kod + Design','Bred kompetens']},
   {n:'UX-designer (distans)',school:'Jensen Yrkeshögskola',c:'other',f:'distance',pace:'fulltime',starts:['HT2026'],length:'2 år (400 YH-poäng)',csn:true,fee:0,lang:'swedish',cutoff:null,vfu:'16 veckor LIA',url:'https://jensen.se/ux-designer-distans',p:0,t:['YH','Distans','Flexibelt']}
 ],
 sc:{st:'In-house UX',ho:'Konsult / frilans',sp:'UX Research / Design systems',le:'Head of Design'}}
];
const CIT={stockholm:7000,goteborg:5500,malmo:5000,uppsala:5500,linkoping:4500,lund:5500,umea:4000,orebro:4500,other:4500};
const HOU={student:.75,shared:.85,rental:1.2,home:0};
const FIX=5450,BID=4120,WR=150;
const GYM=[{id:'natur',l:'Naturvetenskap',k:'Naturvetenskap'},{id:'teknik',l:'Teknik',k:'Teknik'},{id:'samhall',l:'Samhäll',k:'Samhäll'},{id:'ekonomi',l:'Ekonomi',k:'Ekonomi'},{id:'estet',l:'Estet',k:'Estet'},{id:'vard',l:'Vård och omsorg',k:'Vård'},{id:'bygg',l:'Bygg och anläggning',k:'Bygg'},{id:'el',l:'El och energi',k:'El och energi'},{id:'industri',l:'Industri',k:'Industri'},{id:'other',l:'Annat / Komvux',k:'other'}];
let edu=null,sal=0,ws=0,ans={};

// ═══════════════════════════════════════
// DEV FUNCTION - SKIP TO PLAN
// ═══════════════════════════════════════
function devFillAndShowPlan() {
  // Set salary and education (Systemutvecklare = id:2)
  sal = 22000;
  edu = E.find(e => e.id === 2); // Systemutvecklare
  
  if (!edu) {
    alert('❌ DEV: Kunde inte hitta Systemutvecklare (id:2)');
    console.error('E array:', E);
    return;
  }
  
  // Fill all answers - test scenario: 35-åring, bor i Stockholm, bo kvar hemma, jobbar heltid
  ans = {
    user_name: 'Test Testsson',
    user_phone: '0701234567',
    current_location: 'Stockholm',
    willing_to_move: 'no',
    education_type: ['yh', 'uni'],
    study_pace: 'fulltime',
    study_mode: 'campus',
    when_start: 'next',
    duration: 'any',
    fee_ok: 'no',
    gym: 'te',  // Teknikprogrammet - ger full behörighet till Systemutvecklare
    has_grades: 'yes',
    age: '39',  // TEST 39-åring för att se alla personliga texter
    work_status: 'fulltime',
    need_csn: 'both',
    work_during: 'no',
    has_kids: 'no',
    has_partner: 'no',  // 'yes_same', 'no'
    housing: 'home',  // Bo kvar där jag bor
    fixed_expenses: '8000',
    variable_expenses: '4000',
    savings_amount: '10-50'
  };
  
  // Build and show the plan
  try {
    buildFP('Test');
    document.getElementById('fpDiv').classList.add('v');
    document.getElementById('fpDiv').style.display='block';
    
    // Scroll to plan
    setTimeout(() => {
      const fpDiv = document.getElementById('fpDiv');
      if (fpDiv) {
        window.scrollTo({top: fpDiv.offsetTop - 70, behavior: 'smooth'});
      }
    }, 200);
    
    console.log('✅ DEV: Test scenario loaded (35-åring)');
    console.log('  - Utbildning: Systemutvecklare (3 år)');
    console.log('  - Lön: 22000 kr → 36000 kr (startlön)');
    console.log('  - Ålder: 35-44 (39 år) - testar alla personliga motivationstexter');
    console.log('  - Behörighet: Teknikprogrammet = FULL behörighet');
    console.log('  - Boende: Stockholm, bo kvar hemma');
    console.log('  - CSN-skuld: 180 000 kr');
    console.log('Expected: Personliga exempel, AI-risk, åldersstatistik, resurslänkar');
    // Spara till localStorage efter lyckad planbygge
    try{localStorage.setItem('svg_answers',JSON.stringify(ans));localStorage.setItem('svg_sal',sal||0);localStorage.setItem('svg_edu',edu?edu.id:0);}catch(e){}
  } catch (error) {
    console.error('❌ DEV: Error building plan:', error);
    const le=document.getElementById('planLoader');
    if(le){le.style.opacity='0';setTimeout(()=>le.remove(),300);}
    document.body.style.overflow='';
    const pw=document.getElementById('pwOverlay');
    if(pw) pw.remove();
    // Show visible fallback
    let fb=document.getElementById('fpDiv');
    if(!fb){fb=document.querySelector('.fp');}
    if(fb){
      fb.style.display='block';
      fb.innerHTML=`<div style="padding:60px 24px;text-align:center;max-width:500px;margin:0 auto">
        <div style="font-size:2.5rem;margin-bottom:16px">⚠️</div>
        <h3 style="font-family:'DM Serif Display',serif;font-size:1.4rem;margin-bottom:12px;color:#1A1A18">Något gick fel</h3>
        <p style="color:#6c757d;font-size:.9rem;line-height:1.7;margin-bottom:24px">Vi kunde inte bygga din plan. Dina svar är sparade — klicka nedan för att försöka igen.</p>
        <button onclick="location.reload()" style="background:var(--ac);color:#fff;border:none;padding:14px 32px;border-radius:10px;font-family:inherit;font-weight:700;font-size:.95rem;cursor:pointer">Försök igen</button>
        <p style="font-size:.72rem;color:#bbb;margin-top:16px">${error.message||'Okänt fel'}</p>
      </div>`;
    }
  }
}

const fmt=n=>n.toLocaleString('sv-SE');

function printPlan(){
    document.querySelectorAll('.pnl').forEach(p=>{p.style.display='block'});
    document.getElementById('planTabs').style.display='none';
    window.print();
    setTimeout(()=>{
        document.querySelectorAll('.pnl').forEach((p,i)=>{if(i>0)p.style.display='none'});
        document.getElementById('planTabs').style.display='';
    },1500);
}

// Init
document.addEventListener('DOMContentLoaded',function(){
    // Standalone wizard – starta direkt
    ws=0;
    ans={};
    renderW();
});

// Step 1
function calcG(){
    sal=parseInt(document.getElementById('inSal').value)||0;
    const eid=parseInt(document.getElementById('inEdu').value);
    if(!sal||!eid){alert('Fyll i din lön och välj utbildning.');return}
    edu=E.find(e=>e.id===eid);
    const e=edu,bo=e.s0-sal,mo=Math.round(e.y*10),de=e.tc*mo,op=sal*12*e.y,yg=bo*12,be=yg>0?Math.ceil((op+de)/yg):0;
    document.getElementById('gvB').textContent=(bo>=0?'+':'')+fmt(bo)+' kr/mån';
    document.getElementById('gvD').textContent=Math.round(de/1000)+' tkr';
    document.getElementById('gvBE').textContent=be>0&&be<50?'~'+be+' år':'—';
    const em=document.getElementById('vE'),tx=document.getElementById('vT');
    if(bo>5000){em.innerHTML='<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--ac)" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>';tx.innerHTML='Med din lön på <strong>'+fmt(sal)+' kr</strong> och en '+e.t.toLowerCase()+'-utbildning är ingångslönen <strong>'+fmt(bo)+' kr/mån</strong> högre. Mot lönetoppen (+'+fmt(e.s1-sal)+' kr/mån) tar det 3–7 år.';}
    else if(bo>0){em.innerHTML='<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--bl)" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>';tx.innerHTML='Ingångslönen är jämförbar, men lönetoppen på <strong>'+fmt(e.s1)+' kr</strong> (+'+fmt(e.s1-sal)+' kr) nås inom 5–10 år.';}
    else if(bo>-3000){em.innerHTML='<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--wa)" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg>';tx.innerHTML='Ingångslönen liknar din nuvarande. Men lönetaket (<strong>'+fmt(e.s1)+' kr</strong>) och arbetsvillkoren förändras.';}
    else{em.innerHTML='<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--re)" stroke-width="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>';tx.innerHTML='Du tjänar redan mer. Ekonomiskt tar det tid. Men livskvalitet kan vara värt mer än kronor.';}
    document.getElementById('secR').classList.add('v');
    setTimeout(()=>document.getElementById('secR').scrollIntoView({behavior:'smooth'}),100);
    document.querySelectorAll('.gc').forEach((c,i)=>setTimeout(()=>c.classList.add('sh2'),200+i*150));
    setTimeout(()=>document.getElementById('verd').classList.add('sh2'),800);
    buildInfoCards(e);
    buildProsAndCons(e);
    buildSalaryInfo(e);
    buildLifetimeAnalysis(e);
}

function buildInfoCards(e){
    const demL=['','Mycket låg','Låg','Medel','Hög','Mycket hög'];
    const strL=['','Mycket låg','Låg','Medel','Hög','Mycket hög'];
    const futL=['','Mycket svag','Svag','Stabil','God','Mycket god'];
    const demC=['','var(--re)','var(--wa)','var(--bl)','var(--ac)','var(--ac)'];
    const strC=['','var(--ac)','var(--ac)','var(--wa)','var(--re)','var(--re)'];
    const futC=['','var(--re)','var(--wa)','var(--bl)','var(--ac)','var(--ac)'];
    const demDesc={1:'Få lediga tjänster och hög konkurrens.',2:'Begränsat antal tjänster. Kan ta tid.',3:'Balanserad arbetsmarknad.',4:'Arbetsgivare söker aktivt. Goda chanser.',5:'Akut brist. Nästan garanterat jobb direkt.'};
    const strDesc={1:'Lugn miljö med god balans.',2:'Hanterbar belastning, stressigt ibland.',3:'Omväxlande tempo, generellt balanserat.',4:'Hög belastning och tidpress regelbundet.',5:'Konstant högt tryck. Hög personalomsättning.'};
    const futDesc={1:'Branschen krymper. Jobben minskar.',2:'Osäker framtid, risk för omställning.',3:'Stabil bransch utan stora förändringar.',4:'Växande bransch med ökande behov.',5:'Mycket stark tillväxt. AI-risk: '+e.ai+'%.'};

    const gvDem=document.getElementById('gvDem');
    const gvStr=document.getElementById('gvStr');
    const gvFut=document.getElementById('gvFut');
    gvDem.textContent=demL[e.dem];gvDem.style.color=demC[e.dem];
    gvStr.textContent=e.ai+'%';gvStr.style.color=e.ai>30?'var(--re)':e.ai>15?'var(--wa)':'var(--ac)';
    gvFut.textContent=futL[e.future];gvFut.style.color=futC[e.future];

    document.getElementById('gc4').querySelector('.gl').style.color=demC[e.dem];
    document.getElementById('gc5').querySelector('.gl').style.color=strC[e.stress];
    document.getElementById('gc6').querySelector('.gl').style.color=futC[e.future];

    document.getElementById('gceDem').innerHTML=`<div class="gcexp-inner"><p>${demDesc[e.dem]}</p><div class="gcbar"><div class="gcfill" style="width:${e.dem*20}%;background:${demC[e.dem]}"></div></div><div class="gcmeta"><span>Låg</span><span>Mycket hög</span></div></div>`;
    document.getElementById('gceStr').innerHTML=`<div class="gcexp-inner"><p>${strDesc[e.stress]}</p><div class="gcbar"><div class="gcfill" style="width:${e.stress*20}%;background:${strC[e.stress]}"></div></div><div class="gcmeta"><span>Lugnt</span><span>Mycket hög</span></div></div>`;
    document.getElementById('gceFut').innerHTML=`<div class="gcexp-inner"><p>${futDesc[e.future]}</p><div class="gcbar"><div class="gcfill" style="width:${e.future*20}%;background:${futC[e.future]}"></div></div><div class="gcmeta"><span>Svag</span><span>Mycket god</span></div></div>`;
}

function toggleGC(el){el.classList.toggle('open')}

const PN={
1:{pro:['Nästan 100% anställningsbarhet — akut brist i hela landet','OB-tillägg för kvällar, nätter och helger höjer faktisk lön','Möjlighet att specialisera sig (IVA, ambulans, barnmorska) med lönepåslag','Offentlig anställning med kollektivavtal, tjänstepension och full semester'],con:['Schemaarbete med nätter, helger och röda dagar','Jour och beredskap kan krävas beroende på avdelning','Hög personalomsättning inom vissa specialiteter','Lönetak — begränsad löneutveckling utan chefsroll eller vidareutbildning']},
2:{pro:['36 000 kr ingångslön med snabb stegring till 55 000+','Remote-arbete standard — de flesta tjänster tillåter hemifrån','Konsultuppdrag kan ge 50–80% högre timpris än fast anställning','Kort utbildning (3 år) relativt lönenivån'],con:['15% AI-automatiseringsrisk — rutinkodning ersätts redan','Kräver ständig vidareutbildning vid teknikskiften','Internationell konkurrens pressar löner i vissa segment','Konsultmarknaden svänger kraftigt med konjunkturen']},
3:{pro:['13 veckors sammanhängande ledighet (lov) utöver semester','Jobb i alla kommuner — ingen geografisk begränsning','Lönetillägg som förstelärare (+5 000 kr/mån)','Statliga studielånsavskrivningar för lärare i bristämnen'],con:['Hög administrativ börda — dokumentation, åtgärdsprogram, omdömen','Stor lärarbrist leder till högre arbetsbelastning per lärare','Lönetak runt 41 000 kr utan skolledarroll','Begränsad karriärstege — förstelärare eller rektor är i princip enda stegen']},
4:{pro:['Bred arbetsmarknad — bank, revision, konsult, industri, startup','Lönetak på 52 000+ kr, betydligt högre inom finans','Internationellt gångbar examen med möjlighet till utlandstjänst','Starkt alumninätverk, särskilt från handelshögskolorna'],con:['25% AI-automatiseringsrisk — analys- och rapportarbete ersätts','Hård konkurrens om trainee- och graduate-platser','Långa arbetsdagar norm inom revision och investment banking','Stor variation i lön beroende på bransch och stad']},
5:{pro:['Högst ingångslön av alla utbildningar (38 000 kr)','Lönetak på 58 000+ kr, högre i chefsroll','Bred anställningsbarhet — tech, energi, fordon, bygg, försvar','Stark internationell efterfrågan på svensk ingenjörskompetens'],con:['5 års utbildningstid — längst av alla alternativ','Hög studietakt med matematik, fysik och kemi','18% AI-risk — simulering och beräkningsarbete automatiseras','Kräver ofta flytt till storstadsregion för bästa tjänsterna']},
6:{pro:['Stor efterfrågan — kommuner har svårt att rekrytera socialsekreterare','Bred arbetsmarknad: socialtjänst, kriminalvård, migration, skola','Offentlig anställning med kollektivavtal och tjänstepension','Relativt kort utbildning (3,5 år) med praktik (VFU)'],con:['Högst personalomsättning inom socialtjänsten — snitt 2–3 år','Tunga myndighetsutövningsbeslut (LVU, tvångsomhändertaganden)','Lägst ingångslön av alla högskoleutbildningar i listan (30 000 kr)','Hög sjukfrånvaro i branschen jämfört med andra yrken']},
7:{pro:['Mycket hög efterfrågan — elektrikerbrist i hela landet','Kort utbildning (2 år) med 50% praktik på företag','Snabb löneutveckling med certifikat och behörigheter','Möjlighet till eget företag med relativt låg startkostnad'],con:['Jour och beredskap krävs, även helger och kvällar','Fysiskt krävande med arbete i trånga utrymmen och höjder','Elsäkerhetsrisker — strikt reglerat med personligt ansvar','Konjunkturkänsligt — byggsektorn styr efterfrågan']},
8:{pro:['32 000 kr ingångslön med potential upp till 48 000+','Kort utbildning (2 år YH) med praktik på riktiga företag','Remote och frilans vanligt — hög geografisk flexibilitet','Tvärfunktionell roll som fungerar i de flesta branscher'],con:['22% AI-risk — designverktyg automatiserar allt mer','Stor konkurrens om juniora tjänster efter examen','Ofta bland de första som sägs upp vid nedskärningar','Svårt att kvantifiera affärsvärde — budgeten skärs lätt ned']},
51:{pro:['Högst lönepotential i listan — 60 000 kr och uppåt','Kombinerar ingenjörskunskap med företagsledning — bred arbetsmarknad','Ledande positioner inom industri, konsult och tech','Starkt alumninätverk vid Chalmers, LiTH och KTH'],con:['5 års utbildningstid — långt åtagande','Kräver Matte 4 — ofta komplettering via Komvux','Konkurrens om de bästa traineepositionerna är hård','Lön kan variera kraftigt beroende på bransch och region']}
};

function buildProsAndCons(e){
    const d=PN[e.id];if(!d)return;
    const chk='<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>';
    const cross='<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';
    let h=`<div class="pnbox pnpro"><div class="pnhead"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>Fördelar</div><div class="pnlist">`;
    d.pro.forEach(p=>{h+=`<div class="pnitem">${chk}<span>${p}</span></div>`});
    h+=`</div></div><div class="pnbox pncon"><div class="pnhead"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Nackdelar</div><div class="pnlist">`;
    d.con.forEach(c=>{h+=`<div class="pnitem">${cross}<span>${c}</span></div>`});
    h+=`</div></div>`;
    document.getElementById('pnCont').innerHTML=h;
    document.querySelectorAll('.pnbox').forEach((b,i)=>setTimeout(()=>b.classList.add('sh2'),900+i*150));
}

function buildSalaryInfo(e){
    // Beräkna medellön (genomsnitt av start och max)
    const avgSalary=Math.round((e.s0+e.s1)/2);
    // Medianlön (approximativt mitt-lönen efter några års erfarenhet)
    const medianSalary=Math.round(e.s0+(e.s1-e.s0)*0.4);
    // Spridning (skillnad mellan min och max)
    const spread=e.s1-e.s0;
    const spreadPct=Math.round((spread/e.s0)*100);
    
    // Karriärscenarier
    const scenarios=[
        {label:'Stanna länge',desc:'10-15 år på samma arbetsplats',salary:Math.round(e.s0+(e.s1-e.s0)*0.5),color:'#6c757d'},
        {label:'Byta ofta',desc:'5-10 byten av arbetsgivare',salary:Math.round(e.s0+(e.s1-e.s0)*0.7),color:'#0dcaf0'},
        {label:'Specialist',desc:'Expertroll utan chefsansvar',salary:Math.round(e.s1*1.1),color:'#0d6efd'},
        {label:'Chef',desc:'Ledande position',salary:Math.round(e.s1*1.3),color:'#198754'}
    ];
    const maxSalary=Math.max(...scenarios.map(s=>s.salary));
    
    let h=`
    <button onclick="const d=document.getElementById('salaryExpand');const open=d.style.display!=='none';d.style.display=open?'none':'block';this.textContent=open?'Visa lönespridning ↓':'Dölj lönespridning ↑'" 
    style="width:100%;padding:14px;background:linear-gradient(135deg,var(--ac),var(--ah));color:#fff;border:none;border-radius:12px;font-weight:700;font-size:.95rem;cursor:pointer;transition:transform .2s;max-width:720px;display:block;margin:0 auto 0;font-family:inherit"
    onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        Visa lönespridning ↓
    </button>
    <div id="salaryExpand" style="display:none;max-width:720px;margin:0 auto">
    <div class="verd sh2" style="animation-delay:.7s;text-align:left;padding:24px 20px;margin-top:12px">
<div style="text-align:center;margin-bottom:20px">
        <svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="var(--ac)" stroke-width="2" style="margin:0 auto 10px">
          <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
          <polyline points="17 6 23 6 23 12"/>
        </svg>
        <h3 style="font-family:'DM Serif Display',serif;font-size:1.4rem;margin-bottom:6px">Lönespridning för ${e.t.toLowerCase()}</h3>
        <p style="color:var(--mu);font-size:.85rem">Baserat på SCB Lönestrukturstatistik 2024</p>
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:18px">
        <div style="padding:16px;background:var(--al);border-radius:12px;border:2px solid var(--ac)">
          <div style="font-size:.75rem;font-weight:700;color:var(--ac);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">Startlön</div>
          <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;color:var(--ac);margin-bottom:4px">${fmt(e.s0)} kr</div>
          <div style="font-size:.8rem;color:var(--mu)">Efter examen</div>
        </div>
        
        <div style="padding:16px;background:#f8f9fa;border-radius:12px;border:2px solid #dee2e6">
          <div style="font-size:.75rem;font-weight:700;color:#495057;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">Medellön</div>
          <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;color:#212529;margin-bottom:4px">${fmt(avgSalary)} kr</div>
          <div style="font-size:.8rem;color:var(--mu)">Genomsnitt i yrket</div>
        </div>
        
        <div style="padding:16px;background:#f8f9fa;border-radius:12px;border:2px solid #dee2e6">
          <div style="font-size:.75rem;font-weight:700;color:#495057;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">Medianlön</div>
          <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;color:#212529;margin-bottom:4px">${fmt(medianSalary)} kr</div>
          <div style="font-size:.8rem;color:var(--mu)">50% tjänar mer</div>
        </div>
        
        <div style="padding:16px;background:var(--al);border-radius:12px;border:2px solid var(--ac)">
          <div style="font-size:.75rem;font-weight:700;color:var(--ac);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">Erfaren</div>
          <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;color:var(--ac);margin-bottom:4px">${fmt(e.s1)} kr</div>
          <div style="font-size:.8rem;color:var(--mu)">Efter 10-15 år</div>
        </div>
      </div>
      
      <div style="padding:20px;background:#fff;border-radius:12px;border:1px solid var(--bo)">
        <div style="font-weight:700;margin-bottom:12px;font-size:1.05rem">Lönespridning: ${fmt(spread)} kr (+${spreadPct}%)</div>
        <div style="background:#e0e0d8;height:8px;border-radius:10px;overflow:hidden">
          <div style="background:linear-gradient(90deg,var(--ac),var(--ac));height:100%;width:100%;position:relative">
            <div style="position:absolute;left:0;top:-24px;font-size:.75rem;font-weight:600;color:var(--ac)">${fmt(e.s0)} kr</div>
            <div style="position:absolute;right:0;top:-24px;font-size:.75rem;font-weight:600;color:var(--ac)">${fmt(e.s1)} kr</div>
          </div>
        </div>
        <div style="font-size:.85rem;color:var(--mu);margin-top:16px">
          <strong>Vad påverkar lönen?</strong> Erfarenhet, arbetsgivare, förhandling, specialisering och chefsansvar.
        </div>
      </div>
      
      <!-- Expanderbar karriärscenarier -->
      <button onclick="document.getElementById('scenariosExpand').style.display=document.getElementById('scenariosExpand').style.display==='none'?'block':'none';this.innerHTML=document.getElementById('scenariosExpand').style.display==='none'?'Visa karriärscenarier ↓':'Dölj karriärscenarier ↑'" style="width:100%;margin-top:16px;padding:14px;background:linear-gradient(135deg,var(--ac),var(--ah));color:#fff;border:none;border-radius:12px;font-weight:700;font-size:.95rem;cursor:pointer;transition:transform .2s" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        Visa karriärscenarier ↓
      </button>
      
      <div id="scenariosExpand" style="display:none;margin-top:16px;padding:20px;background:#f8f9fa;border-radius:12px">
        <h4 style="font-weight:700;margin-bottom:14px;font-size:1.05rem;color:var(--ac)">Olika vägar ger olika löner efter 10-15 år</h4>
        <div style="display:grid;gap:12px">`;
    
    scenarios.forEach(sc=>{
        const widthPct=(sc.salary/maxSalary)*100;
        const diff=sc.salary-e.s0;
        const diffPct=Math.round((diff/e.s0)*100);
        
        h+=`
        <div style="padding:14px;background:#fff;border-radius:10px;border:1px solid var(--bo)">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div>
              <div style="font-weight:700;font-size:.9rem">${sc.label}</div>
              <div style="font-size:.75rem;color:var(--mu)">${sc.desc}</div>
            </div>
            <div style="text-align:right">
              <div style="font-family:'DM Serif Display',serif;font-size:1.2rem;color:${sc.color}">${fmt(sc.salary)} kr</div>
              <div style="font-size:.7rem;color:var(--mu)">+${diffPct}%</div>
            </div>
          </div>
          <div style="background:#e9ecef;height:28px;border-radius:6px;overflow:hidden;position:relative">
            <div style="background:${sc.color};height:100%;width:${widthPct}%;transition:width 1s ease;display:flex;align-items:center;justify-content:flex-end;padding-right:8px">
              <span style="color:#fff;font-weight:600;font-size:.8rem">${Math.round(widthPct)}%</span>
            </div>
          </div>
        </div>`;
    });
    
    h+=`
        </div>
        <div style="margin-top:16px;padding:14px;background:#fff;border-radius:8px;font-size:.8rem;color:var(--mu);border-left:3px solid var(--ac)">
          <strong style="color:var(--ac)">Tips:</strong> Att byta jobb var 3-5:e år ger ofta högre löneutveckling än att stanna kvar.
        </div>
      </div>
      
      <!-- Expanderbar livstidsanalys -->
      <button onclick="document.getElementById('lifetimeExpand').style.display=document.getElementById('lifetimeExpand').style.display==='none'?'block':'none';this.innerHTML=document.getElementById('lifetimeExpand').style.display==='none'?'Visa livstidsanalys ↓':'Dölj livstidsanalys ↑'" style="width:100%;margin-top:16px;padding:14px;background:linear-gradient(135deg,#5a8a6e,var(--ac));color:#fff;border:none;border-radius:12px;font-weight:700;font-size:.95rem;cursor:pointer;transition:transform .2s" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        Visa livstidsanalys ↓
      </button>
      
      <div id="lifetimeExpand" style="display:none;margin-top:16px;padding:20px;background:#f8f9fa;border-radius:12px">
        <h4 style="font-weight:700;margin-bottom:14px;font-size:1.05rem;color:var(--ac)">Jämförelse över 40 års arbetsliv</h4>
        <div id="lifetimeChart"></div>
        <div style="margin-top:14px;padding:12px;background:#fff;border-radius:8px;font-size:.75rem;color:var(--mu);border-left:3px solid var(--ac)">
          <strong style="color:var(--ac)">OBS:</strong> Förenklad kalkyl utan hänsyn till inflation, löneökningar eller skatter.
        </div>
      </div>
        </div>
    </div>`;

    document.getElementById('salaryInfo').innerHTML=h;
}


function buildLifetimeAnalysis(e){
    const workYears=40;
    const studyYears=e.y;
    
    // Scenario 1: Fortsätt med nuvarande jobb
    const currentTotal=(sal*12*workYears)/1000000;
    
    // Scenario 2: Plugga först, sedan nytt yrke
    const lostIncome=sal*12*studyYears;
    const debt=e.tc*Math.round(studyYears*10);
    const newJobYears=workYears-studyYears;
    const newJobIncome=(e.s0*12*newJobYears)/1000000;
    const studyCost=(lostIncome+debt)/1000000;
    const newTotal=newJobIncome-studyCost;
    
    // Skillnad
    const diff=newTotal-currentTotal;
    const diffAbs=Math.abs(diff);
    
    // Maxvärde för skalning
    const maxVal=Math.max(currentTotal,newTotal);
    const currentPct=(currentTotal/maxVal)*100;
    const newPct=(newTotal/maxVal)*100;
    
    // Färgkodning
    const betterColor=diff>0?'var(--ac)':'var(--re)';
    const worseColor=diff>0?'var(--re)':'var(--ac)';
    
    let h=`
    <div style="margin-bottom:28px">
      <div style="display:grid;gap:20px">
        <!-- Nuvarande yrke -->
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="font-size:.82rem;font-weight:600;color:var(--mu)">Fortsätt med nuvarande jobb</div>
            <div style="font-size:1.1rem;font-weight:700;color:${diff<=0?betterColor:worseColor}">${currentTotal.toFixed(1)} M kr</div>
          </div>
          <div style="height:36px;background:var(--bo);border-radius:8px;overflow:hidden;position:relative">
            <div style="height:100%;background:${diff<=0?betterColor:worseColor};width:${currentPct}%;transition:width 1s ease;border-radius:8px"></div>
          </div>
          <div style="font-size:.72rem;color:var(--li);margin-top:4px">${sal.toLocaleString('sv-SE')} kr/mån × ${workYears} år</div>
        </div>
        
        <!-- Nytt yrke -->
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="font-size:.82rem;font-weight:600;color:var(--mu)">Plugga till ${e.t.toLowerCase()}</div>
            <div style="font-size:1.1rem;font-weight:700;color:${diff>0?betterColor:worseColor}">${newTotal.toFixed(1)} M kr</div>
          </div>
          <div style="height:36px;background:var(--bo);border-radius:8px;overflow:hidden;position:relative">
            <div style="height:100%;background:${diff>0?betterColor:worseColor};width:${newPct}%;transition:width 1s ease .3s;border-radius:8px"></div>
          </div>
          <div style="font-size:.72rem;color:var(--li);margin-top:4px">${e.s0.toLocaleString('sv-SE')} kr/mån × ${newJobYears} år − studiekostnad (${studyCost.toFixed(1)} M kr)</div>
        </div>
      </div>
    </div>
    
    <!-- Skillnadsruta -->
    <div style="background:${diff>0?'var(--al)':'var(--rl)'};border:2px solid ${diff>0?'var(--ac)':'var(--re)'};border-radius:12px;padding:20px;text-align:center">
      <div style="font-size:.78rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:${diff>0?'var(--ac)':'var(--re)'};margin-bottom:6px">
        ${diff>0?'Livstidsvinst':'Livstidsförlust'}
      </div>
      <div style="font-family:'DM Serif Display',serif;font-size:2rem;color:${diff>0?'var(--ac)':'var(--re)'};margin-bottom:6px">
        ${diff>0?'+':'−'}${diffAbs.toFixed(1)} M kr
      </div>
      <div style="font-size:.85rem;color:${diff>0?'var(--ac)':'var(--re)'};opacity:.85">
        ${diff>0?'Att plugga ger dig totalt '+diffAbs.toFixed(1)+' miljoner mer över 40 år':'Med nuvarande lön tjänar du '+diffAbs.toFixed(1)+' miljoner mer över 40 år'}
      </div>
    </div>`;
    
    document.getElementById('lifetimeChart').innerHTML=h;
}

function buildTeaser(){
    const e=edu,netNow=Math.round(sal*0.7);
    const debt=Math.round(e.y*10*6000);
    const monthlySave=netNow-(BID+6000);

    document.getElementById('tOverH').textContent='Din väg till '+e.t.toLowerCase()+' — klar om '+e.y+' år';
    document.getElementById('tOverP').textContent='Vi har räknat på just din situation. Svara på några frågor så låser vi upp hela planen.';

    document.getElementById('tBl').innerHTML=`
    <div style="margin-bottom:14px">
    <div style="background:linear-gradient(135deg,var(--ac),var(--ah));border-radius:12px;padding:20px;color:#fff">
    <div style="font-family:'DM Serif Display',serif;font-size:1.15rem;margin-bottom:6px">Du, ${Math.round(sal/1000)}k/mån — ${e.t} om ${e.y} år</div>
    <div style="opacity:.85;font-size:.84rem">Lön idag: ${fmt(sal)} kr → Ingångslön: ${fmt(e.s0)} kr (+${fmt(e.s0-sal)} kr/mån)</div>
    </div></div>

    <div style="margin-bottom:14px">
    <div class="tsec-head"><div class="tn" style="background:var(--ac)">1</div>Din behörighet</div>
    </div>
    <div style="margin-bottom:14px">
    <div style="padding:14px;border-radius:8px;border:2px solid var(--ac);background:var(--al)">
    <div style="font-weight:700;font-size:.9rem;color:var(--ac)">Behörig? Vi kollar dina kurser mot programmets krav.</div>
    <div style="font-size:.82rem;color:var(--mu);margin-top:4px">${e.req.join(' · ')}</div>
    </div></div>

    <div style="margin-bottom:14px">
    <div class="tsec-head"><div class="tn" style="background:var(--re)">2</div>Din ekonomi under studietiden</div>
    </div>
    <div style="margin-bottom:14px">
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#f5f5f0;border-radius:8px">
    <span style="font-size:.84rem">Din bruttolön idag</span><span style="font-weight:700">${fmt(netNow)} kr</span>
    </div></div>
    <div style="margin-bottom:14px;margin-top:6px">
    <div style="display:flex;justify-content:space-between;padding:12px;background:var(--bll);border-radius:8px">
    <span style="font-size:.84rem">Studentinkomst (CSN + jobb)</span><span style="font-weight:700;color:var(--bl)">${fmt(BID+6000)} kr</span>
    </div></div>
    <div style="margin-bottom:14px;margin-top:6px">
    <div style="padding:14px;background:var(--al);border-radius:8px;text-align:center;font-weight:700;color:var(--ac)">
    ${monthlySave>0?'Du tappar '+fmt(monthlySave)+' kr/mån — men vi visar hur det fungerar':'Din studentinkomst täcker mer än du tror'}
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px">
    <div style="background:var(--rl);padding:12px;border-radius:8px;text-align:center"><div style="font-size:.65rem;font-weight:700;color:var(--re);text-transform:uppercase">Total skuld</div><div style="font-family:'DM Serif Display';font-size:1rem;color:var(--re)">${fmt(debt)} kr</div></div>
    <div style="background:var(--wl);padding:12px;border-radius:8px;text-align:center"><div style="font-size:.65rem;font-weight:700;color:#92400e;text-transform:uppercase">Kvar/mån</div><div style="font-family:'DM Serif Display';font-size:1rem;color:#92400e">? kr</div></div>
    <div style="background:var(--al);padding:12px;border-radius:8px;text-align:center"><div style="font-size:.65rem;font-weight:700;color:var(--ac);text-transform:uppercase">Break-even</div><div style="font-family:'DM Serif Display';font-size:1rem;color:var(--ac)">? år</div></div>
    </div></div>

    <div style="margin-bottom:14px;margin-top:8px">
    <div class="tsec-head"><div class="tn" style="background:var(--wa)">3</div>Din handlingsplan</div>
    </div>
    <div style="margin-bottom:14px">
    <div style="display:flex;gap:12px;margin-bottom:10px"><div style="width:28px;height:28px;border-radius:50%;background:var(--ac);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem;flex-shrink:0">1</div><div><div style="font-weight:700;font-size:.88rem">Kontrollera dina betyg</div><div style="font-size:.78rem;color:var(--ac)">Denna vecka</div></div></div>
    <div style="display:flex;gap:12px;margin-bottom:10px"><div style="width:28px;height:28px;border-radius:50%;background:var(--ac);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem;flex-shrink:0">2</div><div><div style="font-weight:700;font-size:.88rem">Ansök till programmet</div><div style="font-size:.78rem;color:var(--ac)">Senast 15 april</div></div></div>
    <div style="display:flex;gap:12px"><div style="width:28px;height:28px;border-radius:50%;background:var(--ac);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem;flex-shrink:0">3</div><div><div style="font-weight:700;font-size:.88rem">Studiestart — ${e.t}</div><div style="font-size:.78rem;color:var(--ac)">Hösten ${new Date().getFullYear()+(new Date().getMonth()<5?0:1)}</div></div></div>
    </div>

    <div style="margin-bottom:60px">
    <div style="display:grid;gap:6px">
    <div style="background:#f5f5f0;padding:10px 12px;border-radius:8px;display:flex;justify-content:space-between"><span>Checklista: 3 saker att göra imorgon</span><span style="font-weight:700">→</span></div>
    <div style="background:#f5f5f0;padding:10px 12px;border-radius:8px;display:flex;justify-content:space-between"><span>Skolor som matchar dig</span><span style="font-weight:700">→</span></div>
    <div style="background:#f5f5f0;padding:10px 12px;border-radius:8px;display:flex;justify-content:space-between"><span>Boka samtal med yrkesperson</span><span style="font-weight:700">→</span></div>
    </div></div>`;
}

// Wizard
const QS=[
    // Del 1 – Studiepreferenser
    {id:'current_location',t:'Var bor du idag?',w:'Hjälper oss beräkna boendekostnader och pendling.',tp:'text',ph:'T.ex. Stockholm, Göteborg...'},
    {id:'education_type',t:'Vilken utbildningsform söker du?',w:'Välj en eller flera alternativ.',tp:'multi',opts:[{v:'yh',l:'Yrkeshögskola (YH)'},{v:'uni',l:'Högskola / Universitet'},{v:'komvux',l:'Komvux'},{v:'folk',l:'Folkhögskola'},{v:'private',l:'Privat utbildning'},{v:'any',l:'Spelar ingen roll'}]},
    {id:'study_pace',t:'Vilken studietakt passar dig?',w:'Avgör om du kan arbeta samtidigt.',tp:'opts',opts:[{v:'fulltime',l:'Heltid'},{v:'parttime',l:'Deltid'},{v:'flexible',l:'Flexibel'},{v:'any',l:'Spelar ingen roll'}]},
    {id:'study_mode',t:'Hur vill du studera?',w:'Påverkar dina studiealternativ.',tp:'opts',opts:[{v:'campus',l:'På plats'},{v:'distance',l:'Distans'},{v:'hybrid',l:'Hybrid'},{v:'any',l:'Spelar ingen roll'}]},
    {id:'willing_to_move',t:'Är du villig att flytta för studier?',w:'Påverkar vilka skolor som passar dig.',tp:'opts',cond:()=>ans.study_mode!=='distance',opts:[{v:'yes',l:'Ja'},{v:'no',l:'Nej'},{v:'commute',l:'Pendlingsavstånd'}]},
    {id:'when_start',t:'När vill du börja studera?',w:'Styr tidslinjen i din plan.',tp:'opts',opts:[{v:'asap',l:'Så snart som möjligt'},{v:'next',l:'Nästa termin'},{v:'6mo',l:'Inom 6 månader'},{v:'12mo',l:'Inom 12 månader'},{v:'any',l:'Spelar ingen roll'}]},
    {id:'duration',t:'Hur lång utbildning är du beredd att gå?',w:'Filtrerar bort för långa program.',tp:'opts',opts:[{v:'short',l:'Kortare än 6 månader'},{v:'6to12',l:'6–12 månader'},{v:'1to2',l:'1–2 år'},{v:'3plus',l:'3 år eller längre'},{v:'any',l:'Spelar ingen roll'}]},
    {id:'fee_ok',t:'Är du öppen för avgiftsbelagda utbildningar?',w:'Privata YH och utbildningar kan kosta.',tp:'opts',opts:[{v:'yes',l:'Ja'},{v:'no',l:'Nej'},{v:'unsure',l:'Osäker'}]},

    // Del 2 – Behörighet
    {id:'gym',t:'Vilket gymnasieprogram gick du?',w:'Avgör om du har rätt behörighet eller behöver komplettera.',tp:'opts',opts:GYM.map(g=>({v:g.id,l:g.l}))},
    {id:'has_grades',t:'Har du fullständiga gymnasiebetyg?',w:'Avgör om du kan söka direkt.',tp:'opts',opts:[{v:'yes',l:'Ja'},{v:'no',l:'Nej'},{v:'unsure',l:'Osäker'}]},
    {id:'hp_considered',t:'Har du skrivit Högskoleprov (HP)?',w:'Ange ditt verbala och kvantitativa delbetyg (t.ex. 1.4, 1.6). Om du inte har skrivit klickar du Nej.',tp:'hp'},

    // Del 3 – Nuvarande situation
    {id:'age',t:'Hur gammal är du?',w:'Påverkar skuldfri ålder och livstidsberäkning.',tp:'input',ph:'T.ex. 29',inputType:'number',min:18,max:70},
    {id:'work_status',t:'Arbetar du idag?',w:'Avgör om du tappar inkomst under studier.',tp:'opts',opts:[{v:'fulltime',l:'Heltid'},{v:'parttime',l:'Deltid'},{v:'hourly',l:'Timanställd'},{v:'unemployed',l:'Arbetssökande'},{v:'other',l:'Annat'}]},
    {id:'need_csn',t:'Kommer du behöva studiestöd från CSN under utbildningen?',w:'Avgör din studentbudget.',tp:'opts',opts:[{v:'both',l:'Ja, bidrag och lån'},{v:'grant',l:'Endast bidrag'},{v:'no',l:'Nej'},{v:'unsure',l:'Osäker'}]},
    {id:'work_during',t:'Planerar du att arbeta vid sidan av studierna?',w:'Påverkar din totala inkomst.',tp:'opts',opts:[{v:'parttime',l:'Ja, deltid'},{v:'extra',l:'Ja, extra vid behov'},{v:'no',l:'Nej'},{v:'unsure',l:'Osäker'}]},

    // Del 4 – Familj / ansvar
    {id:'has_kids',t:'Har du barn eller ekonomiskt ansvar för andra?',w:'Påverkar barntillägg och budget.',tp:'opts',opts:[{v:'yes',l:'Ja'},{v:'no',l:'Nej'}]},
    {id:'num_kids',t:'Hur många barn har du?',w:'',tp:'opts',cond:()=>ans.has_kids==='yes',opts:[{v:'1',l:'1'},{v:'2',l:'2'},{v:'3',l:'3'},{v:'4plus',l:'4 eller fler'}]},
    {id:'has_partner',t:'Har du sambo?',w:'Påverkar hushållsekonomi.',tp:'opts',opts:[{v:'yes_same',l:'Ja'},{v:'no',l:'Nej'}]},

    // Del 5 – Boende & utgifter
    {id:'housing',t:'Hur tänker du bo under studietiden?',w:'Bestämmer din boendekostnad i budgeten.',tp:'opts',opts:[{v:'student',l:'Studentboende / korridor'},{v:'shared',l:'Dela lägenhet'},{v:'rental',l:'Egen hyresrätt'},{v:'home',l:'Bo kvar där jag bor'}]},
    {id:'fixed_expenses',t:'Hur mycket har du i fasta utgifter per månad?',w:'Hyra, el, försäkringar, abonnemang.',tp:'input',ph:'T.ex. 8500',su:'kr/mån',cond:()=>ans.housing==='home'},
    {id:'variable_expenses',t:'Hur mycket har du i rörliga utgifter per månad?',w:'Mat, nöje, kläder, transport.',tp:'input',ph:'T.ex. 4000',su:'kr/mån',cond:()=>ans.housing==='home'},

    // Del 6 – Sparande
    {id:'savings_amount',t:'Hur mycket har du sparat som kan användas under studietiden?',w:'CSN tar ~6 veckor innan första utbetalning.',tp:'opts',opts:[{v:'none',l:'Inget'},{v:'under10',l:'Under 10 000 kr'},{v:'10-50',l:'10 000–49 999 kr'},{v:'50-100',l:'50 000–99 999 kr'},{v:'100plus',l:'100 000 kr eller mer'}]},

    // Del 7 – Oro & inställning (sist före kontakt)
    {id:'biggest_concern',t:'Vad oroar dig mest med att studera?',w:'Hjälper oss ge konkreta svar på just dina farhågor.',tp:'opts',opts:[{v:'economy',l:'Ekonomin — klarar jag mig på CSN?'},{v:'time',l:'Tiden — hinner jag med allt?'},{v:'grades',l:'Betygen — är jag tillräckligt smart?'},{v:'age',l:'Åldern — är det för sent?'},{v:'job',l:'Jobbet — hittar jag jobb efteråt?'},{v:'none',l:'Inget speciellt, jag är redo'}]},
    {id:'why_change',t:'Vad driver dig att vilja byta?',w:'Hjälper oss spegla dina egna ord i planen.',tp:'opts',opts:[{v:'meaning',l:'Vill ha ett meningsfullt jobb'},{v:'salary',l:'Vill tjäna mer'},{v:'burnout',l:'Trött på nuvarande jobb'},{v:'career',l:'Vill ha bättre karriärmöjligheter'},{v:'passion',l:'Har alltid velat göra något annat'},{v:'other',l:'Annat'}]},

    // Del 8 – Kontaktuppgifter
    {id:'user_name',t:'Vad heter du?',w:'Vi använder ditt namn i din personliga plan.',tp:'text',ph:'För- och efternamn'},
    {id:'user_phone',t:'Ditt mobilnummer?',w:'För att kunna skicka planen till dig.',tp:'text',ph:'070-123 45 67'},
    {id:'user_email',t:'Din e-postadress?',w:'Vi sparar din plan så att du alltid kan komma tillbaka till den.',tp:'text',ph:'namn@exempel.se'},
    {id:'user_password',t:'Välj ett lösenord till din plan',w:'Minst 4 tecken. Används för att logga in och se din plan igen.',tp:'text',ph:'Välj ett lösenord'}
];
const WTITLES=['Studiepreferenser','Studiepreferenser','Studiepreferenser','Studiepreferenser','Studiepreferenser','Studiepreferenser','Studiepreferenser','Studiepreferenser','Studiepreferenser','Studiepreferenser','Behörighet','Behörighet','Nuvarande situation','Nuvarande situation','Nuvarande situation','Nuvarande situation','Nuvarande situation','Nuvarande situation','Familj & ansvar','Familj & ansvar','Familj & ansvar','Familj & ansvar','Boende','Utgifter','Utgifter','Sparande & buffert','Kontaktuppgifter','Kontaktuppgifter','Kontaktuppgifter','Kontaktuppgifter'];

function getVisibleQS(){return QS.filter(q=>!q.cond||q.cond())}
function openW(){ws=0;ans={};renderW();}
function closeW(){}

function renderW(){
    const vqs=getVisibleQS();
    if(ws>=vqs.length){showBlurredPlan();return}
    const q=vqs[ws];
    const qi=QS.indexOf(q);
    const prog=Math.round((ws+1)/(vqs.length+1)*100);
    
    document.getElementById('wTi').textContent=WTITLES[qi]||'';
    document.getElementById('wBar').style.width=prog+'%';
    
    // Uppdaterad progress-text med mer uppmuntran
    let progressText='';
    if(ws===0) progressText=`Fråga ${ws+1} av ${vqs.length} - Vi kör!`;
    else if(prog<25) progressText=`Fråga ${ws+1} av ${vqs.length}`;
    else if(prog<50) progressText=`${prog}% klart - Bra jobbat!`;
    else if(prog<75) progressText=`${prog}% klart - Över halva vägen!`;
    else if(prog<95) progressText=`${prog}% klart - Snart klar!`;
    else progressText=`${prog}% klart - Sista frågan!`;
    document.getElementById('wSL').textContent=progressText;
    


    let h='<div class="wq">';
    // Dynamic title for familydrop
    let title=q.t,why=q.w;
    if(q.id==='familydrop'){
        const netSal=Math.round(sal*0.7);
        const maxCSN=BID+9484;
        const drop=netSal-maxCSN;
        title=drop>0?'Ditt hushåll tappar ~'+fmt(drop)+' kr/mån i inkomst':'Din CSN-inkomst är nära din nettolön';
        why=drop>0?'Du går från ~'+fmt(netSal)+' kr netto till max '+fmt(maxCSN)+' kr (CSN). Hur hanterar hushållet det?':'Nettolön ~'+fmt(netSal)+' kr vs max CSN '+fmt(maxCSN)+' kr. Hur ser ni på omställningen?';
    }
    h+='<h4>'+title+'</h4><div class="why">'+why+'</div>';
    if(q.tp==='multi'){
        h+='<div class="wopts">';
        q.opts.forEach(o=>{
            const selected=ans[q.id]&&ans[q.id].includes(o.v);
            h+='<div class="wo'+(selected?' sel':'')+'" onclick="wMulti(\''+q.id+"','"+o.v+"',this)\"><div class=\"wdot\"></div><span>"+o.l+'</span></div>';
        });
        h+='</div>';
    }
    else if(q.tp==='opts'){h+='<div class="wopts">';q.opts.forEach(o=>{h+='<div class="wo'+(ans[q.id]===o.v?' sel':'')+'" onclick="wSel(\''+q.id+"','"+o.v+"',this)\"><div class=\"wdot\"></div><span>"+o.l+'</span></div>'});h+='</div>'}
    else if(q.tp==='hp'){h+=`<div class="winp" style="max-width:320px">
      <div style="display:flex;align-items:flex-end;gap:8px;margin-bottom:10px">
        <div style="flex:1"><div style="font-size:.75rem;color:var(--mu);margin-bottom:4px">Verbalt</div>
        <input type="number" id="wInpHpV" step="0.1" min="0" max="2.0" placeholder="1.4" value="${ans[q.id]&&ans[q.id]!=='no'?ans[q.id].split(',')[0]||'':''}" style="width:100%;padding:12px;border:1.5px solid var(--bo);border-radius:10px;font-size:1rem;font-family:inherit;outline:none;box-sizing:border-box" oninput="this.style.borderColor=this.value?'var(--ac)':'var(--bo)'"></div>
        <div style="padding-bottom:14px;color:var(--mu);font-size:1.1rem">,</div>
        <div style="flex:1"><div style="font-size:.75rem;color:var(--mu);margin-bottom:4px">Kvantitativt</div>
        <input type="number" id="wInpHpQ" step="0.1" min="0" max="2.0" placeholder="1.6" value="${ans[q.id]&&ans[q.id]!=='no'?ans[q.id].split(',')[1]||'':''}" style="width:100%;padding:12px;border:1.5px solid var(--bo);border-radius:10px;font-size:1rem;font-family:inherit;outline:none;box-sizing:border-box" oninput="this.style.borderColor=this.value?'var(--ac)':'var(--bo)'"></div>
      </div>
      <div onclick="const v=document.getElementById('wInpHpV').value,q2=document.getElementById('wInpHpQ').value;if(v&&q2){ans['${q.id}']=v+','+q2;ws++;renderW();}else{ans['${q.id}']='no';ws++;renderW();}" class="wo" style="justify-content:center;font-weight:700;background:var(--ac);color:#fff;border:none">Har inte skrivit HP</div>
    </div>`;}
    else if(q.tp==='text'){h+='<div class="winp"><input type="text" id="wInp" placeholder="'+q.ph+'" value="'+(ans[q.id]||'')+'" oninput="ans[\''+q.id+'\']=this.value"></div>'}
    else{h+='<div class="winp"><input type="number" id="wInp" placeholder="'+q.ph+'" value="'+(ans[q.id]||'')+'" oninput="ans[\''+q.id+'\']=this.value"><span>'+q.su+'</span></div>'}
    h+='<div class="wnav">';if(ws>0){h+='<button class="wbk" onclick="wBk()">← Tillbaka</button>';}else{h+='<a href="/" class="wbk" style="text-decoration:none;display:flex;align-items:center;justify-content:center">← Startsidan</a>';};
    h+='<button class="wnx" onclick="wNx()">Nästa →</button></div></div>';
    document.getElementById('wB').innerHTML=h;
    const inp=document.getElementById('wInp');if(inp)inp.focus();
}
function wSel(qid,val,el){ans[qid]=val;el.parentElement.querySelectorAll('.wo').forEach(o=>o.classList.remove('sel'));el.classList.add('sel')}
function wMulti(qid,val,el){
    if(!ans[qid])ans[qid]=[];
    if(ans[qid].includes(val)){
        ans[qid]=ans[qid].filter(v=>v!==val);
        el.classList.remove('sel');
    }else{
        ans[qid].push(val);
        el.classList.add('sel');
    }
    // Om "Spelar ingen roll" väljs, rensa alla andra
    if(val==='any'&&ans[qid].includes('any')){
        ans[qid]=['any'];
        el.parentElement.querySelectorAll('.wo').forEach(o=>o.classList.remove('sel'));
        el.classList.add('sel');
    }
    // Om något annat väljs, ta bort "Spelar ingen roll"
    else if(ans[qid].includes('any')&&val!=='any'){
        ans[qid]=ans[qid].filter(v=>v!=='any');
        el.parentElement.querySelectorAll('.wo').forEach(o=>{
            if(o.textContent.includes('Spelar ingen roll'))o.classList.remove('sel');
        });
    }
}
function wBk(){if(ws>0){ws--;renderW()}}
function wNx(){const vqs=getVisibleQS();const q=vqs[ws];if(q.tp==='multi'&&(!ans[q.id]||ans[q.id].length===0)){alert('Välj minst ett alternativ.');return}if(q.tp==='opts'&&!ans[q.id]){alert('Välj ett alternativ.');return}if((q.tp==='input'||q.tp==='text'||q.tp==='hp')&&!ans[q.id]){if(q.tp==='hp'){ans[q.id]='no';}else{alert('Fyll i ett värde.');return}}ws++;renderW()}

function showBlurredPlan(){
    // Resolve edu om inte satt (fristående sida utan snabbkalkyl)
    if(!edu){
        const eid=ans._eduId?parseInt(ans._eduId):null;
        if(eid&&E.find(ex=>ex.id===eid)){edu=E.find(ex=>ex.id===eid);}
        else{
            // Matcha utbildning på bas av wizard-svar
            const durPref=ans.duration||'any';
            const eduTypes=ans.education_type||[];
            const maxYrs={'short':0.5,'6to12':1,'1to2':2,'3plus':99,'any':99}[durPref]||99;
            const wantYH=Array.isArray(eduTypes)&&eduTypes.includes('yh');
            const scored=E.map(ex=>{
                let sc=0;
                // Matcha utbildningslängd
                if(ex.y<=maxYrs)sc+=3;
                // YH-preferens
                if(wantYH&&ex.id>=7)sc+=2; // id 7+8 = YH-utbildningar
                // Lönenivå: favorisera höglöne om concern=money
                if(ans.biggest_concern==='money'&&ex.s1>=50000)sc+=2;
                // Låg stress om concern=burnout
                if(ans.biggest_concern==='burnout'&&ex.stress<=2)sc+=2;
                return{ex,sc};
            });
            scored.sort((a,b)=>b.sc-a.sc);
            edu=scored[0].ex;
        }
    }
    const e=edu,a=ans;
    const userName=a.user_name||'';
    const firstName=userName.split(' ')[0]||'du';
    const age=Math.min(70,Math.max(18,parseInt(a.age)||29));
    const city=mapCity(a.current_location);
    const cn={stockholm:'Stockholm',goteborg:'Göteborg',malmo:'Malmö',uppsala:'Uppsala',linkoping:'Linköping',lund:'Lund',umea:'Umeå',orebro:'Örebro',other:'Sverige'};
    const cityName=cn[city]||'Sverige';
    const gp=GYM.find(g=>g.id===a.gym);
    const gk=gp?gp.k:'other';
    const full=a.has_grades==='yes'&&e.rp.includes(gk);
    const part=a.has_grades==='yes'&&e.pp.includes(gk);
    const sal=+a.current_salary||0;
    const defaultLoan=Math.round(e.tc*0.6/10)*10;
    const loan=defaultLoan;
    const mo=Math.round(e.y*10);
    const debt=loan*mo;
    const BID=4120;
    const yg=(e.s0-sal)*12;
    const op=sal*12*e.y;
    const be=yg>0?Math.ceil((op+debt)/yg):0;

    // Stäng wizard
    closeW();

    // ── LADDNINGSSKÄRM ──
    const loadEl=document.createElement('div');
    loadEl.id='planLoader';
    loadEl.style.cssText='position:fixed;inset:0;background:#0a2e1a;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px;';

    const steps=[
        {pct:8,  msg:`Hämtar krav för ${e.t}...`},
        {pct:22, msg:`Kontrollerar behörighet — ${gp?gp.l:'ditt gymnasieprogram'}...`},
        {pct:38, msg:`Beräknar CSN-stöd för ${cityName}...`},
        {pct:54, msg:`Räknar på din budget månad för månad...`},
        {pct:68, msg:`Analyserar antagningspoäng i ${cityName}...`},
        {pct:79, msg:`Genererar tidslinje — ${e.y} år till examen...`},
        {pct:90, msg:`Sätter ihop dina konkreta steg...`},
        {pct:100,msg:`Din plan är klar, ${firstName}.`}
    ];

    loadEl.innerHTML=`
    <div style="text-align:center;width:100%;max-width:420px">
        <div style="font-family:'DM Serif Display',serif;font-size:1.6rem;color:#fff;margin-bottom:8px">${firstName}</div>
        <div style="font-size:.85rem;color:rgba(255,255,255,.6);margin-bottom:40px">Vi bygger din personliga plan — det tar bara några sekunder</div>
        <div style="background:rgba(255,255,255,.1);border-radius:100px;height:6px;width:100%;margin-bottom:20px;overflow:hidden">
            <div id="planLoadBar" style="background:linear-gradient(90deg,#4CAF82,var(--ac));height:100%;width:0%;border-radius:100px;transition:width .6s ease"></div>
        </div>
        <div id="planLoadPct" style="font-family:'DM Serif Display',serif;font-size:2.2rem;color:#fff;margin-bottom:8px">0%</div>
        <div id="planLoadMsg" style="font-size:.88rem;color:rgba(255,255,255,.7);min-height:24px;transition:opacity .3s"></div>
        <div class="mob-grid-2" style="margin-top:48px;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;opacity:.5">
        <div style="padding:12px 8px;background:rgba(255,255,255,.08);border-radius:10px;text-align:center">
            <div style="font-size:.62rem;color:rgba(255,255,255,.6);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Behörighet</div>
            <div style="font-size:.9rem;font-weight:700;color:#fff">${full?'✓ Klar':part?'⚠ Nära':'Kollar...'}</div>
        </div>
        <div style="padding:12px 8px;background:rgba(255,255,255,.08);border-radius:10px;text-align:center">
            <div style="font-size:.62rem;color:rgba(255,255,255,.6);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Utbildning</div>
            <div style="font-size:.9rem;font-weight:700;color:#fff">${Math.ceil(e.y)} år</div>
        </div>
        <div style="padding:12px 8px;background:rgba(255,255,255,.08);border-radius:10px;text-align:center">
            <div style="font-size:.62rem;color:rgba(255,255,255,.6);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Steg</div>
            <div style="font-size:.9rem;font-weight:700;color:#fff" id="planLoadSteps">—</div>
        </div>
        </div>
    </div>`;

    document.body.appendChild(loadEl);
    document.body.style.overflow='hidden';

    // Animera stegen
    let si=0;
    const bar=document.getElementById('planLoadBar');
    const pct=document.getElementById('planLoadPct');
    const msg=document.getElementById('planLoadMsg');
    const stepsEl=document.getElementById('planLoadSteps');

    function tick(){
        if(si>=steps.length){
            // Klar — visa paywall
            setTimeout(()=>{
                loadEl.style.transition='opacity .5s';
                loadEl.style.opacity='0';
                setTimeout(()=>{
                    loadEl.remove();
                    document.body.style.overflow='';
                    showPaywall(firstName,e,debt,be,sal,full,part,gp,loan,mo,BID);
                },500);
            },700);
            return;
        }
        const s=steps[si];
        bar.style.width=s.pct+'%';
        pct.textContent=s.pct+'%';
        msg.style.opacity='0';
        setTimeout(()=>{msg.textContent=s.msg;msg.style.opacity='1';},200);
        if(si===6) stepsEl.textContent='7 st';
        si++;
        setTimeout(tick, si===steps.length-1?900:600);
    }
    setTimeout(tick,300);
}

function showPaywall(firstName,e,debt,be,sal,full,part,gp,loan,mo,BID){
    const fmt=n=>n.toLocaleString('sv-SE');
    const salDiff=e.s0-sal;
    const gradYr=new Date().getFullYear()+Math.ceil(e.y)+(full?0:part?1:2);

    const pw=document.createElement('div');
    pw.style.cssText='position:fixed;inset:0;background:#f5f4f0;z-index:9990;overflow-y:auto;';
    pw.innerHTML=`
    <div style="min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:24px 16px 48px">

    <!-- Header -->
    <div style="text-align:center;margin-bottom:28px;max-width:480px">
        <div style="display:inline-block;background:var(--ac);color:#fff;font-size:.72rem;font-weight:700;letter-spacing:.8px;text-transform:uppercase;padding:6px 14px;border-radius:100px;margin-bottom:14px">Din plan är klar</div>
        <h2 style="font-family:'DM Serif Display',serif;font-size:1.75rem;color:var(--ah);line-height:1.25;margin-bottom:8px">${firstName} — din väg till ${e.t.toLowerCase()}</h2>
        <p style="font-size:.88rem;color:#6c757d">Vi har analyserat din situation och tagit fram din personliga plan.</p>
    </div>

    <!-- Blurrad plan-preview -->
    <div style="width:100%;max-width:480px;margin-bottom:24px;border-radius:18px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.12);position:relative">

        <!-- Synliga nyckeltal — lockbete -->
        <div style="background:#fff;padding:20px;border-bottom:1px solid #e0e0d8">
        <div style="font-size:.7rem;font-weight:700;color:#6c757d;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px">Ur din plan</div>
        <div class="mob-grid-3" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
            <div style="padding:12px 8px;background:${salDiff>0?'#D9F0E3':'#f8d7da'};border-radius:10px;text-align:center">
            <div style="font-size:.6rem;font-weight:700;color:${salDiff>0?'var(--ah)':'#721c24'};text-transform:uppercase;margin-bottom:3px">Löneförändring</div>
            <div style="font-family:'DM Serif Display',serif;font-size:1.05rem;color:${salDiff>0?'var(--ah)':'#721c24'};font-weight:700">${salDiff>0?'+':''}${fmt(salDiff)} kr</div>
            <div style="font-size:.6rem;color:${salDiff>0?'var(--ah)':'#721c24'};opacity:.8">per månad</div>
            </div>
            <div style="padding:12px 8px;background:#fff3cd;border-radius:10px;text-align:center">
            <div style="font-size:.6rem;font-weight:700;color:#856404;text-transform:uppercase;margin-bottom:3px">CSN-skuld</div>
            <div style="font-family:'DM Serif Display',serif;font-size:1.05rem;color:#856404;font-weight:700">${fmt(debt)} kr</div>
            <div style="font-size:.6rem;color:#856404;opacity:.8">totalt lån</div>
            </div>
            <div style="padding:12px 8px;background:#cfe2ff;border-radius:10px;text-align:center">
            <div style="font-size:.6rem;font-weight:700;color:#084298;text-transform:uppercase;margin-bottom:3px">Break-even</div>
            <div style="font-family:'DM Serif Display',serif;font-size:1.05rem;color:#084298;font-weight:700">${be>0&&be<40?'~'+be+' år':'—'}</div>
            <div style="font-size:.6rem;color:#084298;opacity:.8">sedan tjänar mer</div>
            </div>
        </div>
        </div>

        <!-- Blurrad resten -->
        <div style="background:#fff;padding:20px;filter:blur(5px);pointer-events:none;user-select:none">
        <div style="height:12px;background:#e0e0d8;border-radius:6px;margin-bottom:10px;width:80%"></div>
        <div style="height:12px;background:#e0e0d8;border-radius:6px;margin-bottom:10px;width:60%"></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px">
            <div style="height:60px;background:#f0f4f1;border-radius:10px"></div>
            <div style="height:60px;background:#fff3cd;border-radius:10px"></div>
        </div>
        <div style="height:12px;background:#e0e0d8;border-radius:6px;margin-bottom:8px;width:90%"></div>
        <div style="height:12px;background:#e0e0d8;border-radius:6px;margin-bottom:8px;width:70%"></div>
        <div style="height:48px;background:#D9F0E3;border-radius:10px;margin-bottom:8px"></div>
        <div style="height:12px;background:#e0e0d8;border-radius:6px;margin-bottom:8px;width:55%"></div>
        <div style="height:12px;background:#e0e0d8;border-radius:6px;width:75%"></div>
        </div>

        <!-- Lås-overlay -->
        <div style="position:absolute;bottom:0;left:0;right:0;height:140px;background:linear-gradient(transparent,rgba(245,244,240,.98));display:flex;align-items:flex-end;justify-content:center;padding-bottom:16px">
        <div style="display:flex;align-items:center;gap:6px;font-size:.8rem;color:#6c757d">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
            Lås upp för att se hela planen
        </div>
        </div>
    </div>

    <!-- Vad ingår -->
    <div style="width:100%;max-width:480px;margin-bottom:20px">
        <div style="display:grid;gap:8px">
        ${[
            ['behörighet','Din exakta behörighet',`Kurs för kurs baserat på ${gp?gp.l:'ditt gymnasieprogram'}`],
            ['datum','Konkreta datum och deadlines',`Ansökningsdag, Komvux-start, HP-anmälan`],
            ['budget','Interaktiv månadsbudget',`Justera CSN, hyra och extrajobb i realtid`],
            ['plan','Steg-för-steg handlingsplan',`Vad du gör denna vecka, nästa månad, nästa år`],
            ['skolor','Matchade utbildningar','Filtrerat på din ort, studieform och studietakt']
        ].map(([ic,ti,su])=>`<div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:#fff;border-radius:10px;border:1px solid #e0e0d8">
            <div style="width:28px;height:28px;border-radius:7px;background:#f0f4f1;flex-shrink:0;display:flex;align-items:center;justify-content:center">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--ac)" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
            </div>
            <div><div style="font-weight:700;font-size:.85rem;color:var(--ah)">${ti}</div><div style="font-size:.76rem;color:#6c757d">${su}</div></div>
        </div>`).join('')}
        </div>
    </div>

    <!-- CTA -->
    <div style="width:100%;max-width:480px">
        <button onclick="pw.remove();document.body.style.overflow='';pay();" style="width:100%;background:linear-gradient(135deg,var(--ac),var(--ah));color:#fff;border:none;padding:18px 32px;border-radius:14px;font-size:1.1rem;font-weight:700;cursor:pointer;box-shadow:0 6px 20px rgba(45,90,61,.35);letter-spacing:.2px">
            Lås upp min plan — 99 kr
        </button>
        <p style="text-align:center;font-size:.76rem;color:#6c757d;margin-top:10px">
            Engångsbetalning &nbsp;·&nbsp; Ingen prenumeration &nbsp;·&nbsp; Dina svar sparas
        </p>
    </div>

    </div>`;

    // Fix knapp-referens till pw
    document.body.appendChild(pw);
    document.body.style.overflow='hidden';
    window.scrollTo(0,0);
    pw.querySelector('button').onclick=function(){pw.remove();document.body.style.overflow='';pay();};
}


function renderPay(){
    const vqs=getVisibleQS();
    const e=edu,a=ans;
    const age=Math.min(70,Math.max(18,parseInt(a.age)||29));
    const city=mapCity(a.current_location);
    const cn={stockholm:'Stockholm',goteborg:'Göteborg',malmo:'Malmö',uppsala:'Uppsala',linkoping:'Linköping',lund:'Lund',umea:'Umeå',orebro:'Örebro',other:'hela Sverige'};
    const cityName=cn[city]||'din stad';
    const gp=GYM.find(g=>g.id===a.gym),gk=gp?gp.k:'other';
    const full=a.has_grades==='yes'&&e.rp.includes(gk);
    const part=a.has_grades==='yes'&&e.pp.includes(gk);
    const behTxt=full?'Behörig — sök direkt':part?'Komplettering ~1 termin':'Kolla dina betyg';
    const behCol=full?'var(--ac)':part?'var(--wa)':'var(--re)';
    const netNow=Math.round(sal*0.7); // nettolön (ungefärlig) för budgetkalkyl

    document.getElementById('wTi').textContent='Din plan är klar';
    document.getElementById('wBar').style.width='100%';
    document.getElementById('wSL').textContent='';
    document.getElementById('wB').innerHTML=`<div class="wq">
    <div style="background:linear-gradient(135deg,var(--ac),var(--ah));border-radius:12px;padding:20px;color:#fff;margin-bottom:20px;text-align:center">
    <div style="font-family:'DM Serif Display',serif;font-size:1.15rem;margin-bottom:4px">${age} år — din väg till ${e.t.toLowerCase()}</div>
    <div style="opacity:.85;font-size:.84rem">${cityName} · ${e.y} år · Examen ${new Date().getFullYear()+(new Date().getMonth()<5?0:1)+e.y}</div>
    </div>

    <div style="display:grid;gap:6px;margin-bottom:20px">
    <div style="display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;border:1.5px solid var(--bo)">
    <div style="width:8px;height:8px;border-radius:50%;background:${behCol};flex-shrink:0"></div>
    <span style="font-size:.86rem;font-weight:600">Behörighet</span>
    <span style="margin-left:auto;font-size:.82rem;color:${behCol};font-weight:600">${behTxt}</span></div>

    <div style="display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;border:1.5px solid var(--bo)">
    <div style="width:8px;height:8px;border-radius:50%;background:var(--bl);flex-shrink:0"></div>
    <span style="font-size:.86rem;font-weight:600">Ekonomi</span>
    <span style="margin-left:auto;font-size:.82rem;color:var(--mu)">${fmt(netNow)} kr → <span style="filter:blur(4px)">XX XXX kr</span></span></div>

    <div style="display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;border:1.5px solid var(--bo)">
    <div style="width:8px;height:8px;border-radius:50%;background:var(--wa);flex-shrink:0"></div>
    <span style="font-size:.86rem;font-weight:600">Handlingsplan</span>
    <span style="margin-left:auto;font-size:.82rem;color:var(--mu)">6 steg + checklista</span></div>

    <div style="display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;border:1.5px solid var(--bo)">
    <div style="width:8px;height:8px;border-radius:50%;background:var(--pu);flex-shrink:0"></div>
    <span style="font-size:.86rem;font-weight:600">Skolor</span>
    <span style="margin-left:auto;font-size:.82rem;color:var(--mu)">${e.sch.length} matchade</span></div>
    </div>

    <div style="text-align:center;margin-bottom:16px"><div style="font-family:'DM Serif Display',serif;font-size:1.1rem;margin-bottom:4px">Lås upp hela planen</div><div style="font-size:.82rem;color:var(--mu)">Personlig budget, tidslinje, skolmatchning — allt baserat på dina ${vqs.length} svar.</div></div>

    <div class="fld"><label>Namn</label><input type="text" id="pNam" placeholder="Ditt namn"></div>
    <div class="fld"><label>Mejl</label><input type="email" id="pEm" placeholder="namn@mejl.se"></div>
    <div class="fld"><label>Telefon (valfritt)</label><input type="tel" id="pTel" placeholder="070-123 45 67"></div>
    <button class="btn" onclick="pay()">Betala 50 kr — lås upp</button>
    <div style="display:flex;align-items:center;justify-content:center;gap:6px;margin-top:10px;font-size:.76rem;color:var(--li)"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>Säker betalning — engångsbetalning</div>
    <div class="wnav" style="margin-top:16px"><button class="wbk" onclick="ws=${vqs.length-1};renderW()">← Tillbaka</button><div></div></div>
    </div>`;
}

// pay() ersatt av saveAndRedirect — se nedan
function pay_DISABLED_REPLACED(){
    // Använd userName från answers istället för input fields
    const userName=ans.user_name||'Användare';
    
    // Bygg hela planen direkt
    buildFP(userName);
    
    // Visa planen
    document.getElementById('fpDiv').classList.add('v');
    document.getElementById('fpDiv').style.display='block';
    
    setTimeout(()=>{
        const fpDiv=document.getElementById('fpDiv');
        window.scrollTo({top:fpDiv.offsetTop-70,behavior:'smooth'});
    },200);
}



// Map free-text city to key
function mapCity(txt){
    if(!txt)return'other';const t=txt.toLowerCase().trim();
    const m={stockholm:'stockholm',sthlm:'stockholm',göteborg:'goteborg',gbg:'goteborg',malmö:'malmo',uppsala:'uppsala',linköping:'linkoping',lund:'lund',umeå:'umea',örebro:'orebro'};
    for(const[k,v]of Object.entries(m))if(t.includes(k))return v;
    return'other';
}

function buildFP(name){
    const e=edu,a=ans;

    // ═══ DERIVE VALUES FROM ANSWERS ═══
    // Convert age range to approximate number
    const age=Math.min(70,Math.max(18,parseInt(a.age)||29));
    
    const city=mapCity(a.current_location);
    const campus=a.study_mode==='campus'?'campus':a.study_mode==='distance'?'distance':'any';
    
    // Housing - use direct answer
    const hou=a.housing||'student';
    
    // Determine if working needed based on work status
    const workNeeded=a.work_during==='parttime'||a.work_status==='parttime';
    
    const pm=workNeeded?2:1,ry=e.y*pm;
    const rent=hou==='home'?0:Math.round((CIT[city]||4500)*(HOU[hou]||.75));
    
    // CSN loan - default based on user's answer
    const defaultLoan=a.need_csn==='grant'?0:a.need_csn==='no'?0:6000;
    const loan=defaultLoan;
    
    const wh=workNeeded?15:(a.need_csn==='both')?10:0;
    const wi=Math.round(wh*WR*4.3);
    const mo=Math.round(ry*10),debt=loan*mo,pb=debt>0?Math.round(debt*.04/12):0;
    
    // Use salary from initial form
    const currentSal=sal;
    
    // Convert expenses - use direct values
    const fixedExp=parseInt(a.fixed_expenses)||10000;
    const variableExp=parseInt(a.variable_expenses)||4000;
    
    // Budget logic:
    // If staying home: use current expenses (fixed+variable), rent=0
    // If moving: use only variable expenses + calculated student rent
    const userExp=hou==='home'?(fixedExp+variableExp):variableExp;
    
    // Kids and family
    const numKids=a.num_kids?parseInt(a.num_kids)||1:0;
    const cc=a.has_kids==='yes'?2000*numKids:0;
    const barnCSN=a.has_kids==='yes'?2648:0;
    
    const op=currentSal*12*ry,yg=(e.s0-currentSal)*12,be=yg>0?Math.ceil((op+debt)/yg):0;
    const dfa=debt>0&&pb>0?Math.round(age+ry+debt/(pb*12)):0;
    const ti=BID+barnCSN+loan+wi,to=rent+userExp+cc,bal=ti-to;
    const defRent=hou==='home'?0:Math.round((CIT[city]||4500)*(HOU[hou]||.75));
    const afterTax=v=>Math.round(v*0.7);
    const cn={stockholm:'Stockholm',goteborg:'Göteborg',malmo:'Malmö',uppsala:'Uppsala',linkoping:'Linköping',lund:'Lund',umea:'Umeå',orebro:'Örebro',other:'hela Sverige'};
    const cityName=cn[city]||'din stad';
    const hn={student:'studentboende',shared:'delad lägenhet',rental:'hyresrätt',home:'hemma'};

    

    const fl=campus==='campus'?'campus':campus==='distance'?'distans':'campus/distans';

    // Behörighet from gym program + education requirements
    const gp=GYM.find(g=>g.id===a.gym),gk=gp?gp.k:'other';
    const full=a.has_grades==='yes'&&e.rp.includes(gk);
    const part=a.has_grades==='yes'&&e.pp.includes(gk);
    const need=!full;

    // Dates
    const now=new Date(),yr=now.getFullYear(),mo2=now.getMonth();
    const wantSoon=a.when_start==='asap'||a.when_start==='next'||a.when_start==='6mo';
    const htStart=wantSoon&&mo2<5?'HT'+yr:'HT'+(yr+1);
    const komvuxStart=mo2<5?'VT'+yr:'VT'+(yr+1);
    const studyStart=htStart;
    const startYr=parseInt(studyStart.slice(2));
    const compTime=need?(part?1:2):0;
    const gradYear=startYr+Math.ceil(ry)+compTime;
    const gradAge=age+Math.ceil(ry)+compTime;
    const firstName=name.split(' ')[0];
    const formTxt=campus==='distance'?'Distans':campus==='campus'?'Campus':'Campus/Distans';

    // Opportunity cost: total lost income during studies
    const opCost=afterTax(sal)*12*ry;

    // Schools — filter by user preferences
    const schs=e.sch.filter(s=>{
        // Studieform filter
        if(a.study_mode==='campus'&&s.f==='distance')return false;
        if(a.study_mode==='distance'&&s.f==='campus')return false;
        
        // Utbildningstyp filter
        const eduTypes=Array.isArray(a.education_type)?a.education_type:(a.education_type?[a.education_type]:[]);
        if(eduTypes.length>0&&!eduTypes.includes('any')){
            const wantsYH=eduTypes.includes('yh');
            const wantsUni=eduTypes.includes('uni');
            const isYH=s.p===0;
            const isUni=s.p>0;
            
            if(!wantsYH&&isYH)return false;
            if(!wantsUni&&isUni)return false;
        }
        
        // Studietakt filter
        if(a.study_pace==='parttime'&&s.pace==='fulltime')return false;
        
        // CSN filter
        if(a.csn_needed==='yes'&&!s.csn)return false;
        
        // Avgift filter
        if(a.fee_ok==='no'&&s.fee>0)return false;
        
        // Språk filter
        if(a.language==='swedish'&&s.lang==='english')return false;
        if(a.language==='english'&&s.lang==='swedish')return false;
        
        return true;
    }).sort((x,y)=>{
        // Prioritera stad
        if(x.c===city&&y.c!==city)return -1;
        if(y.c===city&&x.c!==city)return 1;
        // Sedan antagningspoäng
        return (y.p||0)-(x.p||0);
    });

    // ═══════ Studiestaden & boendelogik ═══════
    const studyCity=(schs.length>0&&schs[0]&&schs[0].c)?schs[0].c:city;
    const studyCityName=(schs.length>0&&schs[0].c!==city)?({stockholm:'Stockholm',goteborg:'Göteborg',malmo:'Malmö',uppsala:'Uppsala',linkoping:'Linköping',lund:'Lund',umea:'Umeå',orebro:'Örebro'}[schs[0].c]||cityName):cityName;
    const isMovingCity=studyCity!==city;
    const isDistanceStudy=a.study_mode==='distance'||(a.study_mode==='hybrid'&&!isMovingCity);
    // Visa boendesteg: inte bor kvar hemma OCH faktiskt relevant
    // Distansstudenter som inte valt att flytta behöver inget boendesteg
    const showHousing=hou!=='home'&&!(isDistanceStudy&&a.willing_to_move!=='yes');
    
    // Kötider för studentboende per studiestad (ungefärliga — varierar)
    const KOTID={
        stockholm:{q:'1–5 år',org:'SSSB',url:'https://sssb.se'},
        goteborg:{q:'6 mån–2 år',org:'SGS Studentbostäder',url:'https://sgs.se'},
        malmo:{q:'6–18 månader',org:'MKB Studentbostad',url:'https://mkb.se'},
        uppsala:{q:'1–3 år',org:'Studentstaden Uppsala',url:'https://studentstaden.se'},
        linkoping:{q:'6–18 månader',org:'LiU Studentbostad',url:'https://liu.se/studera/studentbostad'},
        lund:{q:'6–18 månader',org:'AF Bostäder',url:'https://afbostader.se'},
        umea:{q:'3–12 månader',org:'Umeå Studentbostad',url:'https://umeastudentbostad.se'},
        orebro:{q:'3–9 månader',org:'Örebrobostäder',url:'https://orebrobostader.se'}
    };
    const kotidInfo=KOTID[studyCity]||{q:'3–12 månader',org:'ortens studentbostadsbolag',url:'https://studera.nu'};

    // ═══════════════════════════════════════
    // PERSONAL INTRO
    // ═══════════════════════════════════════
    const salDiff=e.s0-currentSal;
    const jobTxt=`Du tjänar ${fmt(currentSal)} kr/mån`;
    const certaintyTxt=(()=>{
        if(age>=45) return `Att börja vid ${age} ger dig ${65-age-Math.ceil(ry)-compTime} år i yrket — det räcker mer än väl.`;
        if(age>=35) return `${age} år med ${Math.round(currentSal/1000)}k i lön och erfarenhet är en fördel, inte ett hinder.`;
        if(a.has_kids==='yes') return `Med barn och studier samtidigt — det görs varje dag. Planen är byggd för det.`;
        if(a.biggest_concern==='economy') return `Ekonomin är den vanligaste oron. Vi har räknat på den — och visar dig exakt vad som gäller.`;
        if(a.biggest_concern==='age') return `Åldern är inte ett hinder — tusentals gör samma byte varje år.`;
        if(salDiff>8000) return `Löneökningen på ${fmt(salDiff)} kr/mån gör det här till en av dina bästa investeringar.`;
        return `Du har redan gjort det svåraste — att faktiskt undersöka möjligheten.`;
    })();
    const introLine=salDiff>5000?`Som ${e.t.toLowerCase()} ökar din lön med ${fmt(salDiff)} kr/mån — och det är bara starten.`:
        salDiff>0?`Lönen ökar med ${fmt(salDiff)} kr/mån. Med erfarenhet når du ${fmt(e.s1)} kr.`:
        `Du tjänar redan bra. ${e.t} ger dig nya arbetsvillkor och ett lönetak på ${fmt(e.s1)} kr.`;

    let h=`<div class="pwel"><h3>${firstName}, ${age} år — din väg till ${e.t.toLowerCase()}</h3>
    <p class="pintro">${jobTxt} och är ${age} år. ${certaintyTxt} ${introLine}</p>
    <div style="margin-top:14px;padding:14px;background:rgba(255,255,255,.12);border-radius:10px;display:grid;gap:6px;font-size:.84rem">
    <div style="display:flex;justify-content:space-between"><span style="opacity:.75">Utbildning</span><span style="font-weight:700">${e.t}</span></div>
    <div style="display:flex;justify-content:space-between"><span style="opacity:.75">Skolor</span><span style="font-weight:700">${schs.length} alternativ</span></div>
    <div style="display:flex;justify-content:space-between"><span style="opacity:.75">Studieform</span><span style="font-weight:700">${formTxt}, ${ry} år</span></div>
    <div style="display:flex;justify-content:space-between"><span style="opacity:.75">Examen</span><span style="font-weight:700">${gradYear} (${gradAge} år)</span></div>
    ${a.has_kids==='yes'?'<div style="display:flex;justify-content:space-between"><span style="opacity:.75">Barntillägg CSN</span><span style="font-weight:700">+'+fmt(barnCSN)+' kr/mån</span></div>':''}
    </div></div>`;

    // ═══ STICKY TABS ═══
    // Tab order for prev/next navigation
    const TAB_ORDER=['overview','beh','ekon','tid','skol'];
    let currentTabIdx=0;
    h+=`<div style="position:relative">`;
    h+=`<div style="display:flex;align-items:center;gap:8px;padding:0 16px 0;max-width:860px;margin:0 auto">
    <button onclick="navPlan(-1)" id="planPrev" style="flex-shrink:0;width:36px;height:36px;border-radius:50%;border:1.5px solid var(--bo);background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--mu)" title="Föregående"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="ptbar" id="planTabs" style="flex:1;overflow-x:auto">
    <button class="act" onclick="planTab('overview',this)"><span class="tf">Översikt</span><span class="ts">Start</span></button>
    <button onclick="planTab('beh',this)"><span class="tf">Behörighet</span><span class="ts">Betyg</span></button>
    <button onclick="planTab('ekon',this)"><span class="tf">Ekonomi</span><span class="ts">Budget</span></button>
    <button onclick="planTab('tid',this)"><span class="tf">Tidslinje</span><span class="ts">Tidslinje</span></button>
    <button onclick="planTab('skol',this)"><span class="tf">Sammanfattning</span><span class="ts">Summering</span></button>
    <button onclick="printPlan()" style="margin-left:auto;background:none;border:1px solid var(--bo);border-radius:8px;padding:6px 12px;font-size:.78rem;color:var(--mu);cursor:pointer;display:flex;align-items:center;gap:5px;white-space:nowrap" title="Ladda ner som PDF"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg><span class="tf">Spara PDF</span></button>
    </div>
    <button onclick="navPlan(1)" id="planNext" style="flex-shrink:0;width:36px;height:36px;border-radius:50%;border:1.5px solid var(--bo);background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--mu)" title="Nästa"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg></button>
    </div>`;
    h+=`</div>`; // end ptbar wrapper
    // Nav arrow buttons
    h+=`<div id="planNavWrap" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;gap:10px">
    <button id="planPrev" onclick="planPrev()" style="display:flex;align-items:center;gap:6px;padding:10px 16px;border:2px solid #e0e0d8;border-radius:10px;background:#fff;font-family:inherit;font-size:.82rem;font-weight:600;color:#6c757d;cursor:pointer;transition:all .2s;white-space:nowrap" disabled>
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg> Föregående
    </button>
    <span id="planStepLabel" style="font-size:.78rem;color:#6c757d;font-weight:600;text-align:center">1 / 5</span>
    <button id="planNext" onclick="planNext()" style="display:flex;align-items:center;gap:6px;padding:10px 16px;border:2px solid var(--ac);border-radius:10px;background:#fff;font-family:inherit;font-size:.82rem;font-weight:600;color:var(--ac);cursor:pointer;transition:all .2s;white-space:nowrap">
    Nästa <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg>
    </button>
    </div>`;

    // ═══════════════════════════════════════
    // STUDIETIDEN PANEL
    // ═══════════════════════════════════════
    h+=`<div id="planOverview">`;
    let secN=0;

    // — FRAMTIDSVISION: DIN FRAMTID —
    const futureYear=gradYear+5;
    const futureAge=gradAge+5;
    const futureSalary=Math.round(e.s0+(e.s1-e.s0)*0.6); // 60% av vägen till max
    const salaryIncrease=futureSalary-currentSal;
    const debtAtFuture=debt>0?Math.max(0,debt-pb*12*5):0;
    
    h+=`<div style="background:linear-gradient(135deg,var(--ac),var(--ah));border-radius:16px;padding:32px 28px;margin-bottom:32px;color:#fff">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
    <div>
    <div style="font-family:'DM Serif Display',serif;font-size:2rem">Din framtid som ${e.t.toLowerCase()}</div>
    <div style="opacity:.85;font-size:.95rem">Om 5 år (${futureYear}) — du är ${futureAge} år</div>
    </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-top:24px">
    <div style="background:rgba(255,255,255,.15);padding:20px;border-radius:12px">
    <div style="font-size:.8rem;opacity:.8;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px">Månadslön</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;margin-bottom:4px">${fmt(futureSalary)} kr</div>
    <div style="font-size:.85rem;opacity:.9">↑ ${fmt(salaryIncrease)} kr mer än idag</div>
    </div>
    
    <div style="background:rgba(255,255,255,.15);padding:20px;border-radius:12px">
    <div style="font-size:.8rem;opacity:.8;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px">Jobbmarknad</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;margin-bottom:4px">${e.dem===5?'Mycket hög':e.dem===4?'Hög':e.dem===3?'Stabil':'God'}</div>
    <div style="font-size:.85rem;opacity:.9">${e.dem===5?'Akut brist - garanterat jobb':e.dem===4?'Arbetsgivare söker aktivt':'Balanserad marknad'}</div>
    </div>
    
    ${debt>0?`<div style="background:rgba(255,255,255,.15);padding:20px;border-radius:12px">
    <div style="font-size:.8rem;opacity:.8;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px">CSN-skuld</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;margin-bottom:4px">${debtAtFuture>0?fmt(debtAtFuture)+' kr':'Betald!'}</div>
    <div style="font-size:.85rem;opacity:.9">${debtAtFuture>0?fmt(debt-debtAtFuture)+' kr betalt av '+fmt(debt)+' kr':'Skuldfri!'}</div>
    </div>`:`<div style="background:rgba(255,255,255,.15);padding:20px;border-radius:12px">
    <div style="font-size:.8rem;opacity:.8;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px">Ekonomisk frihet</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;margin-bottom:4px">Ingen skuld</div>
    <div style="font-size:.85rem;opacity:.9">Du klarade utan lån!</div>
    </div>`}
    
    <div style="background:rgba(255,255,255,.15);padding:20px;border-radius:12px">
    <div style="font-size:.8rem;opacity:.8;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px">Karriärstege</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;margin-bottom:4px">${e.sc.sp}</div>
    <div style="font-size:.85rem;opacity:.9">Från ${e.sc.st} → ${e.sc.le}</div>
    </div>
    </div>
    
    <!-- AI och framtid -->
    <div style="margin-top:20px;padding:16px;background:rgba(255,255,255,.1);border-radius:10px;border-left:3px solid ${e.ai>=12?'#d4a853':'rgba(255,255,255,.3)'}">
    <div style="font-size:.88rem;line-height:1.65;opacity:.95">
    <strong>AI och automatisering (Risk: ${e.ai}/20):</strong> ${e.ai>=15?'AI kommer förändra yrket, men människan behövs fortfarande. Rutinuppgifter automatiseras, vilket <em>höjer</em> kraven på kvalificerad personal.':e.ai>=10?'AI är ett verktyg som förbättrar arbetet, inte ersätter det. Automatisering hanterar rutinen, du hanterar komplexiteten.':e.ai>=5?'AI har begränsad påverkan på kärnuppgifterna. Yrket bygger på mänsklig interaktion och omdöme.':'Låg AI-påverkan. Mänsklig kompetens, empati och omdöme är central.'} ${e.id===2?'Utvecklare som använder AI-verktyg (GitHub Copilot, ChatGPT) är 35% mer produktiva enligt GitHub Stats 2024.':e.id===1?'Vården behöver sjuksköterskor mer än någonsin — AI kan inte sätta dropp, trösta patienter eller fatta akuta beslut.':''}
    </div>
    </div>
    
    ${age>=28?`<div style="margin-top:16px;padding:16px;background:rgba(255,255,255,.1);border-radius:10px">
    <div style="font-size:.88rem;line-height:1.65;opacity:.95">
    <strong>Du har ${65-age-Math.ceil(ry)-compTime} år kvar att jobba som ${e.t.toLowerCase()}</strong> om du börjar nu${compTime>0?' (inkl. komplettering)':''}. Det är ${65-age-Math.ceil(ry)-compTime>=30?'tre decennier':65-age-Math.ceil(ry)-compTime>=20?'två decennier':'många år'}. Låt oss vara tydliga: <strong>du kommer åldras oavsett</strong>. Om ${Math.ceil(ry)} år är du ${age+Math.ceil(ry)+compTime} år — med eller utan den här utbildningen. Frågan är inte <em>om</em> du ska göra förändringen, utan <em>när</em>.
    </div>
    </div>`:''}
    
    </div>`;
    
    // — DU ÄR INTE ENSAM —
    // Typisk skuld vid fullt CSN-lån (9484 kr/mån) för denna utbildning
    const avgDebt=9484*Math.round(e.y*10);
    const yourDebtVsAvg=debt<avgDebt?'lägre':'högre';
    
    // Utbildningsspecifik statistik
    const eduStats={
        1:{students:'~4 200',employ:'95%',avgAge:'26'},
        2:{students:'~3 500',employ:'88%',avgAge:'24'},
        3:{students:'~5 100',employ:'92%',avgAge:'25'},
        4:{students:'~3 800',employ:'82%',avgAge:'23'},
        5:{students:'~2 400',employ:'91%',avgAge:'22'},
        6:{students:'~2 900',employ:'87%',avgAge:'27'},
        7:{students:'~1 800',employ:'94%',avgAge:'25'},
        8:{students:'~1 200',employ:'78%',avgAge:'26'}
    };
    const stats=eduStats[e.id]||{students:'~2 500',employ:'85%',avgAge:'25'};
    
    // Åldersstatistik (används i både "Du är inte ensam" och "Det här behöver du veta")
    const ageGroup=age<25?'18-24':age<30?'25-29':age<35?'30-34':age<40?'35-39':'40+';
    const ageStats={'18-24':'42%','25-29':'31%','30-34':'15%','35-39':'8%','40+':'4%'};
    const yourAgePercent=ageStats[ageGroup]||'8%';
    
    h+=`<div style="background:#f8f9fa;border-radius:12px;padding:24px;margin-bottom:32px">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--ac)" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
    <h3 style="font-family:'DM Serif Display',serif;font-size:1.3rem;color:var(--ah);margin:0">Du är inte ensam — och du är inte för gammal</h3>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:20px">
    <div>
    <div style="font-size:2rem;font-weight:700;color:var(--ac)">${stats.students}</div>
    <div style="font-size:.88rem;color:#495057">började ${e.t.toLowerCase()}-utbildning förra året</div>
    </div>
    <div>
    <div style="font-size:2rem;font-weight:700;color:var(--ac)">${stats.employ}</div>
    <div style="font-size:.88rem;color:#495057">fick jobb inom 6 månader efter examen</div>
    </div>
    <div>
    <div style="font-size:2rem;font-weight:700;color:var(--ac)">${yourAgePercent}</div>
    <div style="font-size:.88rem;color:#495057">av nybörjarna är i din åldersgrupp (${ageGroup} år)</div>
    </div>
    <div>
    <div style="font-size:2rem;font-weight:700;color:var(--ac)">${stats.avgAge} år</div>
    <div style="font-size:.88rem;color:#495057">medelålder för nybörjare — siffran stiger varje år</div>
    </div>
    </div>
    
    
    
    ${age>=28?`<div style="padding:14px 16px;background:#fff;border-radius:8px;border-left:3px solid var(--ac);font-size:.85rem;color:#495057;line-height:1.65;margin-bottom:12px">
    <strong style="color:var(--ah)">En vanlig oro: "Konkurrerar jag inte ut av yngre med samma examen?"</strong>
    <div style="margin-top:8px">Baserat på efterfrågan inom ${e.t.toLowerCase()} (${e.dem===5?'akut brist':e.dem===4?'hög efterfrågan':'god arbetsmarknad'}) är det troligt att din bakgrund är en <em>fördel</em>, inte ett hinder. Arbetsgivare inom detta yrke söker aktivt personer med livserfarenhet, problemlösningsförmåga och mognad. Din tidigare yrkeskarriär gör dig mer anställningsbar, inte mindre.</div>
    ${e.dem>=4?`<div style="margin-top:8px;padding:8px 10px;background:#f0f4f1;border-radius:6px;font-size:.82rem"><strong>Konkret:</strong> Med ${e.dem===5?'akut brist':'hög efterfrågan'} på ${e.t.toLowerCase()} tar de flesta färska studenter jobb direkt. Fältet är inte nollsummespel — det finns plats för alla som examineras.</div>`:''} 
    </div>`:''}
    
    
    </div>`;
    h+=`</div>`; // end #planOverview
    
    // ═══ BEHÖRIGHET PANEL ═══
    h+=`<div id="planBeh" style="display:none">`;

    // ─── Kurs-till-gym-mappning ───
    const GYM_COURSES={
        natur:['Matte 1','Matte 2a','Matte 2b','Matte 3c','Matte 4','Fysik 1a','Fysik 2','Kemi 1','Kemi 2','Biologi 1','Biologi 2','Naturkunskap 2','Samhällskunskap 1b'],
        teknik:['Matte 1','Matte 2a','Matte 2b','Matte 3c','Matte 4','Fysik 1a','Fysik 2','Kemi 1','Naturkunskap 2','Samhällskunskap 1b'],
        samhall:['Matte 1','Samhällskunskap 1b','Samhällskunskap 2','Historia 1b','Naturkunskap 1a1'], // Matte 2 är valfritt på Samhäll - listas EJ
        ekonomi:['Matte 1','Matte 2a','Matte 2b','Samhällskunskap 1b','Historia 1b','Företagsekonomi 1','Företagsekonomi 2','Naturkunskap 1a1'],
        estet:['Matte 1','Samhällskunskap 1b','Historia 1b','Naturkunskap 1a1'],
        vard:['Matte 1','Samhällskunskap 1b','Naturkunskap 1a1','Naturkunskap 2','Biologi 1','Psykologi 1'],
        bygg:['Matte 1','Matte 2a','Fysik 1a','Samhällskunskap 1b'],
        el:['Matte 1','Matte 2a','Matte 3c','Fysik 1a','Fysik 2','Samhällskunskap 1b'],
        industri:['Matte 1','Matte 2a','Fysik 1a','Samhällskunskap 1b'],
        other:[]
    };
    const myCourses=GYM_COURSES[a.gym]||[];
    const reqStatus=e.req.map(req=>{
        const reqNorm=req.split('/')[0].trim().toLowerCase();
        const found=myCourses.some(mc=>mc.split('/')[0].trim().toLowerCase()===reqNorm||mc.toLowerCase().startsWith(reqNorm.split(' ').slice(0,2).join(' ')));
        return{req,found};
    });

    // ─── Kurskrav + din bakgrund ───
    h+=`<div style="background:#fff;border:2px solid #e0e0d8;border-radius:16px;padding:24px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
    <div style="width:32px;height:32px;border-radius:50%;background:${full?'var(--ac)':part?'#d4a853':'#c24b3b'};color:#fff;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0">${full?'✓':part?'!':'?'}</div>
    <div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.15rem;color:var(--ah)">Behörighet till ${e.t}</div>
    <div style="font-size:.78rem;color:#6c757d">Baserat på att du gick ${gp?gp.l:'gymnasiet'}</div>
    </div>
    </div>
    <div style="margin-bottom:16px;padding:12px 16px;background:${full?'#D9F0E3':part?'#fff3cd':'#f8d7da'};border-radius:10px;border-left:4px solid ${full?'var(--ac)':part?'#d4a853':'#c24b3b'}">
    <div style="font-weight:700;font-size:.9rem;color:${full?'var(--ah)':part?'#856404':'#721c24'};margin-bottom:4px">${full?'✓ Troligen behörig — sök direkt till '+studyStart:part?'⚠ Behöver troligen komplettera ett par kurser':'Kolla dina betyg — behörighet oklart'}</div>
    <div style="font-size:.84rem;color:${full?'var(--ah)':part?'#856404':'#721c24'};line-height:1.6">${full?(gp?gp.l:'Ditt gymnasieprogram')+'-programmet inkluderar normalt alla kurser som '+e.t+' kräver. Kontrollera dina konkreta betyg på antagning.se för att vara helt säker.':part?(gp?gp.l:'Ditt gymnasieprogram')+'-programmet ger dig de flesta grundkraven, men saknar troligen några enstaka kurser. Kika igenom listan nedan.':'Ditt gymnasieprogram inkluderar inte alla kurser som krävs. Se vad du behöver komplettera nedan.'}</div>
    </div>
    <div style="font-size:.82rem;font-weight:700;color:#6c757d;text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px">${e.t} kräver — kurs för kurs</div>
    <div style="display:grid;gap:8px;margin-bottom:14px">
    ${reqStatus.map(rs=>`<div style="display:flex;align-items:center;gap:10px;padding:10px 14px;background:${rs.found?'#f0f4f1':'#fff8e1'};border-radius:8px;border-left:3px solid ${rs.found?'var(--ac)':'#d4a853'}">
    <span style="font-size:1rem;flex-shrink:0">${rs.found?'✅':'⚠️'}</span>
    <div>
    <span style="font-weight:600;font-size:.88rem">${rs.req}</span>
    <div style="font-size:.78rem;color:#6c757d;margin-top:2px">${rs.found?'Ingår troligen i '+(gp?gp.l:'ditt gymnasieprogram')+'-programmet':'Ingår troligen inte i '+(gp?gp.l:'ditt gymnasieprogram')+' — behöver kompletteras via Komvux'}</div>
    </div>
    </div>`).join('')}
    </div>
    <a href="https://www.antagning.se/sv/sokandet/behorighet-och-meriter/" target="_blank" style="display:flex;align-items:center;gap:6px;padding:10px 14px;background:#f0f4f1;border-radius:8px;text-decoration:none;font-size:.84rem;font-weight:600;color:var(--ac)">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
    Verifiera exakt på antagning.se →
    </a>
    </div>`;

    // ─── Antagningspoäng från matchade skolor ───
    const topSchs=schs.slice(0,3);
    if(topSchs.length>0){
    h+=`<div style="background:#fff;border:2px solid #e0e0d8;border-radius:16px;padding:24px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
    <div style="font-family:'DM Serif Display',serif;font-size:1.1rem;color:var(--ah);margin-bottom:4px">Antagningspoäng — dina närmaste alternativ</div>
    <div style="font-size:.78rem;color:#6c757d;margin-bottom:16px">Lägsta poäng från senaste antagningsomgången</div>
    <div style="display:grid;gap:10px">`;
    topSchs.forEach(s=>{
        const cutoffColor=s.cutoff>=20?'#721c24':s.cutoff>=17?'#856404':'var(--ah)';
        const cutoffBg=s.cutoff>=20?'#f8d7da':s.cutoff>=17?'#fff3cd':'#D9F0E3';
        const cutoffLabel=s.cutoff>=20?'Hög konkurrens':s.cutoff>=17?'Medel':'Relativt tillgänglig';
        h+=`<div style="display:flex;align-items:center;gap:12px;padding:12px 16px;background:#f8f9fa;border-radius:10px;border-left:3px solid ${cutoffColor}">
        <div style="flex:1;min-width:0">
        <div style="font-weight:700;font-size:.88rem;color:var(--ah)">${s.school}</div>
        <div style="font-size:.78rem;color:#6c757d;margin-top:2px">${s.n}${s.f==='distance'?' · Distans':s.f==='campus'?' · Campus':''} · ${s.length}</div>
        </div>
        <div style="text-align:right;flex-shrink:0">
        <div style="padding:4px 10px;background:${cutoffBg};border-radius:6px;font-size:.82rem;font-weight:700;color:${cutoffColor}">${s.cutoff>0?s.cutoff+' meritpoäng':'—'}</div>
        <div style="font-size:.7rem;color:#6c757d;margin-top:3px">${cutoffLabel}</div>
        </div>
        </div>`;
    });
    h+=`</div>
    <div style="margin-top:12px;padding:10px 14px;background:#f0f4f1;border-radius:8px;font-size:.8rem;color:var(--ah);line-height:1.5">
    Poängen varierar år för år. Reservantagning ger ofta 30–50% chans även om du är nära gränsen.
    <a href="https://www.antagning.se" target="_blank" style="color:var(--ac);font-weight:600;display:inline-block;margin-top:2px">Kolla exakt poäng på antagning.se →</a>
    </div>
    </div>`;}

    // ─── Högskoleprov (HP) ───
    h+=`<div style="background:#fff;border:2px solid #e0e0d8;border-radius:16px;padding:24px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
    <div style="width:32px;height:32px;border-radius:50%;background:#084298;color:#fff;display:flex;align-items:center;justify-content:center;font-size:.85rem;font-weight:700;flex-shrink:0">HP</div>
    <div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.1rem;color:var(--ah)">Högskoleprov — alternativ väg in</div>
    <div style="font-size:.78rem;color:#6c757d">Ca ⅓ av platserna på de flesta program reserveras för HP-antagning</div>
    </div>
    </div>
    <div style="font-size:.84rem;color:#495057;line-height:1.7;margin-bottom:14px">
    Högskolans antagning sker i två kvoter: <strong>kvot 1</strong> (gymnasiebetyg) och <strong>kvot 2</strong> (högskoleprov). Det innebär att även om dina betyg inte räcker kan ett bra HP-resultat ge dig plats. Du tävlar separat mot andra HP-sökande, inte mot dem med höga betyg.
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-bottom:14px">
    <div style="padding:12px;background:#cfe2ff;border-radius:10px;text-align:center">
    <div style="font-size:.68rem;font-weight:700;color:#084298;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Kostnad</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.1rem;color:#084298">450 kr</div>
    </div>
    <div style="padding:12px;background:#cfe2ff;border-radius:10px;text-align:center">
    <div style="font-size:.68rem;font-weight:700;color:#084298;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Genomförs</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.1rem;color:#084298">Vår & höst</div>
    </div>
    <div style="padding:12px;background:#cfe2ff;border-radius:10px;text-align:center">
    <div style="font-size:.68rem;font-weight:700;color:#084298;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Resultat giltigt</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.1rem;color:#084298">5 provomgångar (~2,5 år)</div>
    </div>
    <div style="padding:12px;background:#cfe2ff;border-radius:10px;text-align:center">
    <div style="font-size:.68rem;font-weight:700;color:#084298;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Max poäng</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.1rem;color:#084298">2,0</div>
    </div>
    </div>
    <div style="padding:10px 14px;background:#f0f4ff;border-radius:8px;font-size:.82rem;color:#084298;line-height:1.5;margin-bottom:12px">
    💡 Du kan skriva HP hur många gånger du vill och använda ditt bästa resultat. Många skriver det en gång utan förberedelse, och sedan en gång efter övning — poängen förbättras markant med träning.
    </div>
    <a href="https://www.studera.nu/hogskoleprov/" target="_blank" style="display:flex;align-items:center;gap:6px;padding:10px 14px;background:#cfe2ff;border-radius:8px;text-decoration:none;font-size:.84rem;font-weight:600;color:#084298">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
    Anmäl dig till HP på studera.nu →
    </a>
    </div>`;

    // ─── Komplettering ───
    if(!full){
    const missingReqs=reqStatus.filter(r=>!r.found).map(r=>r.req);
    h+=`<div data-komp style="background:#fff;border:2px solid #e0e0d8;border-radius:16px;padding:24px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
    <div style="font-family:'DM Serif Display',serif;font-size:1.1rem;color:var(--ah)">Komplettering — ${missingReqs.length} kurs${missingReqs.length===1?'':'er'} saknas</div>
    <button onclick="this.closest('[data-komp]').querySelector('[data-komp-detail]').style.display=this.closest('[data-komp]').querySelector('[data-komp-detail]').style.display==='none'?'block':'none';this.textContent=this.textContent==='Visa detaljer ▾'?'Dölj ▴':'Visa detaljer ▾'" style="font-size:.78rem;color:var(--ac);background:none;border:none;cursor:pointer;font-family:inherit;padding:0">Visa detaljer ▾</button>
    </div>
    <div style="font-size:.85rem;color:#495057;margin-bottom:12px">Tar <strong>~${part?'1 termin':'1–2 terminer'}</strong> — båda vägarna är CSN-berättigade (${fmt(BID)} kr/mån i bidrag).</div>
    <div style="padding:8px 12px;background:#f0f4f1;border-radius:8px;font-size:.82rem;color:var(--ah);margin-bottom:14px"><strong>Kurser:</strong> ${missingReqs.length>0?missingReqs.join(' · '):'Se antagning.se'}</div>
    <div data-komp-detail style="display:none"><div style="display:grid;gap:12px;margin-bottom:14px">
    <div style="padding:16px;background:#f0f4f1;border-radius:12px;border:2px solid var(--ac)">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--ac)" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
    <div style="font-weight:700;font-size:.9rem;color:var(--ah)">Heltid dagtid — ~${part?'1 termin':'1–2 terminer'} (snabbast)</div>
    </div>
    <div style="font-size:.84rem;color:#495057;line-height:1.65">
    Komvux heltid, ungefär 08–15 på vardagar — precis som gymnasiet. Klarar du det snabbare ger du dig mer flexibilitet vid ansökan. Kräver att du tar tjänstledighet eller går ner i arbetstid.
    ${part?'Klart till '+studyStart+' — du söker programmet senast '+(studyStart.startsWith('HT')?'15 april':'15 oktober')+' '+startYr+'.':'Sannolikt klart till HT'+(startYr+1)+'.'}
    </div>
    <div style="margin-top:8px;padding:8px 10px;background:#fff;border-radius:6px;font-size:.8rem;color:var(--ac);font-weight:600">
    Kurser att söka: ${missingReqs.length>0?missingReqs.join(' · '):'Se antagning.se för exakta krav'}
    </div>
    </div>
    <div style="padding:16px;background:#fff8e1;border-radius:12px;border:2px solid #d4a853">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#856404" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
    <div style="font-weight:700;font-size:.9rem;color:#856404">Deltid kväll via distans — ${part?'2–3 terminer':'3–4 terminer'} (du behåller lönen)</div>
    </div>
    <div style="font-size:.84rem;color:#495057;line-height:1.65">
    De flesta Komvux erbjuder distansundervisning kvällstid (17–21) och på helger. Du <strong>behåller jobbet och hela din lön</strong> under kompletteringen — det enda du offrar är kvällstid. Kräver disciplin men är ekonomiskt det tryggaste alternativet.
    </div>
    <div style="margin-top:8px;padding:8px 10px;background:#fff;border-radius:6px;font-size:.8rem;color:#856404;font-weight:600">
    Sök hos: ${cityName!=='hela Sverige'?cityName+' Komvux (distans)':'Din kommuns Komvux'} — leta efter kvällskurser i ${missingReqs.length>0?missingReqs[0]:'ämnet'}
    </div>
    </div>
    </div>
    <div style="padding:10px 14px;background:#f8f9fa;border-radius:8px;font-size:.8rem;color:#6c757d;line-height:1.5">
    💡 Sök kurs på <a href="https://www.studera.nu" target="_blank" style="color:var(--ac);font-weight:600">studera.nu</a> — filtrera på distans + kväll + din ort för att hitta exakt rätt kurs.
    </div>
    </div></div>`;}

    h+=`</div>`; // end #planBeh
    
    // ═══ EKONOMI PANEL ═══
    h+=`<div id="planEkon" style="display:none;position:relative">`;

    // — EKONOMI —
    secN++;
    const netNow=afterTax(sal),netCSN=BID+barnCSN+loan+wi,monthDiff=netCSN-netNow;
    h+=`<div class="psec">
    <div style="background:linear-gradient(135deg,var(--ah),var(--ac));border-radius:16px;padding:28px 24px;margin-bottom:24px">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
    <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
    <div style="color:#fff;font-family:'DM Serif Display',serif;font-size:1.8rem">Din ekonomi under studietiden</div>
    </div>
    <div style="color:rgba(255,255,255,.85);font-size:.95rem">${monthDiff>=0?'Baserat på dina svar ser det ut att gå ihop — justera reglagen nedan för att se hur dina val påverkar balansen.':'Du tappar '+fmt(Math.abs(monthDiff))+' kr/mån jämfört med idag — justera lån, hyra och extrajobb nedan för att se vad som funkar för dig.'}</div>
    </div>
    
    <div style="padding:14px 16px;background:#fff;border-radius:10px;border:2px solid #e0e0d8;margin-bottom:20px;font-size:.85rem;color:#495057;line-height:1.65">
    <strong style="color:var(--ah)">Kan man klara sig på CSN?</strong> Baserat på din situation (${hou==='home'?'bo kvar hemma':hou==='student'?'studentboende':'egen bostad'}, ${a.work_during==='no'?'inget extrajobb':'extrajobb'}) ser ditt utgångsläge ${bal>=0?'balanserat ut — men det är tajt':'ansträngt ut'}. ${loan>0?'CSN-lånet ger mer luft i budgeten men bygger skuld som återbetalas efter examen — vad som passar beror på din situation och risktolerans.':'Du klarar dig utan lån i ditt scenario.'} ${a.work_during!=='no'?'Att jobba extra är möjligt — de flesta program tillåter deltid (helger, kväll) utan att studerandet lider.':'Om budgeten kärvar kan ett deltidsjobb (10–15 h/v) göra stor skillnad utan att studierna påverkas.'}
    </div>`;

    // Interactive budget
        // — DIN PLAN I SIFFROR —
    const behText=full?'✅ Behörig direkt':part?'⚠️ Komplettering ~1 termin':'❌ Komplettering krävs';
    const behColor=full?'var(--ah)':part?'#856404':'#721c24';
    const behBg=full?'#D9F0E3':part?'#fff3cd':'#f8d7da';
    const dfaAge=dfa>0?dfa:0;
    const opCostTkr=Math.round(opCost/1000);
    const netGain10yr=yg*10-opCost-debt;
    const netGain10yrTkr=Math.round(netGain10yr/1000);

    h+=`<div class="budget-sticky">
    <div style="font-size:.72rem;font-weight:700;color:#6c757d;text-transform:uppercase;letter-spacing:.6px;margin-bottom:12px">Din plan i siffror — uppdateras när du justerar budgeten</div>
    <div class="mob-grid-2" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:8px">

    <div style="padding:12px 10px;background:${bal>=0?'#D9F0E3':'#f8d7da'};border-radius:13px;text-align:center" id="fBV2wrap">
    <div style="font-size:.6rem;font-weight:700;color:${bal>=0?'var(--ah)':'#721c24'};text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px" id="fBV2lbl">Kvar / mån</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.35rem;color:${bal>=0?'var(--ah)':'#721c24'};line-height:1" id="fBV2">${(bal>=0?'+':'')+fmt(bal)} kr</div>
    <div style="font-size:.65rem;color:${bal>=0?'var(--ah)':'#721c24'};opacity:.8;margin-top:4px">som student</div>
    </div>

    <div style="padding:12px 10px;background:#fff3cd;border-radius:13px;text-align:center">
    <div style="font-size:.6rem;font-weight:700;color:#856404;text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px">CSN-skuld</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.35rem;color:#856404;line-height:1" id="fD2s">${fmt(debt)} kr</div>
    <div style="font-size:.65rem;color:#856404;opacity:.8;margin-top:4px">${fmt(loan)} kr/mån × ${mo} mån</div>
    </div>

    <div style="padding:12px 10px;background:${netGain10yr>0?'#D9F0E3':'#fff3cd'};border-radius:13px;text-align:center">
    <div style="font-size:.6rem;font-weight:700;color:${netGain10yr>0?'var(--ah)':'#856404'};text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px">Vinst år 10</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.35rem;color:${netGain10yr>0?'var(--ah)':'#856404'};line-height:1">${netGain10yr>0?'+':'-'}${fmt(Math.abs(netGain10yr))} kr</div>
    <div style="font-size:.65rem;color:${netGain10yr>0?'var(--ah)':'#856404'};opacity:.8;margin-top:4px">netto vs att stanna</div>
    </div>

    </div>
    <div class="mob-grid-2" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">

    <div style="padding:12px 10px;background:var(--al);border-radius:13px;text-align:center">
    <div style="font-size:.6rem;font-weight:700;color:var(--ah);text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px">Återbetalning</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.35rem;color:var(--ah);line-height:1" id="fPB">${pb>0?fmt(pb)+' kr':'—'}</div>
    <div style="font-size:.65rem;color:var(--ah);opacity:.8;margin-top:4px">per mån efter examen</div>
    </div>

    <div style="padding:12px 10px;background:var(--bll);border-radius:13px;text-align:center">
    <div style="font-size:.6rem;font-weight:700;color:var(--bl);text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px">Break-even</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.35rem;color:var(--bl);line-height:1" id="fBE">${be>0&&be<50?'~'+be+' år':'—'}</div>
    <div style="font-size:.65rem;color:var(--bl);opacity:.8;margin-top:4px">sedan tjänar du mer livet ut</div>
    </div>

    <div style="padding:12px 10px;background:#D9F0E3;border-radius:13px;text-align:center">
    <div style="font-size:.6rem;font-weight:700;color:var(--ah);text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px">Toppinkomst</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.35rem;color:var(--ah);line-height:1">${fmt(e.s1)} kr</div>
    <div style="font-size:.65rem;color:var(--ah);opacity:.8;margin-top:4px">med erfarenhet som ${e.t.toLowerCase()}</div>
    </div>

    </div>
    </div>`;

        h+=`<div style="background:linear-gradient(135deg,var(--ah),var(--ac));border-radius:16px;padding:28px 24px;margin:32px 0 24px">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
    <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/></svg>
    <div style="color:#fff;font-family:'DM Serif Display',serif;font-size:1.8rem">Din interaktiva budget</div>
    </div>
    <div style="color:rgba(255,255,255,.85);font-size:.95rem">Dra i reglagen för att hitta din balans</div>
    </div>
    
    <div class="pcard" style="border:none;box-shadow:0 2px 12px rgba(0,0,0,.08)"><div class="pcardb">
    <div style="font-weight:600;font-size:.82rem;color:#495057;margin-bottom:12px;text-transform:uppercase;letter-spacing:.5px">Inkomster</div>
    <div class="brow" style="background:#D9F0E3;border-left:4px solid var(--ac)"><label>CSN Bidrag</label><span class="bv" style="color:var(--ah)">${fmt(BID)} kr</span></div>`;
    
    if(barnCSN){
        h+=`<div class="brow" style="background:#D9F0E3;border-left:4px solid var(--ac)"><label>Barntillägg CSN</label><span class="bv" style="color:var(--ah)">${fmt(barnCSN)} kr</span></div>`;
    }
    
    h+=`<div class="bsrow" style="background:#fff3cd;border-left:4px solid #d4a853">
    <div style="display:flex;justify-content:space-between"><label style="font-size:.88rem;font-weight:600">CSN Lån</label><span class="bv" style="color:#856404" id="fLV">${fmt(loan)} kr</span></div>`;
    
    if(a.need_csn==='grant'){
        h+=`<div style="font-size:.72rem;color:#856404;margin-bottom:6px;line-height:1.4;opacity:.85">Du valde endast bidrag. Lånet är frivilligt och kan aktiveras om du behöver.</div>`;
    }else if(a.need_csn==='no'){
        h+=`<div style="font-size:.72rem;color:#856404;margin-bottom:6px;line-height:1.4;opacity:.85">Du valde inget CSN-stöd. Lånet kan aktiveras om du ändrar dig.</div>`;
    }else{
        h+=`<div style="font-size:.72rem;color:#856404;margin-bottom:6px;line-height:1.4;opacity:.85">Frivilligt lån med låg ränta (~0.55%). Justera efter behov.</div>`;
    }
    
    h+=`<input type="range" class="bslider" id="fL" min="0" max="9484" step="100" value="${loan}" oninput="upd()" style="accent-color:#d4a853;width:100%">
    <div class="bsmeta"><span>0 kr</span><span>Max 9 484 kr</span></div>
    </div>
    <div class="bsrow" style="background:#cfe2ff;border-left:4px solid #084298">
    <div style="display:flex;justify-content:space-between;margin-bottom:6px">
    <label style="font-size:.88rem;font-weight:600">Extrajobb</label>
    <span class="bv" style="color:#084298" id="fWV">${fmt(wi)} kr</span>
    </div>
    <div style="font-size:.72rem;color:#084298;margin-bottom:6px;line-height:1.4;opacity:.85">Timmar per vecka × timlön</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:8px">
    <div>
    <div style="font-size:.75rem;color:#495057;margin-bottom:4px">Timmar/vecka</div>
    <input type="range" class="bslider" id="fW" min="0" max="20" step="1" value="${wh}" oninput="upd()" style="accent-color:#084298;width:100%">
    <div class="bsmeta" style="margin-top:2px"><span>0 h</span><span id="fWH">${wh} h</span></div>
    </div>
    <div>
    <div style="font-size:.75rem;color:#495057;margin-bottom:4px">Timlön</div>
    <input type="range" class="bslider" id="fWR" min="100" max="250" step="5" value="${WR}" oninput="upd()" style="accent-color:#084298;width:100%">
    <div class="bsmeta" style="margin-top:2px"><span>100 kr</span><span id="fWRL">${WR} kr</span></div>
    </div>
    </div>
    </div>
    <div class="btot" style="background:var(--ac);color:#fff"><span>Totalt in</span><span id="fTI">${fmt(ti)} kr</span></div>
    <div style="font-weight:600;font-size:.82rem;color:#495057;margin:20px 0 12px;text-transform:uppercase;letter-spacing:.5px">Utgifter</div>
    <div class="bsrow" style="background:#f8d7da;border-left:4px solid #c24b3b">
    <div style="display:flex;justify-content:space-between;margin-bottom:6px"><label style="font-size:.88rem;font-weight:600">Boende</label><span class="bv" style="color:#721c24" id="fRV">${fmt(rent)} kr</span></div>`;
    
    if(hou==='home'){
        h+=`<div style="font-size:.72rem;color:#721c24;margin-bottom:6px;line-height:1.4;opacity:.85">Du bor kvar där du bor nu. Boendekostnaden ingår i dina fasta utgifter nedan.</div>`;
    }else{
        h+=`<div style="font-size:.72rem;color:#721c24;margin-bottom:6px;line-height:1.4;opacity:.85">Beräknat för ${hn[hou]} i ${cityName}. Snitt: ${fmt(defRent)} kr. Justera efter din verklighet med slidern.</div>`;
    }
    
    h+=`<div id="houBtns" style="display:flex;gap:4px;margin-bottom:8px">
    <button class="houbtn${hou==='student'?' hact':''}" onclick="setHou('student',this)">Studentboende</button>
    <button class="houbtn${hou==='shared'?' hact':''}" onclick="setHou('shared',this)">Delad lgh</button>
    <button class="houbtn${hou==='rental'?' hact':''}" onclick="setHou('rental',this)">Hyresrätt</button>
    <button class="houbtn${hou==='home'?' hact':''}" onclick="setHou('home',this)">Bo kvar</button>
    </div>
    <div style="position:relative"><input type="range" class="bslider" id="fR" min="0" max="12000" step="250" value="${rent}" oninput="upd()" style="accent-color:#c24b3b;width:100%"><div id="fRMark" style="position:absolute;top:-2px;width:2px;height:12px;background:#721c24;border-radius:1px;pointer-events:none;left:${defRent/12000*100}%"></div></div>
    <div class="bsmeta"><span>0 kr</span><span id="fRDef">Snitt ${hn[hou]}: ${fmt(defRent)} kr</span></div>
    </div>
    <div class="brow" style="background:#f5f5f0;border-left:4px solid #6c757d"><label>Levnadskostnader</label><span class="bv" style="color:#495057" id="fUserExp">${fmt(userExp)} kr</span></div>
    
    <div id="expensesSection">`;
    
    if(hou==='home'){
        h+=`<div style="font-size:.72rem;color:#495057;margin:-4px 0 8px 0;padding:0 12px;line-height:1.4;opacity:.85">Dina fasta utgifter + rörliga utgifter. Inkluderar din nuvarande hyra.</div>`;
    }else{
        h+=`<div style="font-size:.72rem;color:#495057;margin:-4px 0 8px 0;padding:0 12px;line-height:1.4;opacity:.85">Endast rörliga utgifter (mat, transport, nöje). Boende är separat ovan.</div>`;
    }
    
    h+=`<div style="padding:12px;background:#fff;border-radius:8px;margin-bottom:8px;border:1px solid #dee2e6">`;
    
    if(hou==='home'){
        h+=`<div style="margin-bottom:12px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <label style="font-size:.85rem;font-weight:600;color:#495057">Fasta utgifter</label>
        <span style="font-size:.95rem;font-weight:600;color:#495057" id="fFixedExp">${fmt(fixedExp)} kr</span>
        </div>
        <input type="range" class="bslider" id="fFixed" min="3000" max="20000" step="250" value="${fixedExp}" oninput="upd()" style="accent-color:#6c757d;width:100%">
        <div class="bsmeta"><span>3 000 kr</span><span>20 000 kr</span></div>
        <div style="font-size:.72rem;color:#6c757d;margin-top:4px;opacity:.85">Hyra, el, försäkringar, abonnemang</div>
        </div>`;
    }
    
    h+=`<div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
    <label style="font-size:.85rem;font-weight:600;color:#495057">Rörliga utgifter</label>
    <span style="font-size:.95rem;font-weight:600;color:#495057" id="fVarExp">${fmt(variableExp)} kr</span>
    </div>
    <input type="range" class="bslider" id="fVariable" min="1000" max="10000" step="250" value="${variableExp}" oninput="upd()" style="accent-color:#6c757d;width:100%">
    <div class="bsmeta"><span>1 000 kr</span><span>10 000 kr</span></div>
    <div style="font-size:.72rem;color:#6c757d;margin-top:4px;opacity:.85">Mat, transport, nöje, kläder</div>
    </div>
    </div>
    </div>`;
    
    if(a.has_kids==='yes'){
        h+=`<div class="brow" style="background:#f5f5f0;border-left:4px solid #6c757d"><label>Barnomsorg / barnkostnader</label><span class="bv" style="color:#495057">${fmt(cc)} kr</span></div>`;
    }
    
    h+=`<div class="btot" style="background:#6c757d;color:#fff"><span>Totalt ut</span><span id="fTO">${fmt(to)} kr</span></div>`;
    
    h+=`<div style="background:${bal>=0?'#D9F0E3':'#f8d7da'};border:2px solid ${bal>=0?'var(--ac)':'#c24b3b'};border-radius:12px;padding:20px;margin-top:16px" id="fBx">
    <div style="font-size:.82rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:${bal>=0?'var(--ah)':'#721c24'};margin-bottom:8px" id="fBL">${bal>=0?'Kvar varje månad':'Underskott'}</div>
    <div style="font-family:'DM Serif Display',serif;font-size:2rem;color:${bal>=0?'var(--ah)':'#721c24'};margin-bottom:8px" id="fBV">${(bal>=0?'+':'')+fmt(bal)} kr</div>
    <div style="font-size:.88rem;color:${bal>=0?'var(--ah)':'#721c24'};opacity:.9" id="fBA">${bal>=500?'Bra marginal!':bal>=0?'Tight men funkar.':'Öka lån, sänk hyra eller extrajobb.'}</div>
    </div>
    </div></div>`;

    // CSN DEBT - Dynamic banner that updates based on slider
    h+=`<div id="debtBanner"></div>`;

    h+=`</div>`; // end ekonomi psec
    h+=`</div>`; // end #planEkon
    
    h+=`<div id="planLifeChange" style="display:none">`;

    // — HUR LIVET FÖRÄNDRAS —
    secN++;
    h+=`<div style="background:linear-gradient(135deg,var(--ah),var(--ac));border-radius:16px;padding:28px 24px;margin:32px 0 24px">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
    <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
    <div style="color:#fff;font-family:'DM Serif Display',serif;font-size:1.8rem">Från jobb till studentliv</div>
    </div>
    <div style="color:rgba(255,255,255,.85);font-size:.95rem">Så här förändras din vardag</div>
    </div>`;
    
    h+=`<div class="pcard" style="border:none;box-shadow:0 2px 12px rgba(0,0,0,.08)"><div class="pcardb" style="display:grid;gap:20px">
    <div style="display:flex;gap:12px"><div style="width:36px;height:36px;border-radius:10px;background:var(--bll);display:flex;align-items:center;justify-content:center;flex-shrink:0"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--bl)" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div><div><div style="font-weight:700;font-size:.88rem">Studietakt: Heltid</div><div style="font-size:.82rem;color:var(--mu)">~40 h/vecka. Föreläsningar, labbar, grupparbeten. ${e.y} år till examen.</div></div></div>
    <div style="display:flex;gap:12px"><div style="width:36px;height:36px;border-radius:10px;background:var(--al);display:flex;align-items:center;justify-content:center;flex-shrink:0"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--ac)" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div><div><div style="font-weight:700;font-size:.88rem">Studieform: ${formTxt}</div><div style="font-size:.82rem;color:var(--mu)">${campus==='distance'?'Hemifrån. Föreläsningar online. Kräver disciplin.':'På plats i '+cityName+'. Lektioner, bibliotek, studiegrupper.'}</div></div></div>
    <div style="display:flex;gap:12px"><div style="width:36px;height:36px;border-radius:10px;background:var(--wl);display:flex;align-items:center;justify-content:center;flex-shrink:0"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--wa)" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/></svg></div><div><div style="font-weight:700;font-size:.88rem">Examen: ${gradYear} — du är ${gradAge} år</div><div style="font-size:.82rem;color:var(--mu)">Ingångslön ${fmt(e.s0)} kr. Toppnivå: ${fmt(e.s1)} kr med erfarenhet.</div></div></div>
    </div></div>`;
    h+=`</div>`;
    h+=`</div>`; // end #planLifeChange

    // ═══════════════════════════════════════
    // HANDLINGSPLAN PANEL
    // ═══════════════════════════════════════
    h+=`<div id="planTid" style="display:none">`;

    // ─── Varför-echo (speglar tillbaka deras anledning) ───
    // ─── Datum-beräkningar ───
    const applyDateAction=studyStart.startsWith('HT')?new Date(startYr+compTime,3,15):new Date(startYr+compTime,9,15);
    const daysUntilApply=Math.max(0,Math.ceil((applyDateAction-Date.now())/(1000*60*60*24)));
    const startDateAction=studyStart.startsWith('HT')?new Date(startYr+compTime,7,15):new Date(startYr+compTime,0,15);
    const daysUntilStart=Math.max(0,Math.ceil((startDateAction-Date.now())/(1000*60*60*24)));
    const mo3=Math.round(daysUntilStart/30);
    const yr1After=gradYear+1;
    const yr3After=gradYear+3;
    const salYr1=e.s0;
    const salYr3=Math.round(e.s0+(e.s1-e.s0)*0.4);
    const salYr5=Math.round(e.s0+(e.s1-e.s0)*0.75);

    // ─── Fas-rubrik-helper ───
    const fasHeader=(icon,title,sub,col='var(--ah)',bg='linear-gradient(135deg,var(--ah),var(--ac))')=>
        `<div style="background:${bg};border-radius:14px;padding:18px 20px;margin:24px 0 14px;display:flex;align-items:center;gap:12px">
        ${icon}
        <div>
        <div style="color:#fff;font-family:'DM Serif Display',serif;font-size:1.3rem;line-height:1.2">${title}</div>
        <div style="color:rgba(255,255,255,.75);font-size:.8rem;margin-top:2px">${sub}</div>
        </div></div>`;

    // ══════════════════════════════════════════
    // FAS 1 — FÖRBEREDELSE
    // ══════════════════════════════════════════
    h+=fasHeader(
        `<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
        'Fas 1 — Förberedelse',
        `Idag till studiestart ${studyStart} — ${mo3>0?'om ca '+mo3+' månader':'snart'}`
    );

    // Psykologisk öppning Fas 1
    h+=`<div style="font-size:.95rem;line-height:1.75;color:#495057;padding:0 4px 20px;border-bottom:1px solid #e8e4d8;margin-bottom:24px">
    ${mo3<=3?`Du är närmare än du tror. Ansökan stänger om ${mo3>0?mo3+' månader':'kort tid'} — det är tillräckligt med tid om du börjar den här veckan.`
    :mo3<=6?`Du har ${mo3} månader. Det räcker med råge om du börjar nu.`
    :`Du har gott om tid. Använd det till att förbereda dig rätt — inte till att tveka.`}
    </div>`;
    // Viktiga datum-kort
    h+=`<div class="mob-grid-3" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px">
    <div style="padding:14px 10px;background:#fff3cd;border-radius:12px;text-align:center;border:1.5px solid #d4a853">
    <div style="font-family:'DM Serif Display',serif;font-size:1.4rem;color:#856404;line-height:1">${applyDateAction.getDate()} ${['jan','feb','mar','apr','maj','jun','jul','aug','sep','okt','nov','dec'][applyDateAction.getMonth()]}</div>
    <div style="font-size:.68rem;color:#856404;font-weight:700;text-transform:uppercase;margin-top:4px">Ansökan stänger</div>
    <div style="font-size:.7rem;color:#856404;margin-top:2px;opacity:.8">${(()=>{
    const ad=studyStart.startsWith('HT')?new Date(startYr+compTime,2,15):new Date(startYr+compTime,9,15);
    const months=['jan','feb','mar','apr','maj','jun','jul','aug','sep','okt','nov','dec'];
    return daysUntilApply>0?'Ansökan öppnar '+ad.getDate()+' '+months[ad.getMonth()]:'Nu öppen';
})()}</div>
    </div>
    <div style="padding:14px 10px;background:var(--al);border-radius:12px;text-align:center;border:1.5px solid var(--ac)">
    <div style="font-family:'DM Serif Display',serif;font-size:1.4rem;color:var(--ah);line-height:1">${studyStart.startsWith('HT')?'Juli':'Dec'}</div>
    <div style="font-size:.68rem;color:var(--ah);font-weight:700;text-transform:uppercase;margin-top:4px">Antagningsbesked</div>
    <div style="font-size:.7rem;color:var(--ah);margin-top:2px;opacity:.8">${startYr+compTime}</div>
    </div>
    <div style="padding:14px 10px;background:#D9F0E3;border-radius:12px;text-align:center;border:1.5px solid var(--ac)">
    <div style="font-family:'DM Serif Display',serif;font-size:1.4rem;color:var(--ah);line-height:1">${studyStart.startsWith('HT')?'Aug':'Jan'}</div>
    <div style="font-size:.68rem;color:var(--ah);font-weight:700;text-transform:uppercase;margin-top:4px">Studiestart</div>
    <div style="font-size:.7rem;color:var(--ah);margin-top:2px;opacity:.8">${startYr+compTime}</div>
    </div>
    </div>`;

    // Steg till studiestart
    h+=`<div style="display:grid;gap:8px;margin-bottom:8px">`;
    let sN=0;
    const step=(when,title,desc,urgent=false)=>
        `<div style="display:flex;gap:12px;padding:14px;background:#fff;border-radius:11px;border:${urgent?'2px solid var(--ac)':'1px solid #e0e0d8'}">
        <div style="flex-shrink:0;width:26px;height:26px;border-radius:50%;background:${urgent?'var(--ac)':'#f0f4f1'};color:${urgent?'#fff':'#6c757d'};display:flex;align-items:center;justify-content:center;font-size:.78rem;font-weight:700;margin-top:1px">${++sN}</div>
        <div style="flex:1">
        <div style="font-size:.66rem;font-weight:700;color:${urgent?'var(--ac)':'#6c757d'};text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px">${when}</div>
        <div style="font-weight:700;font-size:.9rem;color:var(--ah);margin-bottom:3px">${title}</div>
        <div style="font-size:.82rem;color:#495057;line-height:1.6">${desc}</div>
        </div></div>`;

    if(a.has_grades==='unsure'){
        h+=step('Denna vecka','Kolla dina gymnasiebetyg',`Logga in på <strong>antagning.se</strong> med BankID → "Mina meriter". ${e.t} kräver: <strong>${e.req.join(', ')}</strong>. Ta 10 minuter nu — det avgör resten av planen.`,true);
    } else if(need){
        h+=step('Inom 2 veckor',`Ansök till Komvux i ${cityName!=='hela Sverige'?cityName:'din kommun'}`,`Du saknar troligen <strong>${reqStatus.filter(r=>!r.found).map(r=>r.req).join(' och ')}</strong>. Välj ${a.work_status==='fulltime'?'<strong>deltid kväll/distans</strong> — du behåller jobbet':'<strong>heltid</strong> — snabbaste vägen'}. Sök på studera.nu, filtrera på distans + kväll. Klart till ${studyStart.startsWith('HT')?'HT'+(startYr+1):'VT'+(startYr+1)}.`,true);
    }
    if(a.savings_amount==='none'||a.savings_amount==='under10'){
        const buf=Math.round(to*2);
        h+=step('Redan nu',`Bygg en startbuffert: ${fmt(buf)} kr`,`CSN tar 4–6 veckor på att betala ut. Utan buffert är du i kläm direkt. Öppna ett separat sparkonto nu — sätt in ${fmt(Math.round(buf/Math.max(2,Math.round(mo3/2))))} kr/mån tills studiestart.`);
    }
    if(showHousing){
        const housingTitle=isMovingCity?`Ordna boende i ${studyCityName}`:`Hitta ${hn[hou]} i ${cityName}`;
        const housingUrgency=hou==='student'&&isMovingCity?'Så snart som möjligt — kötid kan vara lång':hou==='student'?'Så snart som möjligt':'Innan studiestart';
        let housingDesc='';
        if(hou==='student'){
            housingDesc=`Ställ dig i <strong>${kotidInfo.org}</strong>s kö idag. Kötid i ${studyCityName}: <strong>ca ${kotidInfo.q}</strong>. Gratis att stå i kö — registrera dig nu på <strong>${kotidInfo.url.replace('https://','')}</strong>. Du kan alltid tacka nej om planerna ändras.`;
            if(isMovingCity){
                housingDesc=`Du verkar sikta på ${studyCityName}. Ställ dig i <strong>${kotidInfo.org}</strong>s kö <em>idag</em> — kötiden är ca <strong>${kotidInfo.q}</strong>. Det är gratis och du förlorar ingenting på att köa tidigt.`;
            }
        } else if(hou==='shared'){
            housingDesc=`Sök delad lägenhet i ${isMovingCity?studyCityName:cityName} via Blocket och Facebook-grupper. Budget: <strong>${fmt(rent)} kr/mån</strong>. Börja leta 2–3 månader före studiestart. Kontraktstid är ofta 1 år — kolla att det stämmer med din studielängd.`;
        } else {
            housingDesc=`Sök hyresrätt i ${isMovingCity?studyCityName:cityName} via <strong>Blocket</strong> och ${isMovingCity?studyCityName:cityName}s bostadsförmedling. Budget: <strong>${fmt(rent)} kr/mån</strong>. Räkna med 2–4 månaders ledtid.`;
        }
        h+=step(housingUrgency,housingTitle,housingDesc,hou==='student'&&isMovingCity);
    }
    if(a.work_status==='fulltime'||a.work_status==='parttime'){
        h+=step('2–3 mån före start','Prata med din arbetsgivare',`Undersök om tjänstledighet är möjligt — du har rätt att söka det (Studieledighetslagen). ${a.study_pace==='parttime'?'Med deltidsstudier kan du kanske gå ner till halvtid istället för att säga upp dig helt.':'Om du måste säga upp dig: kolla din uppsägningstid och beräkna innestående semesterdagar som extra buffert.'}`);
    }
    h+=step(`Senast ${studyStart.startsWith('HT')?'15 april':'15 oktober'} ${startYr+compTime}`,`Sök ${e.t} på antagning.se`,`Sök det här programmet plus 2–3 backupalternativ. Du kan prioritera upp till 20 program — använd det. ${schs.length>0?'Dina närmaste alternativ: <strong>'+schs.slice(0,2).map(s=>s.school).join('</strong>, <strong>')+'</strong>.':''}`,true);
    if(a.need_csn!=='no'){
        h+=step('Direkt efter antagningsbesked','Ansök om CSN på csn.se',`Bidrag: <strong>${fmt(BID)} kr/mån</strong>${barnCSN?' + barntillägg '+fmt(barnCSN)+' kr':''}${loan>0?'. Lån: <strong>'+fmt(loan)+' kr/mån</strong>':''}. Ansök direkt — CSN betalar inte retroaktivt. Ha personnummer och programkod redo.`);
    }
    h+=step(studyStart.startsWith('HT')?'Augusti '+(startYr+compTime):'Januari '+(startYr+compTime),'STUDIESTART',`${Math.ceil(ry)} år. Du tar examen ${gradYear} — ${gradAge} år gammal.`);
    h+=`</div>`;

    // ══════════════════════════════════════════
    // FAS 2 — STUDIETIDEN
    // ══════════════════════════════════════════
    h+=fasHeader(
        `<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>`,
        'Fas 2 — Studietiden',
        `${Math.ceil(ry)} år — ${studyStart} ${startYr+compTime} till examen ${gradYear}`,
        'var(--ah)','linear-gradient(135deg,var(--ah),#356b4b)'
    );

    // Intro-text baserad på studieform
    const studieIntro=a.study_pace==='parttime'?`Du studerar på deltid — det tar längre men du behåller inkomst och minskar ekonomisk stress. De flesta som studerar deltid säger att det är mer hållbart än de trodde.`:a.study_mode==='distance'?`Du studerar på distans — stor frihet men kräver struktur. Schemalägg studietid i din kalender som fasta block, annars skjuter du upp det.`:`Du studerar på heltid. Det går fort — och det är intensivt. Planera in buffert i schema och ekonomi redan nu.`;
    h+=`<div style="padding:14px 16px;background:var(--al);border-radius:10px;border-left:3px solid var(--ac);font-size:.85rem;color:var(--ah);line-height:1.65;margin-bottom:14px">${studieIntro}</div>`;

    // Psykologisk mening Fas 2
    h+=`<div style="padding:14px 16px;background:rgba(0,0,0,.04);border-radius:10px;font-size:.9rem;line-height:1.7;color:#3a4a3a;margin-bottom:20px;border-left:3px solid var(--ac)">
    ${Math.ceil(ry)} år går oavsett. Frågan är om du är ${gradAge} med eller utan examen.
    </div>`;
    // Termin/år-kort
    const termCards=[
        {period:`Vecka 1–4`,title:'Det vilda startskedet',
        desc:`CSN har inte betalat ut än — <strong>du behöver bufferten du byggde</strong>. Introduktionsveckan är intensiv: nya människor, nytt system, ny rutin. Känslan av att "alla verkar veta mer än jag" är universell och går över. Första utbetalningen från CSN kommer vecka 5–6.`,
        note:loan>0?`Budget dessa veckor: sparad buffert + eventuell lön om du jobbar extra.`:`Bidrag startar vecka 5–6: ${fmt(BID)} kr/mån.`},

        {period:`Termin 1`,title:'Det svåraste halvåret',
        desc:`Studietakten är annorlunda än jobbet — mer självstudier, mer ansvar. ${e.id===1?'VFU-veckor (praktik på vårdinstitution) börjar redan år 1 för många sjuksköterskeprogrammen.':e.id===2?'Första programmeringskurserna är intensiva. Plug-and-play lösningar finns inte — du måste förstå.':'Det tar en termin att lära sig hur man studerar. Det är normalt.'} De flesta som hoppar av gör det nu — de som stannar kvar är nöjda att de gjorde det.`,
        note:`${a.work_during!=='no'?'Du planerar att jobba extra — håll det under 10–15 h/v det första halvåret.':'Om ekonomin kärvar: ett extra skifte i veckan gör stor skillnad utan att studierna påverkas.'}`},

        {period:`År ${Math.min(2,Math.ceil(ry))}${Math.ceil(ry)>1?'–'+Math.ceil(ry-1):''}`,title:'Ryggmärgen',
        desc:`Nu vet du hur systemet fungerar. Examinationsstressen minskar. Du börjar se dig själv som ${e.t.toLowerCase()}. ${e.id===1?'VFU-perioder börjar växa — du träffar patienter, arbetar i team, förstår varför du valde detta.':e.id===2?'Du börjar bygga projekt, lär dig Git, förstår varför saker fungerar som de gör.':'Kurser som kändes abstrakta år 1 faller på plats.'} ${a.has_partner==='yes_same'?'Stäm av regelbundet med din partner — studietiden påverkar relationen mer än folk tror, men det går om ni pratar om det.':''}`,
        note:debt>0?`Du betalar inga CSN-lån under studietiden. Skulden ${fmt(debt)} kr väntar tills examen.`:`Du studerar utan lån — det håller skuldsättningen låg.`},

        {period:`Sista terminen`,title:'Rakan mot examen',
        desc:`${e.id===1?'Examensarbete + sista VFU-blocken. Många tackar ja till jobb på sin VFU-plats direkt.':e.id===2?'Examensarbete och ofta en LIA-praktik (Lärande i arbete) där de flesta får jobberbud.':'Examensarbete. Börja nätverka nu — LinkedIN, branschevent, studiepraktik.'} Börja söka jobb <strong>3–4 månader före examen</strong>. Arbetsgivare räknar med att du börjar månaden efter.`,
        note:`Examen: ${gradYear}. Du är ${gradAge} år.`}
    ];

    h+=`<div style="display:grid;gap:10px;margin-bottom:8px">`;
    termCards.slice(0,Math.ceil(ry)>=2?4:2).forEach(tc=>{
        h+=`<div style="background:#fff;border-radius:12px;border:1px solid #e0e0d8;overflow:hidden">
        <div style="padding:10px 14px;background:#f8f9fa;border-bottom:1px solid #e0e0d8;display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700;font-size:.85rem;color:var(--ah)">${tc.title}</div>
        <div style="font-size:.72rem;font-weight:700;color:var(--ac);background:var(--al);padding:3px 10px;border-radius:20px">${tc.period}</div>
        </div>
        <div style="padding:14px">
        <div style="font-size:.84rem;color:#495057;line-height:1.7;margin-bottom:8px">${tc.desc}</div>
        <div style="font-size:.78rem;color:#6c757d;padding:8px 12px;background:#f8f9fa;border-radius:7px;border-left:2px solid #d0d0c8">${tc.note}</div>
        </div>
        </div>`;
    });
    h+=`</div>`;

    // ══════════════════════════════════════════
    // FAS 3 — LIVET EFTER
    // ══════════════════════════════════════════
    h+=fasHeader(
        `<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/><path d="M13 13l6 6"/></svg>`,
        'Fas 3 — Livet efter examen',
        `${gradYear} och framåt — ${gradAge} år gammal`,
        'var(--ah)','linear-gradient(135deg,#1a4530,var(--ac))'
    );

    h+=`<div style="padding:14px 16px;background:rgba(0,0,0,.04);border-radius:10px;font-size:.9rem;line-height:1.7;color:#3a4a3a;margin-bottom:20px;border-left:3px solid var(--ac)">
    Det här är inte en dröm längre. Det är ett schema.
    </div>
    <div style="display:grid;gap:10px;margin-bottom:16px">

    <div style="background:#fff;border-radius:12px;border:1px solid #e0e0d8;overflow:hidden">
    <div style="padding:10px 14px;background:#D9F0E3;border-bottom:1px solid rgba(122,194,154,.3);display:flex;justify-content:space-between;align-items:center">
    <div style="font-weight:700;font-size:.85rem;color:var(--ah)">Första jobbet — År 1</div>
    <div style="font-size:.8rem;font-weight:700;color:var(--ah)">${fmt(salYr1)} kr/mån</div>
    </div>
    <div style="padding:14px;font-size:.84rem;color:#495057;line-height:1.7">
    Ingångslönen för ${e.t.toLowerCase()} är <strong>${fmt(salYr1)} kr/mån</strong>. ${e.dem>=4?'Med '+( e.dem===5?'akut':'hög')+' efterfrågan tar de flesta examinerade jobb inom 1–3 månader. Arbetsgivare rekryterar aktivt.':'Rekryteringstiden varierar — räkna med 1–4 månader.'} 
    ${debt>0?`<br><br>CSN-återbetalning startar ~6 månader efter examen: ca <strong>${fmt(pb)} kr/mån</strong>. Du tjänar ${fmt(salYr1-pb)} kr (brutto) efter amortering — ${salYr1-pb>+(a.current_salary||0)?'mer än du tjänar idag':'justerat för återbetalning'}.`:'Inga studielån att betala tillbaka.'}
    </div>
    </div>

    <div style="background:#fff;border-radius:12px;border:1px solid #e0e0d8;overflow:hidden">
    <div style="padding:10px 14px;background:var(--al);border-bottom:1px solid #d0e4d6;display:flex;justify-content:space-between;align-items:center">
    <div style="font-weight:700;font-size:.85rem;color:var(--ah)">Med erfarenhet — År 3–5</div>
    <div style="font-size:.8rem;font-weight:700;color:var(--ah)">${fmt(salYr3)}–${fmt(salYr5)} kr/mån</div>
    </div>
    <div style="padding:14px;font-size:.84rem;color:#495057;line-height:1.7">
    Med 3–5 års erfarenhet rör sig lönen mot <strong>${fmt(salYr3)}</strong> (år 3) och <strong>${fmt(salYr5)}</strong> (år 5). 
    ${e.id===1?'Som specialistsjuksköterska (1 extra år) ökar lönen ytterligare — avlönat med specialisttillägg på 2 000–5 000 kr/mån.':e.id===2?'Seniora systemutvecklare kan förhandla lön aktivt — 5 000–15 000 kr-hopp är vanliga på 3–5 år.':e.id===3?'Lärarlönen ökar med erfarenhet och ansvar. Lektors- och förstelärartillägg ger 3 000–6 000 kr extra.':'Löneökningen beror på bransch och arbetsgivare — förhandla aktivt, det lönar sig.'}
    </div>
    </div>

    <div style="background:#fff;border-radius:12px;border:1px solid #e0e0d8;overflow:hidden">
    <div style="padding:10px 14px;background:#cfe2ff;border-bottom:1px solid #b6d4fe;display:flex;justify-content:space-between;align-items:center">
    <div style="font-weight:700;font-size:.85rem;color:#084298">Toppinkomst</div>
    <div style="font-size:.8rem;font-weight:700;color:#084298">${fmt(e.s1)} kr/mån</div>
    </div>
    <div style="padding:14px;font-size:.84rem;color:#495057;line-height:1.7">
    Erfarna ${e.t.toLowerCase().replace(/^./,c=>c.toLowerCase())}s med specialisering, ledarskap eller nischkompetens når <strong>${fmt(e.s1)} kr/mån</strong>. 
    ${be>0&&be<40?`Break-even för din investering är om <strong>~${be} år</strong> — efter det är varje extra månad i yrket ren vinst jämfört med att ha blivit kvar.`:'Investeringen i utbildning lönar sig med ränta på ränta-effekten av den höjda lönen.'}
    </div>
    </div>

    </div>`;

    // Social proof — forum/artikel-stories
    h+=`<div style="margin-bottom:16px">
    <div style="font-size:.72rem;font-weight:700;color:#6c757d;text-transform:uppercase;letter-spacing:.6px;margin-bottom:10px">Erfarenheter från forum och artiklar</div>
    <div style="display:grid;gap:10px">`;

    const stories={
        1:[
            {quote:'Jobbade 8 år i butik. Var 33 när jag sökte sjuksköterskeutbildningen. Trodde att det var för sent — det var det inte. De äldre i klassen var de bästa studenterna.',from:'Flashback, Vård & hälsa',yr:'2023'},
            {quote:'Första terminen var chocken. Ekonomin stressade, jag hann inte med. Andra terminen satte jag ett system och det funkade. Examen togs 2022, jobbar nu på Karolinska.',from:'Reddit r/Sweden, karriärbyte',yr:'2022'},
            {quote:'Rädslan att "inte vara smart nog" är den vanligaste orsaken till att folk inte söker. I klassen på 40 hade hälften jobbat minst 5 år innan.',from:'Universitetslärare citerad i Dagens Nyheter',yr:'2023'}
        ],
        2:[
            {quote:'Bygg i 12 år. Sökte systemutvecklarprogrammet vid 38. Fick jobb på Klarna 3 månader efter examen. Min bakgrund var en fördel — de behövde folk som förstår verkliga problem.',from:'LinkedIn, karriärbyte-tråd',yr:'2023'},
            {quote:'Distansprogrammet höll hela familjelivet intakt. Pluggade på kvällar och helger i 2,5 år. Svårt — men genomförbart. Idag 20 000 kr mer i månaden.',from:'Flashback, Studier & utbildning',yr:'2024'},
            {quote:'Det svåraste var att säga upp mig. Sedan det var gjort försvann tvivlet. Hjärnan slutar hålla två alternativ öppna.',from:'Twitter/X, tråd om karriärbyte',yr:'2023'}
        ],
        3:[
            {quote:'Byte från detaljhandel till lärare vid 31. Praktiken det sista året öppnade alla dörrar — fick jobberbjudande på min VFU-skola direkt.',from:'Lärarförbundets forum',yr:'2023'},
            {quote:'KBT-terapeuten frågade vad jag ville göra om tio år. Lärare. "Vad väntar du på?" Tre år senare tog jag examen.',from:'Aftonbladet, reportage om karriärbyte',yr:'2022'},
            {quote:'Klassen bestod till 60% av folk som bytt karriär. Snittalder 29. Det var inte skolan jag mindes — det var ett lag med syfte.',from:'Flashback, Studier & utbildning',yr:'2024'}
        ],
        4:[
            {quote:'Jobbade som butiksansvarig i 7 år. Sökte civilekonomprogrammet vid 32. Alla sa att det var för sent. Nu är jag controller på ett techbolag — lönen är det dubbla.',from:'LinkedIn, karriärbyte',yr:'2023'},
            {quote:'Det svåraste var att acceptera att betygen från gymnasiet faktiskt räckte. Jag trodde att ekonomiprogram kräver toppbetyg. Det gör de inte om man väljer rätt skola.',from:'Flashback, Studier & utbildning',yr:'2024'},
            {quote:'Businesssidan gav mig perspektiv som de som gick rakt från gymnasiet inte hade. Arbetsgivare frågade aktivt om min tidigare branscherfarenhet.',from:'Reddit r/Ekonomi',yr:'2023'}
        ],
        5:[
            {quote:'Tre år lärling. Sökte civilingenjör vid 26. Kombinationen praktisk erfarenhet + ingenjörsexamen är extremt sällsynt — det märks direkt på löneerbjudandena.',from:'Ingenjören.se, forum',yr:'2023'},
            {quote:'Matte var skräcken. Men det visar sig att vuxna lär sig matte bättre — man förstår varför man lär sig det. Tog Matte 4 på komvux på ett år.',from:'Flashback, Utbildning',yr:'2024'},
            {quote:'Fem år på KTH är en lång tid. Men jag är 31 med ingenjörsexamen och 42 000 kr/mån. Kollegorna som inte pluggade tjänar fortfarande 29 000.',from:'Twitter/X, tråd om ingenjörslön',yr:'2023'}
        ],
        51:[
            {quote:'Indek är bästa kombinationen om du vill leda teknikprojekt men hata att sitta och räkna FEM-simuleringar. Du förstår ingenjörerna och kan prata med ekonomerna.',from:'Reddit r/ingenjor',yr:'2024'},
            {quote:'Jobbet efter examen kom via sommarjobb under år 4. Nätverket på Linköping är exceptionellt — hela Östergötlandsregionen rekryterar därifrån.',from:'Flashback, Jobb & karriär',yr:'2023'},
            {quote:'Ingen ångrade valet av Indek. Det är det enda jag hört från alla på mitt program, och vi är nu 6 år efter examen.',from:'LinkedIn-kommentar, Linköping alumni',yr:'2024'}
        ],
        6:[
            {quote:'Var sjukvårdsbiträde i 9 år. Tog steget till socionom vid 35. Svårt ekonomiskt — men jobbet efteråt är meningsfullt på ett helt annat plan.',from:'Akademikerförbundet SSR, forum',yr:'2023'},
            {quote:'Folk frågar om det är tungt att jobba med svåra fall. Det är det. Men det är också ett av de enda jobb där du faktiskt märker att du gjort skillnad.',from:'Flashback, Vård & omsorg',yr:'2024'},
            {quote:'VFU-handledaren erbjöd mig jobb direkt. 26 veckor praktik bygger relationer och referenserna är guld värda.',from:'Socionomprogrammets alumnigrupp, Facebook',yr:'2023'}
        ],
        7:[
            {quote:'YH-utbildningen var praktisk från dag 1. Inget fluff. Fick jobb 3 veckor efter examen — arbetsgivaren hade sett mig under LIA redan.',from:'Yrgo.se studentblogg',yr:'2024'},
            {quote:'Elektriker är det bästa yrkesvalet jag gjort. Alltid jobb. Kan jobba i alla städer. Kan starta eget. Och AI kan inte dra kabel åt dig.',from:'Flashback, El & energi',yr:'2023'},
            {quote:'Folk tittar ned på yrkesutbildningar. De tjänar 28 000 kr. Jag tjänar 38 000. De undrar varför.',from:'Reddit r/sweden, lön-diskussion',yr:'2024'}
        ],
        8:[
            {quote:'Sökte utan portfolio. Fick backa och börja om med riktiga projekt. Bästa rådet: bygg tre fall-studier under utbildningen — inte kursinlämningar, utan skarpa projekt.',from:'Nackademin studentblogg',yr:'2024'},
            {quote:'AI förändrar UX-rollen, men det gör alla senior-positioner mer värdefulla, inte färre. Du måste kunna designa för och med AI — det är en kompetens, inte ett hot.',from:'Linkedin, UX-debatt',yr:'2024'},
            {quote:'Switchar från marknadsföring. Kursen lärde mig att argumentera med data istället för magkänsla. Det är det som separerar junior från senior UX.',from:'Flashback, Design & kreativt',yr:'2023'}
        ]
    };
    const storySet=stories[e.id]||(stories[5]&&e.id===51?stories[51]:stories[1]);
    storySet.forEach(s=>{
        h+=`<div style="padding:14px 16px;background:#fff;border-radius:11px;border:1px solid #e0e0d8;border-left:3px solid var(--ac)">
        <div style="font-size:.84rem;color:var(--ah);line-height:1.7;margin-bottom:8px;font-style:italic">"${s.quote}"</div>
        <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-size:.72rem;color:#6c757d">${s.from}</div>
        <div style="font-size:.7rem;color:#aaa">${s.yr}</div>
        </div>
        </div>`;
    });
    h+=`</div></div>`;

    // Backup-planer
    h+=`<div style="background:#fff;border-radius:12px;border:1px solid #e0e0d8;padding:18px;margin-bottom:8px">
    <div style="font-weight:700;font-size:.9rem;color:var(--ah);margin-bottom:12px">Om du inte kommer in första gången</div>
    <div style="display:grid;gap:10px">
    <div style="display:flex;gap:10px;align-items:flex-start"><div style="width:6px;height:6px;border-radius:50%;background:var(--ac);flex-shrink:0;margin-top:6px"></div><div style="font-size:.83rem;color:#495057;line-height:1.6"><strong>Reservplats</strong> — tacka alltid ja. Många program fyller på hela juli/december. Chansen är 30–50%.</div></div>
    <div style="display:flex;gap:10px;align-items:flex-start"><div style="width:6px;height:6px;border-radius:50%;background:var(--ac);flex-shrink:0;margin-top:6px"></div><div style="font-size:.83rem;color:#495057;line-height:1.6"><strong>Högskoleprov</strong> — anmäl dig nästa omgång (450 kr). Giltigt i 5 år. Parallell kvot in — du konkurrerar inte mot betygssökande.</div></div>
    <div style="display:flex;gap:10px;align-items:flex-start"><div style="width:6px;height:6px;border-radius:50%;background:var(--ac);flex-shrink:0;margin-top:6px"></div><div style="font-size:.83rem;color:#495057;line-height:1.6"><strong>Annan ort</strong> — lägre antagningspoäng på mindre orter. Kolla Studentum med hela Sverige som filter.</div></div>
    <div style="display:flex;gap:10px;align-items:flex-start"><div style="width:6px;height:6px;border-radius:50%;background:var(--ac);flex-shrink:0;margin-top:6px"></div><div style="font-size:.83rem;color:#495057;line-height:1.6"><strong>Använd tiden väl</strong> — ett år av extra Komvux-kurser, mer besparingar och ett HP-försök gör nästa ansökan avsevärt starkare.</div></div>
    </div>
    </div>`;

    h+=`</div>`; // end #planTid
    
    // ═══ SAMMANFATTNING PANEL ═══
    h+=`<div id="planSkol" style="display:none">`;

    // ── Bygg personlig situationsanalys ──
    const whyMap={meaning:'ett meningsfullt jobb',salary:'bättre lön',burnout:'att lämna ett jobb som tar ut dig',career:'bättre karriärmöjligheter',passion:'följa det du alltid velat göra',other:''};
    const whyText=whyMap[a.why_change]||'';
    const concern=a.biggest_concern||'none';
    const hpConsidered=a.hp_considered||'no';

    // Concern-svar
    const concernReply={
        economy: bal<0?`Ekonomin är din oro — och med nuvarande inställningar är det tight (${(bal>=0?'+':'')+fmt(bal)} kr/mån). Gå till Ekonomi-fliken och prova att höja lånet eller lägga till extrajobb för att se vad som funkar.`:`Du oroar dig för ekonomin, men baserat på dina svar ser det faktiskt okej ut: ${fmt(bal>0?'+'+bal:bal)} kr kvar per månad. Fortsätt finjustera i Ekonomi-fliken.`,
        time: `Tid är en verklig begränsning. ${a.study_pace==='parttime'?'Du har redan valt deltid — det är rätt beslut. Halvfart tar '+Math.ceil(ry*2)+' år men du behåller inkomst och balans.':'Heltid kräver att du frigör ~40 h/v. Om du jobbar idag behöver du planera uppsägning eller tjänstledighet.'}`,
        grades: `Betyg är inte allt — HP ger en separat kvot in. ${hpConsidered==='no'||hpConsidered==='no_considered'?'Du har inte skrivit HP ännu. Anmäl dig nästa omgång (450 kr) och träna på gamla prov — poängen förbättras markant med övning.':'Bra att du redan funderat på HP — håll det som plan B om betygen inte räcker.'}`,
        age: `Åldern är inte ett hinder — det är en fördel. ${age>=35?'Tusentals börjar vid 35+ varje år. Med '+fmt(e.s1)+' kr i toppinkomst och '+(65-age-Math.ceil(ry)-compTime)+' år kvar i yrket betalar investeringen sig klart.':'Du är '+age+' år. Nästan en tredjedel av alla studenter är 25+. Arbetsgivare värdesätter livserfarenhet.'}`,
        job: `Jobbutsikterna för ${e.t.toLowerCase()} är ${e.dem===5?'extremt starka — akut brist i sektorn':e.dem===4?'starka — arbetsgivare söker aktivt':'stabila'}. ${e.dem>=4?'De flesta examinerade tar jobb direkt efter examen.':'Kontrollera den lokala arbetsmarknaden på arbetsformedlingen.se.'}`,
        none: `Du verkar redo — det är bra. Planen nedan är din konkreta väg framåt.`
    };
    const concernText=concernReply[concern]||concernReply.none;

    // Datum-beräkningar
    const now2=new Date();
    const nowMo=now2.getMonth(); // 0-indexed
    const nowYr=now2.getFullYear();
    // Nästa Komvux-ansökan (löpande, men VT startar jan, HT startar aug)
    const komvuxDeadline=nowMo<6?'1 juni '+(nowYr):('1 november '+nowYr);
    const komvuxStartTerm=nowMo<6?'HT'+nowYr:'VT'+(nowYr+1);
    // HP-datum
    const hpNextTerm=nowMo<3?'mars/april '+nowYr:nowMo<8?'oktober '+nowYr:'mars/april '+(nowYr+1);
    const hpDeadline=nowMo<3?'februari '+nowYr:nowMo<8?'september '+nowYr:'februari '+(nowYr+1);
    // Antagning.se deadline
    const _applyDLDate=studyStart.startsWith('HT')?new Date(startYr,3,15):new Date(startYr,9,15);
    const _applyDLNextDate=studyStart.startsWith('HT')?new Date(startYr+1,3,15):new Date(startYr+1,9,15);
    const applyDL=_applyDLDate<now2?(studyStart.startsWith('HT')?'15 april '+(startYr+1):'15 oktober '+(startYr+1)):(studyStart.startsWith('HT')?'15 april '+startYr:'15 oktober '+startYr);

    // Bygg steg
    const steps2=[];
    let stepDue='Denna vecka';

    // Steg 0: Oro-svar
    // (inline i sammanfattningstext)

    // Steg 1: Betyg/behörighet
    if(a.has_grades==='unsure'){
        steps2.push({when:'Denna vecka',icon:'🎓',title:'Kolla dina gymnasiebetyg',desc:'Logga in på <strong>antagning.se</strong> med BankID → "Mina meriter". Ta 10 minuter nu — det avgör hela din tidslinje.',urgent:true});
    } else if(need&&part){
        steps2.push({when:komvuxDeadline,icon:'📚',title:'Ansök till Komvux i '+(cityName!=='hela Sverige'?cityName:'din kommun'),desc:`Du saknar troligen ${reqStatus.filter(r=>!r.found).map(r=>r.req).join(' och ')}. Sök Komvux ${a.work_status==='fulltime'&&a.study_mode!=='distance'?'<strong>deltid kväll/distans</strong> vid sidan av jobbet':'<strong>heltid</strong> för snabbaste väg'}. Deadline: <strong>${komvuxDeadline}</strong> för start ${komvuxStartTerm}.`,urgent:true});
    } else if(need&&!part){
        steps2.push({when:komvuxDeadline,icon:'📚',title:'Starta med Komvux',desc:`Du behöver komplettera ${reqStatus.filter(r=>!r.found).map(r=>r.req).join(', ')}. Sök på <strong>studera.nu</strong> — filtrera på distans + kväll om du vill behålla jobbet. Deadline: <strong>${komvuxDeadline}</strong>.`,urgent:true});
    }

    // Steg 2: HP (om relevant)
    if((hpConsidered==='no_considered'||hpConsidered==='no')&&(need||!full)){
        steps2.push({when:hpDeadline,icon:'📝',title:'Anmäl dig till Högskoleprov',desc:`HP ger dig en separat kvot in — du konkurrerar inte med betygssökande. Anmälan öppnar ca <strong>${hpDeadline}</strong>, provdatum <strong>${hpNextTerm}</strong>. Kostar 450 kr. Träna 2–4 veckor på gamla prov — poängen förbättras tydligt med övning. Anmäl på <strong>studera.nu/hogskoleprov</strong>.`});
    }

    // Steg 3: Buffert om sparande = 0
    if(a.savings_amount==='none'||a.savings_amount==='under10'){
        const buffert=Math.round(to*2);
        const mthsLeft=Math.max(1,Math.ceil((new Date(startYr+compTime,studyStart.startsWith('HT')?7:0,1)-now2)/(1000*60*60*24*30)));
        const savePerMo=Math.round(buffert/Math.min(mthsLeft,6));
        steps2.push({when:'Innan studiestart',icon:'💰',title:`Bygg buffert: ${fmt(buffert)} kr`,desc:`CSN tar 4–6 veckor innan första utbetalning. Du behöver täcka ${fmt(to)} kr/mån i ca 2 månader. Sätt undan ungefär <strong>${fmt(savePerMo)} kr/mån</strong> framåt. Öppna ett separat sparkonto — märk det "Studiestart".`});
    }

    // Steg 4: Boende
    if(showHousing){
        const houTarget=isMovingCity?studyCityName:cityName;
        let houDesc='';
        if(hou==='student'){
            houDesc=`Ställ dig i ${kotidInfo.org}s kö idag — <strong>${kotidInfo.url.replace('https://','')}</strong>. Kötid i ${houTarget}: ca <strong>${kotidInfo.q}</strong>. Gratis att köa, inga förpliktelser.`;
        } else {
            houDesc=`Sök ${hn[hou]} i ${houTarget} via Blocket och lokala Facebook-grupper. Budget: ${fmt(rent)} kr/mån. Börja leta 2–3 månader före studiestart.`;
        }
        steps2.push({when:hou==='student'?'Så snart som möjligt':'Innan studiestart',title:`${isMovingCity?'Flytt till '+houTarget+' — ordna boende':'Ordna '+hn[hou]+' i '+houTarget}`,desc:houDesc});
    }

    // Steg 5: Ansökan till program
    const applyYearNote=compTime>0?` (${compTime} år senare pga. komplettering)`:'';
    steps2.push({when:applyDL+applyYearNote,icon:'🎯',title:`Sök ${e.t} på antagning.se`,desc:`Gå till <strong>antagning.se</strong> → sök "${e.t}" → välj ${schs.length>0?'"'+schs[0].school+(schs.length>1?'" eller "'+schs[1].school:'')+'"':'din skola'}. Du kan prioritera upp till 20 program. <strong>Deadline: ${applyDL}</strong>. Sent inkommen ansökan = ingen plats.${compTime>0?' Obs: Kompletteringen tar '+compTime+(compTime===1?' år':' år') +' — därav det senare datumet.':''}`,urgent:true});

    // Steg 6: CSN
    if(a.need_csn!=='no'){
        const csnYear=startYr+compTime;
        const csnMonth=studyStart.startsWith('HT')?'juli':'december';
        steps2.push({when:'Efter antagningsbesked ('+csnMonth+' '+csnYear+')',icon:'💳',title:'Ansök om CSN',desc:`Logga in på <strong>csn.se</strong> direkt när du fått antagningsbesked. Bidrag: <strong>${fmt(BID)} kr/mån</strong>${barnCSN?' + barntillägg '+fmt(barnCSN)+' kr/mån':''}${loan>0?', lån: '+fmt(loan)+' kr/mån':''}. Viktigt: ansök i tid — utbetalning sker inte retroaktivt.`});
    }

    // Steg 7: Jobbet
    if(a.work_status==='fulltime'||a.work_status==='parttime'){
        const actualStartYr=startYr+compTime;
        const noticeMo=studyStart.startsWith('HT')?'maj/juni '+actualStartYr:'november/december '+(actualStartYr-1);
        steps2.push({when:noticeMo,icon:'💼',title:'Planera din uppsägning',desc:`${a.study_pace==='parttime'?'Du planerar deltid — kolla om din arbetsgivare kan gå ner i tjänst istället för att säga upp. Tjänstledighet för studier är en laglig rättighet (Studieledighetslagen).':'Lämna in din uppsägning i god tid. Kolla din uppsägningstid i anställningsavtalet — vanligtvis 1–3 månader.'} Räkna med innestående semesterdagar som extra buffert.`});
    }

    // Steg 8: Barn
    if(a.has_kids==='yes'){
        steps2.push({when:'Innan studiestart',icon:'👶',title:'Ordna barnomsorg under studietiden',desc:`Kolla om ${cityName!=='hela Sverige'?cityName:'din kommun'} ger studenter förtur i barnomsorgen — många kommuner gör det. Stäm av ditt schema mot barnomsorgens öppettider. ${a.study_mode==='distance'?'Distansstudier ger mer flexibilitet men kräver ändå struktur.':''}`});
    }

    // Lägg till studiestart som sista steg
    steps2.push({when:(studyStart.startsWith('HT')?'Augusti ':'Januari ')+( startYr+compTime),icon:'🎓',title:`STUDIESTART — ${e.t}`,desc:`${ry} år. Examen ${gradYear}, du är ${gradAge} år. Ingångslön: <strong>${fmt(e.s0)} kr/mån</strong>. Toppinkomst med erfarenhet: <strong>${fmt(e.s1)} kr/mån</strong>.`,final:true});

    // ── RENDERA PANELEN ──

    // Intro-kort med oro-svar
    h+=`<div style="background:#fff;border:2px solid #e0e0d8;border-radius:16px;padding:22px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
    <div style="display:flex;align-items:flex-start;gap:12px">
    <div style="width:36px;height:36px;border-radius:50%;background:var(--ac);color:#fff;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0">✦</div>
    <div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.2rem;color:var(--ah);margin-bottom:6px">${firstName} — här är din konkreta plan</div>
    <p style="font-size:.88rem;color:#495057;line-height:1.7;margin-bottom:10px">Du funderar på att bli <strong>${e.t.toLowerCase()}</strong>. Du är ${age} år, tjänar ${fmt(currentSal)} kr/mån idag och vill börja studera ${a.when_start==='asap'?'så snart som möjligt':a.when_start==='next'?'nästa termin':'inom '+a.when_start.replace('mo',' månader').replace('12mo','12 månader')}. Utbildningen tar <strong>${ry} år</strong> och du tar examen <strong>${gradYear}</strong> — ${gradAge} år gammal.</p>
    ${whyText?`<p style="font-size:.88rem;color:#495057;line-height:1.7;margin-bottom:10px">Du vill ha <strong>${whyText}</strong> — planen nedan är byggd för att ta dig dit.</p>`:''}
    ${concern!=='none'?`<div style="padding:10px 14px;background:#f0f4f1;border-radius:8px;border-left:3px solid var(--ac);font-size:.84rem;color:var(--ah);line-height:1.65">${concernText}</div>`:``}
    </div>
    </div>
    </div>`;

    // Live-kort (4 st)
    h+=`<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:20px">
    <div style="padding:12px;background:${bal>=0?'#D9F0E3':'#f8d7da'};border-radius:10px;text-align:center" id="fBV3wrap">
    <div style="font-size:.65rem;font-weight:700;color:${bal>=0?'var(--ah)':'#721c24'};text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px" id="fBV3lbl">Kvar/mån som student</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.2rem;color:${bal>=0?'var(--ah)':'#721c24'}" id="fBV3">${(bal>=0?'+':'')+fmt(bal)} kr</div>
    </div>
    <div style="padding:12px;background:#fff3cd;border-radius:10px;text-align:center">
    <div style="font-size:.65rem;font-weight:700;color:#856404;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">CSN-skuld</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.2rem;color:#856404" id="fD3">${fmt(debt)} kr</div>
    </div>
    <div style="padding:12px;background:var(--bll);border-radius:10px;text-align:center">
    <div style="font-size:.65rem;font-weight:700;color:var(--bl);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Break-even</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.2rem;color:var(--bl)" id="fBE3">${be>0&&be<50?'~'+be+' år':'—'}</div>
    <div style="font-size:.65rem;color:var(--bl);opacity:.8;margin-top:3px">${be>0&&be<50?'från '+( gradYear+be)+' tjänar du mer livet ut':'—'}</div>
    </div>
    <div style="padding:12px;background:#D9F0E3;border-radius:10px;text-align:center">
    <div style="font-size:.65rem;font-weight:700;color:var(--ah);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Examen</div>
    <div style="font-family:'DM Serif Display',serif;font-size:1.2rem;color:var(--ah)">${gradYear} (${gradAge} år)</div>
    </div>
    </div>`;

    // Steg-för-steg plan
    h+=`<div style="background:linear-gradient(135deg,var(--ah),var(--ac));border-radius:14px;padding:20px 18px;margin-bottom:16px">
    <div style="color:#fff;font-family:'DM Serif Display',serif;font-size:1.4rem;margin-bottom:4px">Din plan — steg för steg</div>
    <div style="color:rgba(255,255,255,.8);font-size:.82rem">Baserat på dina svar — i kronologisk ordning</div>
    </div>
    <div style="display:grid;gap:10px;margin-bottom:20px">`;
    steps2.forEach((s,i)=>{
        h+=`<div style="display:flex;gap:14px;padding:16px;background:#fff;border-radius:12px;border:${s.urgent?'2px solid var(--ac)':s.final?'2px solid #d4a853':'1px solid #e0e0d8'};box-shadow:0 1px 6px rgba(0,0,0,.05)">
        <div style="flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:4px">
        <div style="width:32px;height:32px;border-radius:50%;background:${s.final?'#d4a853':s.urgent?'var(--ac)':'#f0f4f1'};color:${s.final||s.urgent?'#fff':'#6c757d'};display:flex;align-items:center;justify-content:center;font-size:.95rem">${s.icon}</div>
        ${i<steps2.length-1?`<div style="width:2px;flex:1;background:#e0e0d8;min-height:16px;margin-top:4px"></div>`:''}
        </div>
        <div style="flex:1;min-width:0">
        <div style="font-size:.7rem;font-weight:700;color:${s.final?'#856404':s.urgent?'var(--ac)':'#6c757d'};text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">${s.when}</div>
        <div style="font-weight:700;font-size:.92rem;color:var(--ah);margin-bottom:4px">${s.title}</div>
        <div style="font-size:.83rem;color:#495057;line-height:1.65">${s.desc}</div>
        </div>
        </div>`;
    });
    h+=`</div>`;

    // Sök utbildning
    const eduTypeText2=Array.isArray(a.education_type)?a.education_type.map(t=>({yh:'Yrkeshögskola',uni:'Högskola/Universitet',komvux:'Komvux',folk:'Folkhögskola',private:'Privat skola'}[t]||t)).filter(t=>t!=='any').join(', '):'';
    const studyModeText2={campus:'Campus',distance:'Distans',hybrid:'Hybrid'}[a.study_mode]||'';
    const filterParts2=[eduTypeText2,studyModeText2,e.t,cityName!=='hela Sverige'?cityName:''].filter(Boolean);

    // ── Skolrekommendation ──
    if(schs.length>0){
        const topSch=schs[0];
        const rec2=schs.length>1?schs[1]:null;
        h+=`<div style="background:#fff;border:2px solid var(--ac);border-radius:16px;padding:22px;margin-bottom:16px;box-shadow:0 4px 16px rgba(122,194,154,.12)">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
        <div style="width:28px;height:28px;border-radius:50%;background:var(--ac);color:#fff;display:flex;align-items:center;justify-content:center;font-size:.82rem;font-weight:700;flex-shrink:0">★</div>
        <div style="font-family:'DM Serif Display',serif;font-size:1.1rem;color:var(--ah)">Vår rekommendation för dig</div>
        </div>
        <div style="padding:16px;background:#f0f4f1;border-radius:12px;margin-bottom:${rec2?'10px':'0'}">
        <div style="font-weight:700;font-size:.95rem;color:var(--ah);margin-bottom:2px">${topSch.school}</div>
        <div style="font-size:.82rem;color:#6c757d;margin-bottom:8px">${topSch.n} · ${topSch.length}${topSch.f==='distance'?' · Distans':topSch.f==='campus'?' · Campus':''}</div>
        <div style="display:flex;flex-wrap:wrap;gap:5px;margin-bottom:10px">${topSch.t.map(tag=>'<span style="background:var(--al);color:var(--ac);padding:3px 9px;border-radius:5px;font-size:.72rem;font-weight:600">'+tag+'</span>').join('')}</div>
        <a href="${topSch.url}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;color:var(--ac);font-size:.82rem;font-weight:700;text-decoration:none">Läs mer på skolans sida →</a>
        </div>
        ${rec2?`<div style="padding:12px 16px;background:#f8f9fa;border-radius:10px;border-left:3px solid #ccc">
        <div style="font-size:.75rem;font-weight:600;color:#6c757d;margin-bottom:2px">Alternativ</div>
        <div style="font-weight:600;font-size:.88rem;color:#495057">${rec2.school} — ${rec2.n}</div>
        <a href="${rec2.url}" target="_blank" style="font-size:.78rem;color:var(--ac);font-weight:600;text-decoration:none">Mer info →</a>
        </div>`:''}
        </div>`;
    }

    h+=`<div style="background:linear-gradient(135deg,var(--ah),var(--ac));border-radius:14px;padding:20px 18px;margin-bottom:14px">
    <div style="color:#fff;font-family:'DM Serif Display',serif;font-size:1.4rem;margin-bottom:4px">Sök din utbildning</div>
    <div style="color:rgba(255,255,255,.8);font-size:.82rem">Filtrerat baserat på dina svar</div>
    </div>
    <div style="background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:14px">
    ${filterParts2.length>0?`<div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px">${filterParts2.map(f=>'<span style="background:#f0f4f1;border:1.5px solid var(--ac);color:var(--ac);padding:5px 12px;border-radius:8px;font-size:.8rem;font-weight:600">'+f+'</span>').join('')}</div>`:``}
    ${a.study_mode==='distance'||a.study_mode==='hybrid'?`<div style="padding:10px 14px;background:var(--al);border-radius:8px;margin-bottom:14px;font-size:.82rem;color:var(--ah)">Distans: Linnéuniversitetet, Mittuniversitetet och Örebro Uni satsar aktivt på flexibla program.</div>`:``}
    <a href="https://www.studentum.se/utbildning" target="_blank" style="display:block;text-align:center;background:linear-gradient(135deg,var(--ac),var(--ah));color:#fff;padding:14px 32px;border-radius:10px;font-weight:700;font-size:1rem;text-decoration:none;box-shadow:0 4px 12px rgba(122,194,154,.3)">
    Sök på Studentum →
    </a>
    </div>`;

    // Vill du testa + upsell
    h+=`<div style="padding:18px 20px;background:#fff;border-radius:12px;border:2px solid #e0e0d8;margin-bottom:14px">
    <div style="font-weight:700;font-size:.9rem;color:var(--ah);margin-bottom:8px">Vill du testa innan du bestämmer?</div>
    <div style="font-size:.83rem;color:#495057;line-height:1.65;margin-bottom:12px">Kom igång med ${e.t.toLowerCase()} redan idag — utan att ansöka:</div>
    <div style="display:grid;gap:7px;margin-bottom:14px">
    ${e.id===2?`<a href="https://www.freecodecamp.org" target="_blank" style="display:flex;align-items:center;gap:10px;padding:9px 14px;background:#f8f9fa;border-radius:8px;text-decoration:none;color:var(--ah);font-size:.83rem;font-weight:600">🖥️ freeCodeCamp <span style="font-size:.76rem;color:#6c757d;font-weight:400">— gratis kodlärning, börja idag</span></a><a href="https://www.theodinproject.com" target="_blank" style="display:flex;align-items:center;gap:10px;padding:9px 14px;background:#f8f9fa;border-radius:8px;text-decoration:none;color:var(--ah);font-size:.83rem;font-weight:600">🛠️ The Odin Project <span style="font-size:.76rem;color:#6c757d;font-weight:400">— fullstack från grunden</span></a>`
    :e.id===1?`<a href="https://www.1177.se" target="_blank" style="display:flex;align-items:center;gap:10px;padding:9px 14px;background:#f8f9fa;border-radius:8px;text-decoration:none;color:var(--ah);font-size:.83rem;font-weight:600">🏥 1177 Vårdguiden <span style="font-size:.76rem;color:#6c757d;font-weight:400">— lär känna vården utifrån</span></a><a href="https://www.coursera.org/browse/health" target="_blank" style="display:flex;align-items:center;gap:10px;padding:9px 14px;background:#f8f9fa;border-radius:8px;text-decoration:none;color:var(--ah);font-size:.83rem;font-weight:600">📚 Coursera Health <span style="font-size:.76rem;color:#6c757d;font-weight:400">— introduktionskurser i vård</span></a>`
    :`<a href="https://www.coursera.org" target="_blank" style="display:flex;align-items:center;gap:10px;padding:9px 14px;background:#f8f9fa;border-radius:8px;text-decoration:none;color:var(--ah);font-size:.83rem;font-weight:600">📚 Coursera <span style="font-size:.76rem;color:#6c757d;font-weight:400">— gratis introduktionskurser</span></a><a href="https://www.youtube.com" target="_blank" style="display:flex;align-items:center;gap:10px;padding:9px 14px;background:#f8f9fa;border-radius:8px;text-decoration:none;color:var(--ah);font-size:.83rem;font-weight:600">▶️ YouTube <span style="font-size:.76rem;color:#6c757d;font-weight:400">— sök yrket + "dag i livet"</span></a>`}
    </div>
    <div style="border-top:1px solid #e0e0d8;padding-top:12px">
    <div style="font-size:.76rem;font-weight:700;color:#6c757d;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px">Vill du ha ett ärligt samtal?</div>
    <div onclick="alert('Kommer snart!')" style="display:flex;align-items:center;gap:14px;padding:14px 16px;background:linear-gradient(135deg,var(--wl),#FFF8EE);border:2px solid var(--wa);border-radius:12px;cursor:pointer">
    <div style="width:40px;height:40px;border-radius:50%;background:var(--wa);display:flex;align-items:center;justify-content:center;flex-shrink:0"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></div>
    <div style="flex:1">
    <div style="font-weight:700;font-size:.9rem;color:var(--ah)">Prata med en ${e.t.toLowerCase()} — 20 min</div>
    <div style="font-size:.8rem;color:#6c757d;margin-top:2px">Ställ frågorna siffrorna inte svarar på. Vad är svårast med jobbet? Hur var studietiden egentligen?</div>
    </div>
    <div style="font-weight:700;font-size:1rem;color:var(--wa);white-space:nowrap">499 kr →</div>
    </div>
    </div>
    </div>`;

    // ── Avslutande CTA ──
    h+=`<div style="background:linear-gradient(135deg,#1a1a18,#2d2d29);border-radius:16px;padding:32px 28px;margin-top:8px;text-align:center">
    <div style="font-family:'DM Serif Display',serif;font-size:1.6rem;color:#fff;margin-bottom:10px;line-height:1.25">${firstName} — nu är det dags att ta nästa steg.</div>
    <div style="font-size:.9rem;color:rgba(255,255,255,.7);margin-bottom:24px;line-height:1.6;max-width:380px;margin-left:auto;margin-right:auto">Planen är din. Spara den, skriv ut den, dela den. Det enda som saknas är att du faktiskt gör det.</div>
    <div style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center">
    <button onclick="printPlan()" style="padding:13px 24px;background:var(--ac);color:#fff;border:none;border-radius:10px;font-family:inherit;font-weight:700;font-size:.9rem;cursor:pointer;display:flex;align-items:center;gap:8px">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Spara som PDF</button>
    <a href="https://www.antagning.se" target="_blank" style="padding:13px 24px;background:rgba(255,255,255,.1);color:#fff;border:1.5px solid rgba(255,255,255,.2);border-radius:10px;font-family:inherit;font-weight:700;font-size:.9rem;cursor:pointer;text-decoration:none;display:flex;align-items:center;gap:8px">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>Gå till antagning.se</a>
    </div>
    <div style="margin-top:20px;font-size:.75rem;color:rgba(255,255,255,.4)">Planen ersätter inte professionell studievägledning — men den ger dig ett rejält försprång.</div>
    </div>`;

    h+=`</div>`; // end #planSkol

    // planSummary removed — Sammanfattning tab covers this now
    h+=`<div id="planSummary" style="display:none"></div>`;

    document.getElementById('fpDiv').innerHTML=h;
}

// Tab switching
const PLAN_TABS=['tid','overview','ekon','beh','skol'];
const PLAN_LABELS=['Tidslinje','Översikt','Ekonomi','Behörighet','Sammanfattning'];
let planTabIdx=0;

function navPlan(dir){
    const tabs=PLAN_TABS;
    const cur=tabs.indexOf(window._curTab||'overview');
    const next=Math.max(0,Math.min(tabs.length-1,cur+dir));
    if(next===cur)return;
    const btn=document.querySelectorAll('.ptbar button')[next];
    planTab(tabs[next],btn);
    document.getElementById('planTabs').closest('section')||document.querySelector('.fp').scrollIntoView({behavior:'smooth',block:'start'});
    window.scrollTo({top:document.getElementById('planTabs').getBoundingClientRect().top+window.scrollY-70,behavior:'smooth'});
}
function planTab(tab,btn){
    window._curTab=tab;document.querySelectorAll('.ptbar button').forEach(b=>b.classList.remove('act'));
    if(btn) btn.classList.add('act');
    else {
        const btns=document.querySelectorAll('.ptbar button');
        const idx=PLAN_TABS.indexOf(tab);
        if(btns[idx]) btns[idx].classList.add('act');
    }
    planTabIdx=PLAN_TABS.indexOf(tab);
    if(planTabIdx<0) planTabIdx=0;
    ['planOverview','planBeh','planEkon','planTid','planSkol','planLifeChange'].forEach(id=>{
        const el=document.getElementById(id);
        if(el) el.style.display='none';
    });
    const map={overview:'planOverview',beh:'planBeh',ekon:'planEkon',tid:'planTid',skol:'planSkol'};
    const panelId=map[tab];
    if(panelId) document.getElementById(panelId).style.display='block';
    if(tab==='overview'){
        const lc=document.getElementById('planLifeChange');
        if(lc) lc.style.display='block';
    }
    // Update arrows
    const prev=document.getElementById('planPrev');
    const next=document.getElementById('planNext');
    const lbl=document.getElementById('planStepLabel');
    if(prev){prev.disabled=planTabIdx===0;prev.style.opacity=planTabIdx===0?'0.35':'1';}
    if(next){next.disabled=planTabIdx===PLAN_TABS.length-1;next.style.opacity=planTabIdx===PLAN_TABS.length-1?'0.35':'1';}
    if(lbl) lbl.textContent=PLAN_LABELS[planTabIdx]+' ('+(planTabIdx+1)+'/'+PLAN_TABS.length+')';
    const welcomeEl=document.querySelector('.pwel');
    if(welcomeEl) window.scrollTo({top:welcomeEl.offsetTop-70,behavior:'smooth'});
}
function planPrev(){if(planTabIdx>0) planTab(PLAN_TABS[planTabIdx-1],null);}
function planNext(){if(planTabIdx<PLAN_TABS.length-1) planTab(PLAN_TABS[planTabIdx+1],null);}

function checkGrades(){
    const boxes=document.querySelectorAll('#gradeCheck input[type=checkbox]');
    const res=document.getElementById('gradeResult');
    const missing=[...boxes].filter(b=>!b.checked).map(b=>b.parentElement.querySelector('span').textContent);
    if(!missing.length){res.style.background='var(--al)';res.style.color='var(--ac)';res.textContent='Alla kurser avklarade.';}
    else{res.style.background='var(--rl)';res.style.color='var(--re)';res.textContent='Saknas: '+missing.join(', ')+'. Komplettera via Komvux.';}
}

function setHou(type,btn){
    const city=mapCity(ans.current_location);
    const defR=type==='home'?0:Math.round((CIT[city]||4500)*(HOU[type]||.75));
    document.getElementById('fR').value=defR;
    document.getElementById('fRMark').style.left=(defR/12000*100)+'%';
    const hn2={student:'studentboende',shared:'delad lgh',rental:'hyresrätt',home:'bo kvar'};
    document.getElementById('fRDef').textContent='Snitt '+(hn2[type]||type)+': '+fmt(defR)+' kr';
    document.querySelectorAll('.houbtn').forEach(b=>b.classList.remove('hact'));
    btn.classList.add('hact');
    
    // Update housing type in answers
    ans.housing=type;
    
    // Re-render expenses section
    updateExpensesSection(type);
    
    upd();
}

function updateExpensesSection(hou){
    const expSection=document.getElementById('expensesSection');
    if(!expSection)return;
    
    const fixedExp=parseInt(ans.fixed_expenses)||10000;
    const variableExp=parseInt(ans.variable_expenses)||4000;
    const userExp=hou==='home'?(fixedExp+variableExp):variableExp;
    
    let h='';
    
    if(hou==='home'){
        h+=`<div style="font-size:.72rem;color:#495057;margin:-4px 0 8px 0;padding:0 12px;line-height:1.4;opacity:.85">Dina fasta utgifter + rörliga utgifter. Inkluderar din nuvarande hyra.</div>`;
    }else{
        h+=`<div style="font-size:.72rem;color:#495057;margin:-4px 0 8px 0;padding:0 12px;line-height:1.4;opacity:.85">Endast rörliga utgifter (mat, transport, nöje). Boende är separat ovan.</div>`;
    }
    
    h+=`<div style="padding:12px;background:#fff;border-radius:8px;margin-bottom:8px;border:1px solid #dee2e6">`;
    
    if(hou==='home'){
        h+=`<div style="margin-bottom:12px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <label style="font-size:.85rem;font-weight:600;color:#495057">Fasta utgifter</label>
        <span style="font-size:.95rem;font-weight:600;color:#495057" id="fFixedExp">${fmt(fixedExp)} kr</span>
        </div>
        <input type="range" class="bslider" id="fFixed" min="3000" max="20000" step="250" value="${fixedExp}" oninput="upd()" style="accent-color:#6c757d;width:100%">
        <div class="bsmeta"><span>3 000 kr</span><span>20 000 kr</span></div>
        <div style="font-size:.72rem;color:#6c757d;margin-top:4px;opacity:.85">Hyra, el, försäkringar, abonnemang</div>
        </div>`;
    }
    
    h+=`<div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
    <label style="font-size:.85rem;font-weight:600;color:#495057">Rörliga utgifter</label>
    <span style="font-size:.95rem;font-weight:600;color:#495057" id="fVarExp">${fmt(variableExp)} kr</span>
    </div>
    <input type="range" class="bslider" id="fVariable" min="1000" max="10000" step="250" value="${variableExp}" oninput="upd()" style="accent-color:#6c757d;width:100%">
    <div class="bsmeta"><span>1 000 kr</span><span>10 000 kr</span></div>
    <div style="font-size:.72rem;color:#6c757d;margin-top:4px;opacity:.85">Mat, transport, nöje, kläder</div>
    </div>
    </div>`;
    
    expSection.innerHTML=h;
}

function upd(){
    if(!edu)return;
    const a=ans;
    const age=Math.min(70,Math.max(18,parseInt(a.age)||29));
    const ry=edu.y;
    const loan=+document.getElementById('fL').value;
    const wh=+document.getElementById('fW').value;
    const wr=+document.getElementById('fWR').value;
    const rent=+document.getElementById('fR').value;
    const wi=Math.round(wh*wr*4.3);
    const barnCSN=a.has_kids==='yes'?2648:0;
    const numKids=a.num_kids?parseInt(a.num_kids)||1:0;
    const cc=a.has_kids==='yes'?2000*numKids:0;
    
    // Get expenses from sliders
    const hou=a.housing||'student';
    const fFixedEl=document.getElementById('fFixed');
    const fixedExp=hou==='home'&&fFixedEl?+fFixedEl.value:(parseInt(a.fixed_expenses)||10000);
    const variableExp=+document.getElementById('fVariable').value;
    const userExp=hou==='home'?(fixedExp+variableExp):variableExp;
    
    const ti=BID+barnCSN+loan+wi,to=rent+userExp+cc,bal=ti-to;
    const mo=Math.round(ry*10),debt=loan*mo,pb=debt>0?Math.round(debt*.04/12):0;
    const op=sal*12*ry,yg=(edu.s0-sal)*12,be=yg>0?Math.ceil((op+debt)/yg):0;

    document.getElementById('fLV').textContent=fmt(loan)+' kr';
    document.getElementById('fWV').textContent=fmt(wi)+' kr';
    document.getElementById('fWH').textContent=wh+' h';
    document.getElementById('fWRL').textContent=wr+' kr';
    document.getElementById('fRV').textContent=fmt(rent)+' kr';
    
    // Update expenses
    if(hou==='home'&&document.getElementById('fFixedExp')){
        document.getElementById('fFixedExp').textContent=fmt(fixedExp)+' kr';
    }
    document.getElementById('fVarExp').textContent=fmt(variableExp)+' kr';
    document.getElementById('fUserExp').textContent=fmt(userExp)+' kr';
    
    document.getElementById('fTI').textContent=fmt(ti)+' kr';
    document.getElementById('fTO').textContent=fmt(to)+' kr';

    const bx=document.getElementById('fBx'),bl2=document.getElementById('fBL'),bv=document.getElementById('fBV'),ba=document.getElementById('fBA');
    const c=bal>=0?'var(--ac)':'#c24b3b',bg=bal>=0?'#D9F0E3':'#f8d7da';
    bx.style.background=bg;bx.style.borderColor=c;bl2.style.color=bv.style.color=ba.style.color=c;
    bl2.textContent=bal>=0?'Kvar varje månad':'Underskott';
    bv.textContent=(bal>=0?'+':'')+fmt(bal)+' kr';
    ba.textContent=bal>=500?'Bra marginal!':bal>=0?'Tight men funkar.':'Öka lån, sänk hyra eller extrajobb.';

    const bv2=document.getElementById('fBV2');
    if(bv2){bv2.textContent=(bal>=0?'+':'')+fmt(bal)+' kr';
    const col=bal>=0?'var(--ah)':'#721c24';const bg=bal>=0?'#D9F0E3':'#f8d7da';
    bv2.style.color=col;
    const wrap=document.getElementById('fBV2wrap');if(wrap)wrap.style.background=bg;
    const lbl=document.getElementById('fBV2lbl');if(lbl){lbl.style.color=col;}
    bv2.querySelectorAll&&bv2.querySelectorAll('div').forEach(d=>d.style.color=col);}
    const fPBel=document.getElementById('fPB');if(fPBel)fPBel.textContent=debt>0&&pb>0?fmt(pb)+' kr':'—';
    const fD2=document.getElementById('fD2');if(fD2)fD2.textContent=fmt(debt)+' kr';
    const fD2s=document.getElementById('fD2s');if(fD2s)fD2s.textContent=fmt(debt)+' kr';
    const fBE=document.getElementById('fBE');if(fBE)fBE.textContent=be>0&&be<50?'~'+be+' år':'—';
    // Sync summary cards (alltid synlig sektion)
    const bv3=document.getElementById('fBV3');if(bv3){bv3.textContent=(bal>=0?'+':'')+fmt(bal)+' kr';bv3.style.color=bal>=0?'var(--ac)':'#c24b3b';}
    const fd3=document.getElementById('fD3');if(fd3)fd3.textContent=fmt(debt)+' kr';
    const fbe3=document.getElementById('fBE3');if(fbe3)fbe3.textContent=be>0&&be<50?'~'+be+' år':'—';
    
    // Render debt banner dynamically
    renderDebtBanner(debt, age, ry);
}

function renderDebtBanner(debt, age, ry){
    const banner=document.getElementById('debtBanner');
    if(!banner)return;
    
    if(debt>0){
        const pb=Math.round(debt*0.04/12);
        const yearsToPayoff=Math.ceil(debt/(pb*12));
        const debtFreeAge=age+ry+yearsToPayoff;
        
        banner.innerHTML=`<div style="background:linear-gradient(135deg,#fff9f0,#fff3e0);border:2px solid #e8b86d;border-radius:16px;padding:32px 28px;margin:32px 0">
        <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px">
        <svg width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="#7d6131" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        <div style="flex:1">
        <div style="font-family:'DM Serif Display',serif;font-size:1.6rem;color:#7d6131;margin-bottom:4px">Din investering i framtiden</div>
        <div style="font-size:.9rem;color:#7d6131;opacity:.85">CSN-lån med låg ränta (~0.55%) — den billigaste låneformen som finns</div>
        </div>
        <div style="text-align:right">
        <div style="font-size:.78rem;text-transform:uppercase;color:#7d6131;opacity:.75;letter-spacing:.5px">Total summa</div>
        <div style="font-family:'DM Serif Display',serif;font-size:2.2rem;color:#7d6131;font-weight:700" id="fD2">${fmt(debt)} kr</div>
        </div>
        </div>
        
        <div style="background:#fff;border-radius:12px;padding:20px;margin-bottom:16px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <label style="font-size:.92rem;font-weight:600;color:#495057">Månadsbelopp (du väljer)</label>
        <span style="font-size:1.1rem;font-weight:700;color:#7d6131" id="fPB">${fmt(pb)} kr/mån</span>
        </div>
        <input type="range" class="bslider" id="fPayback" min="${Math.round(debt*0.04/12)}" max="${Math.round(debt*0.10/12)}" step="100" value="${pb}" oninput="updPayback()" style="accent-color:#e8b86d;width:100%">
        <div style="display:flex;justify-content:space-between;font-size:.75rem;color:#6c757d;margin-top:6px">
        <span>Lugnt tempo (${fmt(Math.round(debt*0.04/12))} kr)</span>
        <span>Snabbare tempo (${fmt(Math.round(debt*0.10/12))} kr)</span>
        </div>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div style="background:#fff;padding:16px;border-radius:10px;text-align:center">
        <div style="font-size:.75rem;color:#6c757d;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Skuldfri vid</div>
        <div style="font-family:'DM Serif Display',serif;font-size:1.6rem;color:var(--ac)" id="fDebtFreeAge">${debtFreeAge} år</div>
        </div>
        <div style="background:#fff;padding:16px;border-radius:10px;text-align:center">
        <div style="font-size:.75rem;color:#6c757d;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Återbetalningstid</div>
        <div style="font-family:'DM Serif Display',serif;font-size:1.6rem;color:var(--ac)" id="fYearsToPayoff">${yearsToPayoff} år</div>
        </div>
        </div>
        </div>`;
    }else{
        banner.innerHTML=`<div style="background:linear-gradient(135deg,#D9F0E3,#a3cfbb);border:2px solid var(--ac);border-radius:16px;padding:32px 28px;margin:32px 0;text-align:center">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--ah)" stroke-width="2" style="margin:0 auto 16px"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        <div style="font-family:'DM Serif Display',serif;font-size:1.8rem;color:var(--ah);margin-bottom:8px">Ingen skuld!</div>
        <div style="font-size:1rem;color:var(--ah);opacity:.9">Du klarar studierna utan CSN-lån. Det ger dig ekonomisk frihet direkt efter examen.</div>
        </div>`;
    }
}

function updPayback(){
    const a=ans;
    const age=Math.min(70,Math.max(18,parseInt(a.age)||29));
    const loan=+document.getElementById('fL').value;
    const ry=edu.y;
    const mo=Math.round(ry*10),debt=loan*mo;
    const pb=+document.getElementById('fPayback').value;
    const yearsToPayoff=debt>0&&pb>0?Math.ceil(debt/(pb*12)):0;
    const debtFreeAge=age+ry+yearsToPayoff;
    
    document.getElementById('fPB').textContent=fmt(pb)+' kr/mån';
    document.getElementById('fDebtFreeAge').textContent=debtFreeAge>0?debtFreeAge+' år':'—';
    document.getElementById('fYearsToPayoff').textContent=yearsToPayoff>0?yearsToPayoff+' år':'—';
}

// Debt banner is rendered dynamically via upd() and buildFP()



async function saveAndRedirect() {
    // Hämta eller skapa session_id
    let sid = localStorage.getItem('svg_sid');
    if (!sid) { sid = crypto.randomUUID(); localStorage.setItem('svg_sid', sid); }

    // Spara till localStorage som backup
    const saveData = {...ans, _session_id: sid};
    try { localStorage.setItem('svg_answers', JSON.stringify(saveData)); } catch(e) {}
    try { localStorage.setItem('svg_sal', sal || 0); } catch(e) {}
    try { localStorage.setItem('svg_edu', edu ? edu.id : 0); } catch(e) {}
    // Spara e-post + lösenord för att förifylla på /din-plan
    try { if(ans.user_email) localStorage.setItem('svg_email', ans.user_email); } catch(e) {}
    try { if(ans.user_password) localStorage.setItem('svg_password', ans.user_password); } catch(e) {}

    // Visa laddningsindikator
    const loadMsg = document.createElement('div');
    loadMsg.style.cssText = 'position:fixed;inset:0;background:#0a2e1a;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px';
    loadMsg.innerHTML = `<div style="text-align:center">
        <div style="font-family:'DM Serif Display',serif;font-size:1.6rem;color:#fff;margin-bottom:8px">Sparar din plan...</div>
        <div style="font-size:.88rem;color:rgba(255,255,255,.6);margin-bottom:32px">Skickar dig vidare om ett ögonblick</div>
        <div style="background:rgba(255,255,255,.1);border-radius:100px;height:6px;width:200px;overflow:hidden">
            <div style="background:var(--ac);height:100%;width:60%;border-radius:100px;animation:progress 1s ease infinite alternate"></div>
        </div>
    </div>
    <style>@keyframes progress{from{width:40%}to{width:80%}}</style>`;
    document.body.appendChild(loadMsg);

    // Spara till Supabase via raw fetch (undviker DataCloneError)
    try {
        const res = await fetch(SUPABASE_URL + '/rest/v1/answers', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_KEY,
                'Authorization': 'Bearer ' + SUPABASE_KEY,
                'Prefer': 'return=minimal'
            },
            body: JSON.stringify({
                education_id: edu ? edu.id : null,
                salary: sal || null,
                data: saveData
            })
        });
        if (!res.ok) console.warn('Supabase insert fel:', res.status, await res.text());
    } catch(e) {
        console.warn('Supabase save failed, localStorage backup aktivt:', e.message);
    }

    // Redirect till din-plan
    window.location.href = '/din-plan?sid=' + encodeURIComponent(sid);
}

function pay() {
    saveAndRedirect();
}


</script>

</body>
</html>